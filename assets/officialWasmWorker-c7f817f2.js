var sf=Object.defineProperty;var of=(De,Oe,Ze)=>Oe in De?sf(De,Oe,{enumerable:!0,configurable:!0,writable:!0,value:Ze}):De[Oe]=Ze;var Re=(De,Oe,Ze)=>(of(De,typeof Oe!="symbol"?Oe+"":Oe,Ze),Ze),Qo=(De,Oe,Ze)=>{if(!Oe.has(De))throw TypeError("Cannot "+Ze)};var s=(De,Oe,Ze)=>(Qo(De,Oe,"read from private field"),Ze?Ze.call(De):Oe.get(De)),Q=(De,Oe,Ze)=>{if(Oe.has(De))throw TypeError("Cannot add the same private member more than once");Oe instanceof WeakSet?Oe.add(De):Oe.set(De,Ze)},K=(De,Oe,Ze,Qn)=>(Qo(De,Oe,"write to private field"),Qn?Qn.call(De,Ze):Oe.set(De,Ze),Ze);var Ce=(De,Oe,Ze)=>(Qo(De,Oe,"access private method"),Ze);(function(){var br,Ut,zn,He,ui,jt,qe,he,ye,dn,qr,vs,Nr,Vn,$n,xs,Tl,Es,Cl,Ss,Pl,Hn,Pi,fi,Uo,As,Fl,hi,Be,pi,vr,xr,Gn,_i,jo,In,Er,On,Kn,Xn,Y,Sr,Ar,Tt,Ir,Or,Tr,Cr,Yt,Pr,Tn,mi,zo,Fr,Lr,Cn,Ue,Yn,fn,yi,zt,gt,ot,je,rt,ze,Ct,Fe,ft,qt,Nt,Fs,Xe,ht,Pt,Ft,ut,Wr,en,tn,hn,Vt,Fn,pn,Dr,_n,Ni,Ls,Ll,Ws,Wl,Ds,Dl,Rs,Rl,vi,Vo,xi,Ln,Ms,Ml,Wn,tr,pt,$t,nr,Ht,kt,Br,Js,Ei,$o,Si,Ho,rr,Dn,Qs,Qr,ir,Ur,Us,Bl,Ai,cl,ki,ul;"use strict";function De(t){return typeof t>"u"||t===void 0}function Oe(t){return typeof t=="string"}function Ze(t){return typeof t=="number"}function Qn(t){return typeof t=="boolean"}function Ks(t){return t===null}function Ql(t){return t instanceof Date}function Ul(t){return typeof t=="bigint"}function It(t){return typeof t=="function"}function Jt(t){return typeof t=="object"&&t!==null}function h(t){return Object.freeze(t)}function wn(t){return Array.isArray(t)}function cr(t){return t}const et=h({is(t){return t.kind==="AlterTableNode"},create(t){return h({kind:"AlterTableNode",table:t})},cloneWithTableProps(t,e){return h({...t,...e})},cloneWithColumnAlteration(t,e){return h({...t,columnAlterations:t.columnAlterations?[...t.columnAlterations,e]:[e]})}}),Ke=h({is(t){return t.kind==="IdentifierNode"},create(t){return h({kind:"IdentifierNode",name:t})}}),bn=h({is(t){return t.kind==="CreateIndexNode"},create(t){return h({kind:"CreateIndexNode",name:Ke.create(t)})},cloneWith(t,e){return h({...t,...e})},cloneWithColumns(t,e){return h({...t,columns:[...t.columns||[],...e]})}}),Jo=h({is(t){return t.kind==="CreateSchemaNode"},create(t,e){return h({kind:"CreateSchemaNode",schema:Ke.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),jl=["preserve rows","delete rows","drop"],Bt=h({is(t){return t.kind==="CreateTableNode"},create(t){return h({kind:"CreateTableNode",table:t,columns:h([])})},cloneWithColumn(t,e){return h({...t,columns:h([...t.columns,e])})},cloneWithConstraint(t,e){return h({...t,constraints:t.constraints?h([...t.constraints,e]):h([e])})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWith(t,e){return h({...t,...e})}}),qn=h({is(t){return t.kind==="SchemableIdentifierNode"},create(t){return h({kind:"SchemableIdentifierNode",identifier:Ke.create(t)})},createWithSchema(t,e){return h({kind:"SchemableIdentifierNode",schema:Ke.create(t),identifier:Ke.create(e)})}}),Fi=h({is(t){return t.kind==="DropIndexNode"},create(t,e){return h({kind:"DropIndexNode",name:qn.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),Xs=h({is(t){return t.kind==="DropSchemaNode"},create(t,e){return h({kind:"DropSchemaNode",schema:Ke.create(t),...e})},cloneWith(t,e){return h({...t,...e})}}),Ys=h({is(t){return t.kind==="DropTableNode"},create(t,e){return h({kind:"DropTableNode",table:t,...e})},cloneWith(t,e){return h({...t,...e})}}),Nn=h({is(t){return t.kind==="AliasNode"},create(t,e){return h({kind:"AliasNode",node:t,alias:e})}}),vn=h({is(t){return t.kind==="TableNode"},create(t){return h({kind:"TableNode",table:qn.create(t)})},createWithSchema(t,e){return h({kind:"TableNode",table:qn.createWithSchema(t,e)})}});function Wt(t){return Jt(t)&&It(t.toOperationNode)}function zl(t){return Jt(t)&&"expressionType"in t&&Wt(t)}function Vl(t){return Jt(t)&&"expression"in t&&Oe(t.alias)&&Wt(t)}const on=h({is(t){return t.kind==="SelectModifierNode"},create(t){return h({kind:"SelectModifierNode",modifier:t})},createWithExpression(t){return h({kind:"SelectModifierNode",rawModifier:t})}}),xn=h({is(t){return t.kind==="AndNode"},create(t,e){return h({kind:"AndNode",left:t,right:e})}}),ur=h({is(t){return t.kind==="OrNode"},create(t,e){return h({kind:"OrNode",left:t,right:e})}}),Zs=h({is(t){return t.kind==="OnNode"},create(t){return h({kind:"OnNode",on:t})},cloneWithOperation(t,e,r){return h({...t,on:e==="And"?xn.create(t.on,r):ur.create(t.on,r)})}}),$r=h({is(t){return t.kind==="JoinNode"},create(t,e){return h({kind:"JoinNode",joinType:t,table:e,on:void 0})},createWithOn(t,e,r){return h({kind:"JoinNode",joinType:t,table:e,on:Zs.create(r)})},cloneWithOn(t,e){return h({...t,on:t.on?Zs.cloneWithOperation(t.on,"And",e):Zs.create(e)})}}),Hr=h({is(t){return t.kind==="BinaryOperationNode"},create(t,e,r){return h({kind:"BinaryOperationNode",leftOperand:t,operator:e,rightOperand:r})}}),$l=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","&&","?","?&","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp"],Hl=["+","-","*","/","%","^","&","|","#","<<",">>"],Go=["->","->>"],Jl=[...$l,...Hl,"&&","||"],Gl=["not","-",...["exists","not exists"]],Kl=[...Jl,...Go,...Gl,"between","between symmetric"],Un=h({is(t){return t.kind==="OperatorNode"},create(t){return h({kind:"OperatorNode",operator:t})}});function Ko(t){return Oe(t)&&Go.includes(t)}const tt=h({is(t){return t.kind==="ColumnNode"},create(t){return h({kind:"ColumnNode",column:Ke.create(t)})}}),eo=h({is(t){return t.kind==="SelectAllNode"},create(){return h({kind:"SelectAllNode"})}}),Li=h({is(t){return t.kind==="ReferenceNode"},create(t,e){return h({kind:"ReferenceNode",table:e,column:t})},createSelectAll(t){return h({kind:"ReferenceNode",table:t,column:eo.create()})}});class Xl{constructor(e){Q(this,br,void 0);K(this,br,e)}get dynamicReference(){return s(this,br)}get refType(){}toOperationNode(){return ta(s(this,br))}}br=new WeakMap;function Xo(t){return Jt(t)&&Wt(t)&&Oe(t.dynamicReference)}const to=h({is(t){return t.kind==="OrderByItemNode"},create(t,e){return h({kind:"OrderByItemNode",orderBy:t,direction:e})}}),wt=h({is(t){return t.kind==="RawNode"},create(t,e){return h({kind:"RawNode",sqlFragments:h(t),parameters:h(e)})},createWithSql(t){return wt.create([t],[])},createWithChild(t){return wt.create(["",""],[t])},createWithChildren(t){return wt.create(new Array(t.length+1).fill(""),t)}});function Yo(t){return t==="asc"||t==="desc"}function Wi(t){if(t.length===2)return[no(t[0],t[1])];if(t.length===1){const[e]=t;return Array.isArray(e)?e.map(r=>no(r)):[no(e)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${t.length}`)}function no(t,e){const r=Yl(t);if(to.is(r)){if(e)throw new Error("Cannot specify direction twice!");return r}return to.create(r,Zo(e))}function Yl(t){if(ni(t))return yr(t);if(Xo(t))return t.toOperationNode();const[e,r]=t.split(" ");if(r){if(!Yo(r))throw new Error(`Invalid order by direction: ${r}`);return to.create(an(e),Zo(r))}return an(t)}function Zo(t){if(t)return t==="asc"||t==="desc"?wt.createWithSql(t):t.toOperationNode()}const ro=h({is(t){return t.kind==="JSONReferenceNode"},create(t,e){return h({kind:"JSONReferenceNode",reference:t,traversal:e})},cloneWithTraversal(t,e){return h({...t,traversal:e})}}),ea=h({is(t){return t.kind==="JSONOperatorChainNode"},create(t){return h({kind:"JSONOperatorChainNode",operator:t,values:h([])})},cloneWithValue(t,e){return h({...t,values:h([...t.values,e])})}}),io=h({is(t){return t.kind==="JSONPathNode"},create(t){return h({kind:"JSONPathNode",inOperator:t,pathLegs:h([])})},cloneWithLeg(t,e){return h({...t,pathLegs:h([...t.pathLegs,e])})}});function ta(t){return Oe(t)?an(t):t.toOperationNode()}function Jr(t){return wn(t)?t.map(e=>Qt(e)):[Qt(t)]}function Qt(t){return ni(t)?yr(t):ta(t)}function Zl(t,e){const r=an(t);if(Ko(e))return ro.create(r,ea.create(Un.create(e)));const n=e.slice(0,-1);if(Ko(n))return ro.create(r,io.create(Un.create(n)));throw new Error(`Invalid JSON operator: ${e}`)}function an(t){const e=".";if(!t.includes(e))return Li.create(tt.create(t));const r=t.split(e).map(so);if(r.length===3)return tc(r);if(r.length===2)return nc(r);throw new Error(`invalid column reference ${t}`)}function ec(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(so);return Nn.create(an(r),Ke.create(n))}else return an(t)}function na(t){return tt.create(t)}function ra(t){const e=" ";if(t.includes(e)){const[r,n]=t.split(e).map(so);if(!Yo(n))throw new Error(`invalid order direction "${n}" next to "${r}"`);return Wi([r,n])[0]}else return na(t)}function tc(t){const[e,r,n]=t;return Li.create(tt.create(n),vn.createWithSchema(e,r))}function nc(t){const[e,r]=t;return Li.create(tt.create(r),vn.create(e))}function so(t){return t.trim()}const ia=h({is(t){return t.kind==="PrimitiveValueListNode"},create(t){return h({kind:"PrimitiveValueListNode",values:h([...t])})}}),oo=h({is(t){return t.kind==="ValueListNode"},create(t){return h({kind:"ValueListNode",values:h(t)})}}),Gt=h({is(t){return t.kind==="ValueNode"},create(t){return h({kind:"ValueNode",value:t})},createImmediate(t){return h({kind:"ValueNode",value:t,immediate:!0})}});function sa(t){return wn(t)?rc(t):bt(t)}function bt(t){return ni(t)?yr(t):Gt.create(t)}function ao(t){return Ze(t)||Qn(t)||Ks(t)}function lo(t){if(!ao(t))throw new Error(`unsafe immediate value ${JSON.stringify(t)}`);return Gt.createImmediate(t)}function rc(t){return t.some(ni)?oo.create(t.map(e=>bt(e))):ia.create(t)}const dr=h({is(t){return t.kind==="ParensNode"},create(t){return h({kind:"ParensNode",node:t})}});function mt(t){if(t.length===3)return Gr(t[0],t[1],t[2]);if(t.length===1)return bt(t[0]);throw new Error(`invalid arguments: ${JSON.stringify(t)}`)}function Gr(t,e,r){return ic(e)&&aa(r)?Hr.create(Qt(t),uo(e),Gt.createImmediate(r)):Hr.create(Qt(t),uo(e),sa(r))}function ln(t,e,r){return Hr.create(Qt(t),uo(e),Qt(r))}function oa(t,e){return co(Object.entries(t).filter(([,r])=>!De(r)).map(([r,n])=>Gr(r,aa(n)?"is":"=",n)),e)}function co(t,e){const r=e==="and"?xn.create:ur.create;if(t.length===0)return Gt.createImmediate(e==="and");let n=la(t[0]);for(let S=1;S<t.length;++S)n=r(n,la(t[S]));return t.length>1?dr.create(n):n}function ic(t){return t==="is"||t==="is not"}function aa(t){return Ks(t)||Qn(t)}function uo(t){if(Oe(t)&&Kl.includes(t))return Un.create(t);if(Wt(t))return t.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(t)}`)}function la(t){return Wt(t)?t.toOperationNode():t}const fr=h({is(t){return t.kind==="OrderByNode"},create(t){return h({kind:"OrderByNode",items:h([...t])})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),ca=h({is(t){return t.kind==="PartitionByNode"},create(t){return h({kind:"PartitionByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),fo=h({is(t){return t.kind==="OverNode"},create(){return h({kind:"OverNode"})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?fr.cloneWithItems(t.orderBy,e):fr.create(e)})},cloneWithPartitionByItems(t,e){return h({...t,partitionBy:t.partitionBy?ca.cloneWithItems(t.partitionBy,e):ca.create(e)})}}),Di=h({is(t){return t.kind==="FromNode"},create(t){return h({kind:"FromNode",froms:h(t)})},cloneWithFroms(t,e){return h({...t,froms:h([...t.froms,...e])})}}),ua=h({is(t){return t.kind==="GroupByNode"},create(t){return h({kind:"GroupByNode",items:h(t)})},cloneWithItems(t,e){return h({...t,items:h([...t.items,...e])})}}),da=h({is(t){return t.kind==="HavingNode"},create(t){return h({kind:"HavingNode",having:t})},cloneWithOperation(t,e,r){return h({...t,having:e==="And"?xn.create(t.having,r):ur.create(t.having,r)})}}),Ae=h({is(t){return t.kind==="SelectQueryNode"},create(t){return h({kind:"SelectQueryNode",...t&&{with:t}})},createFrom(t,e){return h({kind:"SelectQueryNode",from:Di.create(t),...e&&{with:e}})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})},cloneWithDistinctOn(t,e){return h({...t,distinctOn:t.distinctOn?h([...t.distinctOn,...e]):h(e)})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):h([e])})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):h([e])})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?fr.cloneWithItems(t.orderBy,e):fr.create(e)})},cloneWithGroupByItems(t,e){return h({...t,groupBy:t.groupBy?ua.cloneWithItems(t.groupBy,e):ua.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithOffset(t,e){return h({...t,offset:e})},cloneWithHaving(t,e){return h({...t,having:t.having?da.cloneWithOperation(t.having,"And",e):da.create(e)})},cloneWithSetOperations(t,e){return h({...t,setOperations:t.setOperations?h([...t.setOperations,...e]):h([...e])})},cloneWithoutSelections(t){return h({...t,selections:[]})},cloneWithoutLimit(t){return h({...t,limit:void 0})},cloneWithoutOffset(t){return h({...t,offset:void 0})},cloneWithoutOrderBy(t){return h({...t,orderBy:void 0})}});function Ie(t,e){Object.defineProperties(t.prototype,{then:{enumerable:!1,value:()=>{throw new Error(e)}}})}const ci=class ci{constructor(e){Q(this,Ut,void 0);K(this,Ut,h(e))}on(...e){return new ci({...s(this,Ut),joinNode:$r.cloneWithOn(s(this,Ut).joinNode,mt(e))})}onRef(e,r,n){return new ci({...s(this,Ut),joinNode:$r.cloneWithOn(s(this,Ut).joinNode,ln(e,r,n))})}onTrue(){return new ci({...s(this,Ut),joinNode:$r.cloneWithOn(s(this,Ut).joinNode,wt.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return s(this,Ut).joinNode}};Ut=new WeakMap;let Ri=ci;Ie(Ri,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");const sc=h({is(t){return t.kind==="PartitionByItemNode"},create(t){return h({kind:"PartitionByItemNode",partitionBy:t})}});function oc(t){return Jr(t).map(sc.create)}const qs=class qs{constructor(e){Q(this,zn,void 0);K(this,zn,h(e))}orderBy(e,r){return new qs({overNode:fo.cloneWithOrderByItems(s(this,zn).overNode,Wi([e,r]))})}partitionBy(e){return new qs({overNode:fo.cloneWithPartitionByItems(s(this,zn).overNode,oc(e))})}$call(e){return e(this)}toOperationNode(){return s(this,zn).overNode}};zn=new WeakMap;let Mi=qs;Ie(Mi,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");const Kr=h({is(t){return t.kind==="SelectionNode"},create(t){return h({kind:"SelectionNode",selection:t})},createSelectAll(){return h({kind:"SelectionNode",selection:eo.create()})},createSelectAllFromTable(t){return h({kind:"SelectionNode",selection:Li.createSelectAll(t)})}});function jn(t){return It(t)?jn(t(mr())):wn(t)?t.map(e=>fa(e)):[fa(t)]}function fa(t){return Oe(t)?Kr.create(ec(t)):Xo(t)?Kr.create(t.toOperationNode()):Kr.create(Ta(t))}function Xr(t){return t?Array.isArray(t)?t.map(ha):[ha(t)]:[Kr.createSelectAll()]}function ha(t){if(Oe(t))return Kr.createSelectAllFromTable(At(t));throw new Error(`invalid value selectAll expression: ${JSON.stringify(t)}`)}const ac=h({is(t){return t.kind==="ValuesNode"},create(t){return h({kind:"ValuesNode",values:h(t)})}}),lc=h({is(t){return t.kind==="DefaultInsertValueNode"},create(){return h({kind:"DefaultInsertValueNode"})}});function cc(t){const e=It(t)?t(mr()):t,r=wn(e)?e:h([e]);return uc(r)}function uc(t){const e=dc(t);return[h([...e.keys()].map(tt.create)),ac.create(t.map(r=>fc(r,e)))]}function dc(t){const e=new Map;for(const r of t){const n=Object.keys(r);for(const S of n)!e.has(S)&&r[S]!==void 0&&e.set(S,e.size)}return e}function fc(t,e){const r=Object.keys(t),n=Array.from({length:e.size});let S=!1;for(const te of r){const fe=e.get(te);if(De(fe))continue;const Te=t[te];(De(Te)||ni(Te))&&(S=!0),n[fe]=Te}if(r.length<e.size||S){const te=lc.create();return oo.create(n.map(fe=>De(fe)?te:bt(fe)))}return ia.create(n)}const Kt=h({is(t){return t.kind==="InsertQueryNode"},create(t,e,r){return h({kind:"InsertQueryNode",into:t,...e&&{with:e},replace:r})},cloneWith(t,e){return h({...t,...e})}}),Bi=h({is(t){return t.kind==="UpdateQueryNode"},create(t,e){return h({kind:"UpdateQueryNode",table:t,...e&&{with:e}})},cloneWithFromItems(t,e){return h({...t,from:t.from?Di.cloneWithFroms(t.from,e):Di.create(e)})},cloneWithUpdates(t,e){return h({...t,updates:t.updates?h([...t.updates,...e]):e})}}),pa=h({is(t){return t.kind==="UsingNode"},create(t){return h({kind:"UsingNode",tables:h(t)})},cloneWithTables(t,e){return h({...t,tables:h([...t.tables,...e])})}}),Yr=h({is(t){return t.kind==="DeleteQueryNode"},create(t,e){return h({kind:"DeleteQueryNode",from:Di.create(t),...e&&{with:e}})},cloneWithOrderByItems(t,e){return h({...t,orderBy:t.orderBy?fr.cloneWithItems(t.orderBy,e):fr.create(e)})},cloneWithLimit(t,e){return h({...t,limit:e})},cloneWithUsing(t,e){return h({...t,using:t.using!==void 0?pa.cloneWithTables(t.using,e):pa.create(e)})}}),Et=h({is(t){return t.kind==="WhereNode"},create(t){return h({kind:"WhereNode",where:t})},cloneWithOperation(t,e,r){return h({...t,where:e==="And"?xn.create(t.where,r):ur.create(t.where,r)})}}),_a=h({is(t){return t.kind==="ReturningNode"},create(t){return h({kind:"ReturningNode",selections:h(t)})},cloneWithSelections(t,e){return h({...t,selections:t.selections?h([...t.selections,...e]):h(e)})}}),hc=h({is(t){return t.kind==="ExplainNode"},create(t,e){return h({kind:"ExplainNode",format:t,options:e})}}),Ne=h({is(t){return Ae.is(t)||Kt.is(t)||Bi.is(t)||Yr.is(t)},cloneWithWhere(t,e){return h({...t,where:t.where?Et.cloneWithOperation(t.where,"And",e):Et.create(e)})},cloneWithJoin(t,e){return h({...t,joins:t.joins?h([...t.joins,e]):h([e])})},cloneWithReturning(t,e){return h({...t,returning:t.returning?_a.cloneWithSelections(t.returning,e):_a.create(e)})},cloneWithoutWhere(t){return h({...t,where:void 0})},cloneWithExplain(t,e,r){return h({...t,explain:hc.create(e,r==null?void 0:r.toOperationNode())})}}),pc=h({is(t){return t.kind==="ColumnUpdateNode"},create(t,e){return h({kind:"ColumnUpdateNode",column:t,value:e})}});function ho(t){const e=It(t)?t(mr()):t;return Object.entries(e).filter(([r,n])=>n!==void 0).map(([r,n])=>pc.create(tt.create(r),bt(n)))}const _c=h({is(t){return t.kind==="OnDuplicateKeyNode"},create(t){return h({kind:"OnDuplicateKeyNode",updates:t})}});class mc{constructor(e,r){Re(this,"insertId");Re(this,"numInsertedOrUpdatedRows");this.insertId=e,this.numInsertedOrUpdatedRows=r}}class Qi extends Error{constructor(r){super("no result");Re(this,"node");this.node=r}}function Ui(t){return Object.prototype.hasOwnProperty.call(t,"prototype")}const Ot=h({is(t){return t.kind==="OnConflictNode"},create(){return h({kind:"OnConflictNode"})},cloneWith(t,e){return h({...t,...e})},cloneWithIndexWhere(t,e){return h({...t,indexWhere:t.indexWhere?Et.cloneWithOperation(t.indexWhere,"And",e):Et.create(e)})},cloneWithIndexOrWhere(t,e){return h({...t,indexWhere:t.indexWhere?Et.cloneWithOperation(t.indexWhere,"Or",e):Et.create(e)})},cloneWithUpdateWhere(t,e){return h({...t,updateWhere:t.updateWhere?Et.cloneWithOperation(t.updateWhere,"And",e):Et.create(e)})},cloneWithUpdateOrWhere(t,e){return h({...t,updateWhere:t.updateWhere?Et.cloneWithOperation(t.updateWhere,"Or",e):Et.create(e)})},cloneWithoutIndexWhere(t){return h({...t,indexWhere:void 0})},cloneWithoutUpdateWhere(t){return h({...t,updateWhere:void 0})}}),un=class un{constructor(e){Q(this,He,void 0);K(this,He,h(e))}column(e){const r=tt.create(e);return new un({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{columns:s(this,He).onConflictNode.columns?h([...s(this,He).onConflictNode.columns,r]):h([r])})})}columns(e){const r=e.map(tt.create);return new un({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{columns:s(this,He).onConflictNode.columns?h([...s(this,He).onConflictNode.columns,...r]):h(r)})})}constraint(e){return new un({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{constraint:Ke.create(e)})})}expression(e){return new un({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new un({...s(this,He),onConflictNode:Ot.cloneWithIndexWhere(s(this,He).onConflictNode,mt(e))})}whereRef(e,r,n){return new un({...s(this,He),onConflictNode:Ot.cloneWithIndexWhere(s(this,He).onConflictNode,ln(e,r,n))})}clearWhere(){return new un({...s(this,He),onConflictNode:Ot.cloneWithoutIndexWhere(s(this,He).onConflictNode)})}doNothing(){return new ma({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new zi({...s(this,He),onConflictNode:Ot.cloneWith(s(this,He).onConflictNode,{updates:ho(e)})})}$call(e){return e(this)}};He=new WeakMap;let ji=un;Ie(ji,"don't await OnConflictBuilder instances.");class ma{constructor(e){Q(this,ui,void 0);K(this,ui,h(e))}toOperationNode(){return s(this,ui).onConflictNode}}ui=new WeakMap,Ie(ma,"don't await OnConflictDoNothingBuilder instances.");const di=class di{constructor(e){Q(this,jt,void 0);K(this,jt,h(e))}where(...e){return new di({...s(this,jt),onConflictNode:Ot.cloneWithUpdateWhere(s(this,jt).onConflictNode,mt(e))})}whereRef(e,r,n){return new di({...s(this,jt),onConflictNode:Ot.cloneWithUpdateWhere(s(this,jt).onConflictNode,ln(e,r,n))})}clearWhere(){return new di({...s(this,jt),onConflictNode:Ot.cloneWithoutUpdateWhere(s(this,jt).onConflictNode)})}$call(e){return e(this)}toOperationNode(){return s(this,jt).onConflictNode}};jt=new WeakMap;let zi=di;Ie(zi,"don't await OnConflictUpdateBuilder instances.");const yt=class yt{constructor(e){Q(this,qe,void 0);K(this,qe,h(e))}values(e){const[r,n]=cc(e);return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{columns:r,values:n})})}columns(e){return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{columns:h(e.map(tt.create))})})}expression(e){return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{values:yr(e)})})}ignore(){return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{ignore:!0})})}onConflict(e){return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{onConflict:e(new ji({onConflictNode:Ot.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new yt({...s(this,qe),queryNode:Kt.cloneWith(s(this,qe).queryNode,{onDuplicateKey:_c.create(ho(e))})})}returning(e){return new yt({...s(this,qe),queryNode:Ne.cloneWithReturning(s(this,qe).queryNode,jn(e))})}returningAll(){return new yt({...s(this,qe),queryNode:Ne.cloneWithReturning(s(this,qe).queryNode,Xr())})}$call(e){return e(this)}$if(e,r){return e?r(this):new yt({...s(this,qe)})}$castTo(){return new yt(s(this,qe))}$narrowType(){return new yt(s(this,qe))}$assertType(){return new yt(s(this,qe))}withPlugin(e){return new yt({...s(this,qe),executor:s(this,qe).executor.withPlugin(e)})}toOperationNode(){return s(this,qe).executor.transformQuery(s(this,qe).queryNode,s(this,qe).queryId)}compile(){return s(this,qe).executor.compileQuery(this.toOperationNode(),s(this,qe).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,qe).executor.executeQuery(e,s(this,qe).queryId);return s(this,qe).executor.adapter.supportsReturning&&r.returning?n.rows:[new mc(n.insertId,n.numAffectedRows??n.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Qi){const r=await this.executeTakeFirst();if(r===void 0)throw Ui(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,qe).executor.stream(r,e,s(this,qe).queryId);for await(const S of n)yield*S.rows}async explain(e,r){return await new yt({...s(this,qe),queryNode:Ne.cloneWithExplain(s(this,qe).queryNode,e,r)}).execute()}};qe=new WeakMap;let Zr=yt;Ie(Zr,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class yc{constructor(e){Re(this,"numDeletedRows");this.numDeletedRows=e}}const ya=h({is(t){return t.kind==="LimitNode"},create(t){return h({kind:"LimitNode",limit:Gt.create(t)})}}),st=class st{constructor(e){Q(this,he,void 0);K(this,he,h(e))}where(...e){return new st({...s(this,he),queryNode:Ne.cloneWithWhere(s(this,he).queryNode,mt(e))})}whereRef(e,r,n){return new st({...s(this,he),queryNode:Ne.cloneWithWhere(s(this,he).queryNode,ln(e,r,n))})}clearWhere(){return new st({...s(this,he),queryNode:Ne.cloneWithoutWhere(s(this,he).queryNode)})}using(e){return new st({...s(this,he),queryNode:Yr.cloneWithUsing(s(this,he).queryNode,ri(e))})}innerJoin(...e){return new st({...s(this,he),queryNode:Ne.cloneWithJoin(s(this,he).queryNode,St("InnerJoin",e))})}leftJoin(...e){return new st({...s(this,he),queryNode:Ne.cloneWithJoin(s(this,he).queryNode,St("LeftJoin",e))})}rightJoin(...e){return new st({...s(this,he),queryNode:Ne.cloneWithJoin(s(this,he).queryNode,St("RightJoin",e))})}fullJoin(...e){return new st({...s(this,he),queryNode:Ne.cloneWithJoin(s(this,he).queryNode,St("FullJoin",e))})}returning(e){return new st({...s(this,he),queryNode:Ne.cloneWithReturning(s(this,he).queryNode,jn(e))})}returningAll(e){return new st({...s(this,he),queryNode:Ne.cloneWithReturning(s(this,he).queryNode,Xr(e))})}orderBy(e,r){return new st({...s(this,he),queryNode:Yr.cloneWithOrderByItems(s(this,he).queryNode,Wi([e,r]))})}limit(e){return new st({...s(this,he),queryNode:Yr.cloneWithLimit(s(this,he).queryNode,ya.create(e))})}$call(e){return e(this)}$if(e,r){return e?r(this):new st({...s(this,he)})}$castTo(){return new st(s(this,he))}$narrowType(){return new st(s(this,he))}$assertType(){return new st(s(this,he))}withPlugin(e){return new st({...s(this,he),executor:s(this,he).executor.withPlugin(e)})}toOperationNode(){return s(this,he).executor.transformQuery(s(this,he).queryNode,s(this,he).queryId)}compile(){return s(this,he).executor.compileQuery(this.toOperationNode(),s(this,he).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,he).executor.executeQuery(e,s(this,he).queryId);return s(this,he).executor.adapter.supportsReturning&&r.returning?n.rows:[new yc(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Qi){const r=await this.executeTakeFirst();if(r===void 0)throw Ui(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,he).executor.stream(r,e,s(this,he).queryId);for await(const S of n)yield*S.rows}async explain(e,r){return await new st({...s(this,he),queryNode:Ne.cloneWithExplain(s(this,he).queryNode,e,r)}).execute()}};he=new WeakMap;let Vi=st;Ie(Vi,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class gc{constructor(e,r){Re(this,"numUpdatedRows");Re(this,"numChangedRows");this.numUpdatedRows=e,this.numChangedRows=r}}const lt=class lt{constructor(e){Q(this,ye,void 0);K(this,ye,h(e))}where(...e){return new lt({...s(this,ye),queryNode:Ne.cloneWithWhere(s(this,ye).queryNode,mt(e))})}whereRef(e,r,n){return new lt({...s(this,ye),queryNode:Ne.cloneWithWhere(s(this,ye).queryNode,ln(e,r,n))})}clearWhere(){return new lt({...s(this,ye),queryNode:Ne.cloneWithoutWhere(s(this,ye).queryNode)})}from(e){return new lt({...s(this,ye),queryNode:Bi.cloneWithFromItems(s(this,ye).queryNode,ri(e))})}innerJoin(...e){return new lt({...s(this,ye),queryNode:Ne.cloneWithJoin(s(this,ye).queryNode,St("InnerJoin",e))})}leftJoin(...e){return new lt({...s(this,ye),queryNode:Ne.cloneWithJoin(s(this,ye).queryNode,St("LeftJoin",e))})}rightJoin(...e){return new lt({...s(this,ye),queryNode:Ne.cloneWithJoin(s(this,ye).queryNode,St("RightJoin",e))})}fullJoin(...e){return new lt({...s(this,ye),queryNode:Ne.cloneWithJoin(s(this,ye).queryNode,St("FullJoin",e))})}set(e){return new lt({...s(this,ye),queryNode:Bi.cloneWithUpdates(s(this,ye).queryNode,ho(e))})}returning(e){return new lt({...s(this,ye),queryNode:Ne.cloneWithReturning(s(this,ye).queryNode,jn(e))})}returningAll(){return new lt({...s(this,ye),queryNode:Ne.cloneWithReturning(s(this,ye).queryNode,Xr())})}$call(e){return e(this)}$if(e,r){return e?r(this):new lt({...s(this,ye)})}$castTo(){return new lt(s(this,ye))}$narrowType(){return new lt(s(this,ye))}$assertType(){return new lt(s(this,ye))}withPlugin(e){return new lt({...s(this,ye),executor:s(this,ye).executor.withPlugin(e)})}toOperationNode(){return s(this,ye).executor.transformQuery(s(this,ye).queryNode,s(this,ye).queryId)}compile(){return s(this,ye).executor.compileQuery(this.toOperationNode(),s(this,ye).queryId)}async execute(){const e=this.compile(),r=e.query,n=await s(this,ye).executor.executeQuery(e,s(this,ye).queryId);return s(this,ye).executor.adapter.supportsReturning&&r.returning?n.rows:[new gc(n.numAffectedRows??n.numUpdatedOrDeletedRows??BigInt(0),n.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Qi){const r=await this.executeTakeFirst();if(r===void 0)throw Ui(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,ye).executor.stream(r,e,s(this,ye).queryId);for await(const S of n)yield*S.rows}async explain(e,r){return await new lt({...s(this,ye),queryNode:Ne.cloneWithExplain(s(this,ye).queryNode,e,r)}).execute()}};ye=new WeakMap;let $i=lt;Ie($i,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");const ga=h({is(t){return t.kind==="CommonTableExpressionNameNode"},create(t,e){return h({kind:"CommonTableExpressionNameNode",table:vn.create(t),columns:e?h(e.map(tt.create)):void 0})}}),Hi=h({is(t){return t.kind==="CommonTableExpressionNode"},create(t,e){return h({kind:"CommonTableExpressionNode",name:t,expression:e})},cloneWith(t,e){return h({...t,...e})}}),Ns=class Ns{constructor(e){Q(this,dn,void 0);K(this,dn,h(e))}materialized(){return new Ns({...s(this,dn),node:Hi.cloneWith(s(this,dn).node,{materialized:!0})})}notMaterialized(){return new Ns({...s(this,dn),node:Hi.cloneWith(s(this,dn).node,{materialized:!1})})}toOperationNode(){return s(this,dn).node}};dn=new WeakMap;let Ji=Ns;Ie(Ji,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");function wa(t,e){const r=e(kc()).toOperationNode();return It(t)?t(wc(r)).toOperationNode():Hi.create(ba(t),r)}function wc(t){return e=>new Ji({node:Hi.create(ba(e),t)})}function ba(t){if(t.includes("(")){const e=t.split(/[\(\)]/),r=e[0],n=e[1].split(",").map(S=>S.trim());return ga.create(r,n)}else return ga.create(t)}const Gi=h({is(t){return t.kind==="WithNode"},create(t,e){return h({kind:"WithNode",expressions:h([t]),...e})},cloneWithExpression(t,e){return h({...t,expressions:h([...t.expressions,e])})}}),qa=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function bc(t){let e="";for(let r=0;r<t;++r)e+=qc();return e}function qc(){return qa[~~(Math.random()*qa.length)]}function Me(){return new Nc}class Nc{constructor(){Q(this,qr,void 0)}get queryId(){return s(this,qr)===void 0&&K(this,qr,bc(8)),s(this,qr)}}qr=new WeakMap;function lf(t){return t}class po{constructor(){Re(this,"nodeStack",[]);Q(this,vs,h({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this)}))}transformNode(e){if(!e)return e;this.nodeStack.push(e);const r=this.transformNodeImpl(e);return this.nodeStack.pop(),h(r)}transformNodeImpl(e){return s(this,vs)[e.kind](e)}transformNodeList(e){return e&&h(e.map(r=>this.transformNode(r)))}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:h([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers)}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where)}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}vs=new WeakMap;const vc=h({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0});class xc extends po{constructor(r){super();Q(this,xs);Q(this,Es);Q(this,Ss);Q(this,Hn);Q(this,fi);Q(this,As);Q(this,Nr,void 0);Q(this,Vn,new Set);Q(this,$n,new Set);K(this,Nr,r)}transformNodeImpl(r){if(!Ce(this,xs,Tl).call(this,r))return super.transformNodeImpl(r);const n=Ce(this,Ss,Pl).call(this,r);for(const te of n)s(this,$n).add(te);const S=Ce(this,Es,Cl).call(this,r);for(const te of S)s(this,Vn).add(te);const R=super.transformNodeImpl(r);for(const te of S)s(this,Vn).delete(te);for(const te of n)s(this,$n).delete(te);return R}transformSchemableIdentifier(r){const n=super.transformSchemableIdentifier(r);return n.schema||!s(this,Vn).has(r.identifier.name)?n:{...n,schema:Ke.create(s(this,Nr))}}transformReferences(r){const n=super.transformReferences(r);return n.table.table.schema?n:{...n,table:vn.createWithSchema(s(this,Nr),n.table.table.identifier.name)}}}Nr=new WeakMap,Vn=new WeakMap,$n=new WeakMap,xs=new WeakSet,Tl=function(r){return r.kind in vc},Es=new WeakSet,Cl=function(r){const n=new Set;if("name"in r&&r.name&&qn.is(r.name)&&Ce(this,fi,Uo).call(this,r.name,n),"from"in r&&r.from)for(const S of r.from.froms)Ce(this,Hn,Pi).call(this,S,n);if("into"in r&&r.into&&Ce(this,Hn,Pi).call(this,r.into,n),"table"in r&&r.table&&Ce(this,Hn,Pi).call(this,r.table,n),"joins"in r&&r.joins)for(const S of r.joins)Ce(this,Hn,Pi).call(this,S.table,n);return n},Ss=new WeakSet,Pl=function(r){const n=new Set;return"with"in r&&r.with&&Ce(this,As,Fl).call(this,r.with,n),n},Hn=new WeakSet,Pi=function(r,n){const S=vn.is(r)?r:Nn.is(r)&&vn.is(r.node)?r.node:null;S&&Ce(this,fi,Uo).call(this,S.table,n)},fi=new WeakSet,Uo=function(r,n){const S=r.identifier.name;!s(this,Vn).has(S)&&!s(this,$n).has(S)&&n.add(S)},As=new WeakSet,Fl=function(r,n){for(const S of r.expressions){const R=S.name.table.table.identifier.name;s(this,$n).has(R)||n.add(R)}};class ei{constructor(e){Q(this,hi,void 0);K(this,hi,new xc(e))}transformQuery(e){return s(this,hi).transformNode(e.node)}async transformResult(e){return e.result}}hi=new WeakMap;const Jn=class Jn{constructor(e){Q(this,Be,void 0);K(this,Be,h(e))}selectFrom(e){return Yi({queryId:Me(),executor:s(this,Be).executor,queryNode:Ae.createFrom(ri(e),s(this,Be).withNode)})}selectNoFrom(e){return Yi({queryId:Me(),executor:s(this,Be).executor,queryNode:Ae.cloneWithSelections(Ae.create(s(this,Be).withNode),jn(e))})}insertInto(e){return new Zr({queryId:Me(),executor:s(this,Be).executor,queryNode:Kt.create(At(e),s(this,Be).withNode)})}replaceInto(e){return new Zr({queryId:Me(),executor:s(this,Be).executor,queryNode:Kt.create(At(e),s(this,Be).withNode,!0)})}deleteFrom(e){return new Vi({queryId:Me(),executor:s(this,Be).executor,queryNode:Yr.create(ri(e),s(this,Be).withNode)})}updateTable(e){return new $i({queryId:Me(),executor:s(this,Be).executor,queryNode:Bi.create(ii(e),s(this,Be).withNode)})}with(e,r){const n=wa(e,r);return new Jn({...s(this,Be),withNode:s(this,Be).withNode?Gi.cloneWithExpression(s(this,Be).withNode,n):Gi.create(n)})}withRecursive(e,r){const n=wa(e,r);return new Jn({...s(this,Be),withNode:s(this,Be).withNode?Gi.cloneWithExpression(s(this,Be).withNode,n):Gi.create(n,{recursive:!0})})}withPlugin(e){return new Jn({...s(this,Be),executor:s(this,Be).executor.withPlugin(e)})}withoutPlugins(){return new Jn({...s(this,Be),executor:s(this,Be).executor.withoutPlugins()})}withSchema(e){return new Jn({...s(this,Be),executor:s(this,Be).executor.withPluginAtFront(new ei(e))})}};Be=new WeakMap;let Ki=Jn;class Na{constructor(){Q(this,pi,void 0);Q(this,vr,void 0);Q(this,xr,void 0);Re(this,"resolve",e=>{s(this,vr)&&s(this,vr).call(this,e)});Re(this,"reject",e=>{s(this,xr)&&s(this,xr).call(this,e)});K(this,pi,new Promise((e,r)=>{K(this,xr,r),K(this,vr,e)}))}get promise(){return s(this,pi)}}pi=new WeakMap,vr=new WeakMap,xr=new WeakMap;const va=new Set;function Ec(t){va.has(t)||(va.add(t),console.log(t))}const Sc=h([]);class xa{constructor(e=Sc){Q(this,_i);Q(this,Gn,void 0);K(this,Gn,e)}get plugins(){return s(this,Gn)}transformQuery(e,r){for(const n of s(this,Gn)){const S=n.transformQuery({node:e,queryId:r});if(S.kind===e.kind)e=S;else throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${S.kind}`].join(" "))}return e}async executeQuery(e,r){return await this.provideConnection(async n=>{const S=await n.executeQuery(e),R=await Ce(this,_i,jo).call(this,S,r);return Ac(S,R),R})}async*stream(e,r,n){const S=new Na,R=new Na;this.provideConnection(async fe=>(S.resolve(fe),await R.promise)).catch(fe=>S.reject(fe));const te=await S.promise;try{for await(const fe of te.streamQuery(e,r))yield await Ce(this,_i,jo).call(this,fe,n)}finally{R.resolve()}}}Gn=new WeakMap,_i=new WeakSet,jo=async function(e,r){for(const n of s(this,Gn))e=await n.transformResult({result:e,queryId:r});return e};function Ac(t,e){const{numAffectedRows:r}=t;r===void 0&&t.numUpdatedOrDeletedRows===void 0||r!==void 0&&e.numAffectedRows!==void 0||Ec("kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.")}class hr extends xa{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new hr([...this.plugins,e])}withPlugins(e){return new hr([...this.plugins,...e])}withPluginAtFront(e){return new hr([e,...this.plugins])}withoutPlugins(){return new hr([])}}const _o=new hr;function kc(){return new Ki({executor:_o})}function Ic(t,e){return new Ri({joinNode:$r.create(t,ii(e))})}function Oc(){return new Mi({overNode:fo.create()})}function St(t,e){if(e.length===3)return Cc(t,e[0],e[1],e[2]);if(e.length===2)return Tc(t,e[0],e[1]);throw new Error("not implemented")}function Tc(t,e,r){return r(Ic(t,e)).toOperationNode()}function Cc(t,e,r,n){return $r.createWithOn(t,ii(e),ln(r,"=",n))}const Pc=h({is(t){return t.kind==="OffsetNode"},create(t){return h({kind:"OffsetNode",offset:Gt.create(t)})}}),Fc=h({is(t){return t.kind==="GroupByItemNode"},create(t){return h({kind:"GroupByItemNode",groupBy:t})}});function Lc(t){return t=It(t)?t(mr()):t,Jr(t).map(Fc.create)}const Ea=h({is(t){return t.kind==="SetOperationNode"},create(t,e,r){return h({kind:"SetOperationNode",operator:t,expression:e,all:r})}});function pr(t,e,r){return It(e)&&(e=e(qo())),wn(e)||(e=[e]),e.map(n=>Ea.create(t,yr(n),r))}const Oo=class Oo{constructor(e){Q(this,In,void 0);K(this,In,e)}get expressionType(){}as(e){return new mo(this,e)}or(...e){return new yo(ur.create(s(this,In),mt(e)))}and(...e){return new go(xn.create(s(this,In),mt(e)))}$castTo(){return new Oo(s(this,In))}toOperationNode(){return s(this,In)}};In=new WeakMap;let Ge=Oo;class mo{constructor(e,r){Q(this,Er,void 0);Q(this,On,void 0);K(this,Er,e),K(this,On,r)}get expression(){return s(this,Er)}get alias(){return s(this,On)}toOperationNode(){return Nn.create(s(this,Er).toOperationNode(),Wt(s(this,On))?s(this,On).toOperationNode():Ke.create(s(this,On)))}}Er=new WeakMap,On=new WeakMap;const ks=class ks{constructor(e){Q(this,Kn,void 0);K(this,Kn,e)}get expressionType(){}as(e){return new mo(this,e)}or(...e){return new ks(ur.create(s(this,Kn),mt(e)))}$castTo(){return new ks(s(this,Kn))}toOperationNode(){return dr.create(s(this,Kn))}};Kn=new WeakMap;let yo=ks;const Is=class Is{constructor(e){Q(this,Xn,void 0);K(this,Xn,e)}get expressionType(){}as(e){return new mo(this,e)}and(...e){return new Is(xn.create(s(this,Xn),mt(e)))}$castTo(){return new Is(s(this,Xn))}toOperationNode(){return dr.create(s(this,Xn))}};Xn=new WeakMap;let go=Is;const _e=class _e{constructor(e){Q(this,Y,void 0);K(this,Y,h(e))}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithWhere(s(this,Y).queryNode,mt(e))})}whereRef(e,r,n){return new _e({...s(this,Y),queryNode:Ne.cloneWithWhere(s(this,Y).queryNode,ln(e,r,n))})}having(...e){return new _e({...s(this,Y),queryNode:Ae.cloneWithHaving(s(this,Y).queryNode,mt(e))})}havingRef(e,r,n){return new _e({...s(this,Y),queryNode:Ae.cloneWithHaving(s(this,Y).queryNode,ln(e,r,n))})}select(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSelections(s(this,Y).queryNode,jn(e))})}distinctOn(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithDistinctOn(s(this,Y).queryNode,Jr(e))})}modifyFront(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithFrontModifier(s(this,Y).queryNode,on.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.createWithExpression(e.toOperationNode()))})}distinct(){return new _e({...s(this,Y),queryNode:Ae.cloneWithFrontModifier(s(this,Y).queryNode,on.create("Distinct"))})}forUpdate(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForUpdate"))})}forShare(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForShare"))})}forKeyShare(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForKeyShare"))})}forNoKeyUpdate(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("ForNoKeyUpdate"))})}skipLocked(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("SkipLocked"))})}noWait(){return new _e({...s(this,Y),queryNode:Ae.cloneWithEndModifier(s(this,Y).queryNode,on.create("NoWait"))})}selectAll(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSelections(s(this,Y).queryNode,Xr(e))})}innerJoin(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("InnerJoin",e))})}leftJoin(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("LeftJoin",e))})}rightJoin(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("RightJoin",e))})}fullJoin(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("FullJoin",e))})}innerJoinLateral(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("LateralInnerJoin",e))})}leftJoinLateral(...e){return new _e({...s(this,Y),queryNode:Ne.cloneWithJoin(s(this,Y).queryNode,St("LateralLeftJoin",e))})}orderBy(...e){return new _e({...s(this,Y),queryNode:Ae.cloneWithOrderByItems(s(this,Y).queryNode,Wi(e))})}groupBy(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithGroupByItems(s(this,Y).queryNode,Lc(e))})}limit(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithLimit(s(this,Y).queryNode,ya.create(e))})}offset(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithOffset(s(this,Y).queryNode,Pc.create(e))})}union(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("union",e,!1))})}unionAll(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("union",e,!0))})}intersect(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("intersect",e,!1))})}intersectAll(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("intersect",e,!0))})}except(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("except",e,!1))})}exceptAll(e){return new _e({...s(this,Y),queryNode:Ae.cloneWithSetOperations(s(this,Y).queryNode,pr("except",e,!0))})}as(e){return new Sa(this,e)}clearSelect(){return new _e({...s(this,Y),queryNode:Ae.cloneWithoutSelections(s(this,Y).queryNode)})}clearWhere(){return new _e({...s(this,Y),queryNode:Ne.cloneWithoutWhere(s(this,Y).queryNode)})}clearLimit(){return new _e({...s(this,Y),queryNode:Ae.cloneWithoutLimit(s(this,Y).queryNode)})}clearOffset(){return new _e({...s(this,Y),queryNode:Ae.cloneWithoutOffset(s(this,Y).queryNode)})}clearOrderBy(){return new _e({...s(this,Y),queryNode:Ae.cloneWithoutOrderBy(s(this,Y).queryNode)})}$call(e){return e(this)}$if(e,r){return e?r(this):new _e({...s(this,Y)})}$castTo(){return new _e(s(this,Y))}$narrowType(){return new _e(s(this,Y))}$assertType(){return new _e(s(this,Y))}$asTuple(){return new Ge(this.toOperationNode())}withPlugin(e){return new _e({...s(this,Y),executor:s(this,Y).executor.withPlugin(e)})}toOperationNode(){return s(this,Y).executor.transformQuery(s(this,Y).queryNode,s(this,Y).queryId)}compile(){return s(this,Y).executor.compileQuery(this.toOperationNode(),s(this,Y).queryId)}async execute(){const e=this.compile();return(await s(this,Y).executor.executeQuery(e,s(this,Y).queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=Qi){const r=await this.executeTakeFirst();if(r===void 0)throw Ui(e)?new e(this.toOperationNode()):e(this.toOperationNode());return r}async*stream(e=100){const r=this.compile(),n=s(this,Y).executor.stream(r,e,s(this,Y).queryId);for await(const S of n)yield*S.rows}async explain(e,r){return await new _e({...s(this,Y),queryNode:Ne.cloneWithExplain(s(this,Y).queryNode,e,r)}).execute()}};Y=new WeakMap;let Xi=_e;Ie(Xi,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");function Yi(t){return new Xi(t)}class Sa{constructor(e,r){Q(this,Sr,void 0);Q(this,Ar,void 0);K(this,Sr,e),K(this,Ar,r)}get expression(){return s(this,Sr)}get alias(){return s(this,Ar)}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return Nn.create(s(this,Sr).toOperationNode(),Ke.create(s(this,Ar)))}}Sr=new WeakMap,Ar=new WeakMap,Ie(Sa,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.");const _r=h({is(t){return t.kind==="AggregateFunctionNode"},create(t,e=[]){return h({kind:"AggregateFunctionNode",func:t,aggregated:e})},cloneWithDistinct(t){return h({...t,distinct:!0})},cloneWithFilter(t,e){return h({...t,filter:t.filter?Et.cloneWithOperation(t.filter,"And",e):Et.create(e)})},cloneWithOrFilter(t,e){return h({...t,filter:t.filter?Et.cloneWithOperation(t.filter,"Or",e):Et.create(e)})},cloneWithOver(t,e){return h({...t,over:e})}}),Wc=h({is(t){return t.kind==="FunctionNode"},create(t,e){return h({kind:"FunctionNode",func:t,arguments:e})}}),kr=class kr{constructor(e){Q(this,Tt,void 0);K(this,Tt,h(e))}get expressionType(){}as(e){return new Dc(this,e)}distinct(){return new kr({...s(this,Tt),aggregateFunctionNode:_r.cloneWithDistinct(s(this,Tt).aggregateFunctionNode)})}filterWhere(...e){return new kr({...s(this,Tt),aggregateFunctionNode:_r.cloneWithFilter(s(this,Tt).aggregateFunctionNode,mt(e))})}filterWhereRef(e,r,n){return new kr({...s(this,Tt),aggregateFunctionNode:_r.cloneWithFilter(s(this,Tt).aggregateFunctionNode,ln(e,r,n))})}over(e){const r=Oc();return new kr({...s(this,Tt),aggregateFunctionNode:_r.cloneWithOver(s(this,Tt).aggregateFunctionNode,(e?e(r):r).toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,Tt).aggregateFunctionNode}};Tt=new WeakMap;let ti=kr;Ie(ti,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class Dc{constructor(e,r){Q(this,Ir,void 0);Q(this,Or,void 0);K(this,Ir,e),K(this,Or,r)}get expression(){return s(this,Ir)}get alias(){return s(this,Or)}toOperationNode(){return Nn.create(s(this,Ir).toOperationNode(),Ke.create(s(this,Or)))}}Ir=new WeakMap,Or=new WeakMap;function Aa(){const t=(r,n)=>new Ge(Wc.create(r,Jr(n))),e=(r,n)=>new ti({aggregateFunctionNode:_r.create(r,n?Jr(n):void 0)});return Object.assign(t,{agg:e,avg(r){return e("avg",[r])},coalesce(r,...n){return t("coalesce",[r,...n])},count(r){return e("count",[r])},countAll(r){return new ti({aggregateFunctionNode:_r.create("count",Xr(r))})},max(r){return e("max",[r])},min(r){return e("min",[r])},sum(r){return e("sum",[r])},any(r){return t("any",[r])}})}const Rc=h({is(t){return t.kind==="UnaryOperationNode"},create(t,e){return h({kind:"UnaryOperationNode",operator:t,operand:e})}});function Mc(t,e){return Rc.create(Un.create(t),Qt(e))}const wo=h({is(t){return t.kind==="WhenNode"},create(t){return h({kind:"WhenNode",condition:t})},cloneWithResult(t,e){return h({...t,result:e})}}),Xt=h({is(t){return t.kind==="CaseNode"},create(t){return h({kind:"CaseNode",value:t})},cloneWithWhen(t,e){return h({...t,when:h(t.when?[...t.when,e]:[e])})},cloneWithThen(t,e){return h({...t,when:t.when?h([...t.when.slice(0,-1),wo.cloneWithResult(t.when[t.when.length-1],e)]):void 0})},cloneWith(t,e){return h({...t,...e})}});class ka{constructor(e){Q(this,Tr,void 0);K(this,Tr,h(e))}when(...e){return new Ia({...s(this,Tr),node:Xt.cloneWithWhen(s(this,Tr).node,wo.create(mt(e)))})}}Tr=new WeakMap;class Ia{constructor(e){Q(this,Cr,void 0);K(this,Cr,h(e))}then(e){return new Bc({...s(this,Cr),node:Xt.cloneWithThen(s(this,Cr).node,ao(e)?lo(e):bt(e))})}}Cr=new WeakMap;class Bc{constructor(e){Q(this,Yt,void 0);K(this,Yt,h(e))}when(...e){return new Ia({...s(this,Yt),node:Xt.cloneWithWhen(s(this,Yt).node,wo.create(mt(e)))})}else(e){return new Qc({...s(this,Yt),node:Xt.cloneWith(s(this,Yt).node,{else:ao(e)?lo(e):bt(e)})})}end(){return new Ge(Xt.cloneWith(s(this,Yt).node,{isStatement:!1}))}endCase(){return new Ge(Xt.cloneWith(s(this,Yt).node,{isStatement:!0}))}}Yt=new WeakMap;class Qc{constructor(e){Q(this,Pr,void 0);K(this,Pr,h(e))}end(){return new Ge(Xt.cloneWith(s(this,Pr).node,{isStatement:!1}))}endCase(){return new Ge(Xt.cloneWith(s(this,Pr).node,{isStatement:!0}))}}Pr=new WeakMap;const Uc=h({is(t){return t.kind==="JSONPathLegNode"},create(t,e){return h({kind:"JSONPathLegNode",type:t,value:e})}});class bo{constructor(e){Q(this,mi);Q(this,Tn,void 0);K(this,Tn,e)}at(e){return Ce(this,mi,zo).call(this,"ArrayLocation",e)}key(e){return Ce(this,mi,zo).call(this,"Member",e)}}Tn=new WeakMap,mi=new WeakSet,zo=function(e,r){return new jc(ro.cloneWithTraversal(s(this,Tn),io.is(s(this,Tn).traversal)?io.cloneWithLeg(s(this,Tn).traversal,Uc.create(e,r)):ea.cloneWithValue(s(this,Tn).traversal,Gt.createImmediate(r))))};class jc extends bo{constructor(r){super(r);Q(this,Fr,void 0);K(this,Fr,r)}get expressionType(){}as(r){return new zc(this,r)}$castTo(){return new bo(s(this,Fr))}toOperationNode(){return s(this,Fr)}}Fr=new WeakMap;class zc{constructor(e,r){Q(this,Lr,void 0);Q(this,Cn,void 0);K(this,Lr,e),K(this,Cn,r)}get expression(){return s(this,Lr)}get alias(){return s(this,Cn)}toOperationNode(){return Nn.create(s(this,Lr).toOperationNode(),Wt(s(this,Cn))?s(this,Cn).toOperationNode():Ke.create(s(this,Cn)))}}Lr=new WeakMap,Cn=new WeakMap;const Oa=h({is(t){return t.kind==="TupleNode"},create(t){return h({kind:"TupleNode",values:h(t)})}});function qo(t=_o){function e(S,R,te){return new Ge(Gr(S,R,te))}function r(S,R){return new Ge(Mc(S,R))}const n=Object.assign(e,{fn:void 0,eb:void 0,selectFrom(S){return Yi({queryId:Me(),executor:t,queryNode:Ae.createFrom(ri(S))})},selectNoFrom(S){return Yi({queryId:Me(),executor:t,queryNode:Ae.cloneWithSelections(Ae.create(),jn(S))})},case(S){return new ka({node:Xt.create(De(S)?void 0:Qt(S))})},ref(S,R){return De(R)?new Ge(an(S)):new bo(Zl(S,R))},val(S){return new Ge(sa(S))},refTuple(...S){return new Ge(Oa.create(S.map(Qt)))},tuple(...S){return new Ge(Oa.create(S.map(bt)))},lit(S){return new Ge(lo(S))},cmpr(S,R,te){return new Ge(Gr(S,R,te))},bxp(S,R,te){return new Ge(Gr(S,R,te))},unary:r,not(S){return r("not",S)},exists(S){return r("exists",S)},neg(S){return r("-",S)},between(S,R,te){return new Ge(Hr.create(Qt(S),Un.create("between"),xn.create(bt(R),bt(te))))},betweenSymmetric(S,R,te){return new Ge(Hr.create(Qt(S),Un.create("between symmetric"),xn.create(bt(R),bt(te))))},and(S){return wn(S)?new Ge(co(S,"and")):new Ge(oa(S,"and"))},or(S){return wn(S)?new Ge(co(S,"or")):new Ge(oa(S,"or"))},parens(...S){const R=mt(S);return dr.is(R)?new Ge(R):new Ge(dr.create(R))},withSchema(S){return qo(t.withPluginAtFront(new ei(S)))}});return n.fn=Aa(),n.eb=n,n}function mr(t){return qo()}function yr(t){if(Wt(t))return t.toOperationNode();if(It(t))return t(mr()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(t)}`)}function Ta(t){if(Wt(t))return t.toOperationNode();if(It(t))return t(mr()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(t)}`)}function ni(t){return zl(t)||Vl(t)||It(t)}function ri(t){return wn(t)?t.map(e=>ii(e)):[ii(t)]}function ii(t){return Oe(t)?Vc(t):Ta(t)}function Vc(t){const e=" as ";if(t.includes(e)){const[r,n]=t.split(e).map(Ca);return Nn.create(At(r),Ke.create(n))}else return At(t)}function At(t){const e=".";if(t.includes(e)){const[r,n]=t.split(e).map(Ca);return vn.createWithSchema(r,n)}else return vn.create(t)}function Ca(t){return t.trim()}const Pa=h({is(t){return t.kind==="AddColumnNode"},create(t){return h({kind:"AddColumnNode",column:t})}}),nt=h({is(t){return t.kind==="ColumnDefinitionNode"},create(t,e){return h({kind:"ColumnDefinitionNode",column:tt.create(t),dataType:e})},cloneWithFrontModifier(t,e){return h({...t,frontModifiers:t.frontModifiers?h([...t.frontModifiers,e]):[e]})},cloneWithEndModifier(t,e){return h({...t,endModifiers:t.endModifiers?h([...t.endModifiers,e]):[e]})},cloneWith(t,e){return h({...t,...e})}}),Fa=h({is(t){return t.kind==="DropColumnNode"},create(t){return h({kind:"DropColumnNode",column:tt.create(t)})}}),La=h({is(t){return t.kind==="RenameColumnNode"},create(t,e){return h({kind:"RenameColumnNode",column:tt.create(t),renameTo:tt.create(e)})}}),No=h({is(t){return t.kind==="CheckConstraintNode"},create(t,e){return h({kind:"CheckConstraintNode",expression:t,name:e?Ke.create(e):void 0})}}),$c=["no action","restrict","cascade","set null","set default"],Zi=h({is(t){return t.kind==="ReferencesNode"},create(t,e){return h({kind:"ReferencesNode",table:t,columns:h([...e])})},cloneWithOnDelete(t,e){return h({...t,onDelete:e})},cloneWithOnUpdate(t,e){return h({...t,onUpdate:e})}});function Wa(t){return Wt(t)?t.toOperationNode():Gt.createImmediate(t)}const es=h({is(t){return t.kind==="GeneratedNode"},create(t){return h({kind:"GeneratedNode",...t})},createWithExpression(t){return h({kind:"GeneratedNode",always:!0,expression:t})},cloneWith(t,e){return h({...t,...e})}}),Hc=h({is(t){return t.kind==="DefaultValueNode"},create(t){return h({kind:"DefaultValueNode",defaultValue:t})}});function ts(t){if($c.includes(t))return t;throw new Error(`invalid OnModifyForeignAction ${t}`)}const ct=class ct{constructor(e){Q(this,Ue,void 0);K(this,Ue,e)}autoIncrement(){return new ct(nt.cloneWith(s(this,Ue),{autoIncrement:!0}))}primaryKey(){return new ct(nt.cloneWith(s(this,Ue),{primaryKey:!0}))}references(e){const r=an(e);if(!r.table||eo.is(r.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new ct(nt.cloneWith(s(this,Ue),{references:Zi.create(r.table,[r.column])}))}onDelete(e){if(!s(this,Ue).references)throw new Error("on delete constraint can only be added for foreign keys");return new ct(nt.cloneWith(s(this,Ue),{references:Zi.cloneWithOnDelete(s(this,Ue).references,ts(e))}))}onUpdate(e){if(!s(this,Ue).references)throw new Error("on update constraint can only be added for foreign keys");return new ct(nt.cloneWith(s(this,Ue),{references:Zi.cloneWithOnUpdate(s(this,Ue).references,ts(e))}))}unique(){return new ct(nt.cloneWith(s(this,Ue),{unique:!0}))}notNull(){return new ct(nt.cloneWith(s(this,Ue),{notNull:!0}))}unsigned(){return new ct(nt.cloneWith(s(this,Ue),{unsigned:!0}))}defaultTo(e){return new ct(nt.cloneWith(s(this,Ue),{defaultTo:Hc.create(Wa(e))}))}check(e){return new ct(nt.cloneWith(s(this,Ue),{check:No.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new ct(nt.cloneWith(s(this,Ue),{generated:es.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new ct(nt.cloneWith(s(this,Ue),{generated:es.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new ct(nt.cloneWith(s(this,Ue),{generated:es.create({identity:!0,byDefault:!0})}))}stored(){if(!s(this,Ue).generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new ct(nt.cloneWith(s(this,Ue),{generated:es.cloneWith(s(this,Ue).generated,{stored:!0})}))}modifyFront(e){return new ct(nt.cloneWithFrontModifier(s(this,Ue),e.toOperationNode()))}modifyEnd(e){return new ct(nt.cloneWithEndModifier(s(this,Ue),e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return s(this,Ue)}};Ue=new WeakMap;let En=ct;Ie(En,"don't await ColumnDefinitionBuilder instances directly.");const Da=h({is(t){return t.kind==="ModifyColumnNode"},create(t){return h({kind:"ModifyColumnNode",column:t})}}),Jc=h({is(t){return t.kind==="DataTypeNode"},create(t){return h({kind:"DataTypeNode",dataType:t})}});function gr(t){return Wt(t)?t.toOperationNode():Jc.create(t)}const ns=h({is(t){return t.kind==="ForeignKeyConstraintNode"},create(t,e,r,n){return h({kind:"ForeignKeyConstraintNode",columns:t,references:Zi.create(e,r),name:n?Ke.create(n):void 0})},cloneWith(t,e){return h({...t,...e})}}),Os=class Os{constructor(e){Q(this,Yn,void 0);K(this,Yn,e)}onDelete(e){return new Os(ns.cloneWith(s(this,Yn),{onDelete:ts(e)}))}onUpdate(e){return new Os(ns.cloneWith(s(this,Yn),{onUpdate:ts(e)}))}$call(e){return e(this)}toOperationNode(){return s(this,Yn)}};Yn=new WeakMap;let si=Os;Ie(si,"don't await ForeignKeyConstraintBuilder instances directly.");const rs=h({is(t){return t.kind==="AddConstraintNode"},create(t){return h({kind:"AddConstraintNode",constraint:t})}}),Ra=h({is(t){return t.kind==="UniqueConstraintNode"},create(t,e){return h({kind:"UniqueConstraintNode",columns:h(t.map(tt.create)),name:e?Ke.create(e):void 0})}}),is=h({is(t){return t.kind==="DropConstraintNode"},create(t){return h({kind:"DropConstraintNode",constraintName:Ke.create(t)})},cloneWith(t,e){return h({...t,...e})}}),oi=h({is(t){return t.kind==="AlterColumnNode"},create(t,e,r){return h({kind:"AlterColumnNode",column:tt.create(t),[e]:r})}});class vo{constructor(e){Q(this,fn,void 0);K(this,fn,e)}setDataType(e){return new ai(oi.create(s(this,fn),"dataType",gr(e)))}setDefault(e){return new ai(oi.create(s(this,fn),"setDefault",Wa(e)))}dropDefault(){return new ai(oi.create(s(this,fn),"dropDefault",!0))}setNotNull(){return new ai(oi.create(s(this,fn),"setNotNull",!0))}dropNotNull(){return new ai(oi.create(s(this,fn),"dropNotNull",!0))}$call(e){return e(this)}}fn=new WeakMap;class ai{constructor(e){Q(this,yi,void 0);K(this,yi,e)}toOperationNode(){return s(this,yi)}}yi=new WeakMap;class wr{constructor(e){Q(this,zt,void 0);K(this,zt,h(e))}toOperationNode(){return s(this,zt).executor.transformQuery(s(this,zt).node,s(this,zt).queryId)}compile(){return s(this,zt).executor.compileQuery(this.toOperationNode(),s(this,zt).queryId)}async execute(){await s(this,zt).executor.executeQuery(this.compile(),s(this,zt).queryId)}}zt=new WeakMap,Ie(wr,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");const Ts=class Ts{constructor(e){Q(this,gt,void 0);K(this,gt,h(e))}onDelete(e){return new Ts({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onDelete(e)})}onUpdate(e){return new Ts({...s(this,gt),constraintBuilder:s(this,gt).constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return s(this,gt).executor.transformQuery(et.cloneWithTableProps(s(this,gt).node,{addConstraint:rs.create(s(this,gt).constraintBuilder.toOperationNode())}),s(this,gt).queryId)}compile(){return s(this,gt).executor.compileQuery(this.toOperationNode(),s(this,gt).queryId)}async execute(){await s(this,gt).executor.executeQuery(this.compile(),s(this,gt).queryId)}};gt=new WeakMap;let ss=Ts;Ie(ss,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");const gi=class gi{constructor(e){Q(this,ot,void 0);K(this,ot,h(e))}ifExists(){return new gi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:is.cloneWith(s(this,ot).node.dropConstraint,{ifExists:!0})})})}cascade(){return new gi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:is.cloneWith(s(this,ot).node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new gi({...s(this,ot),node:et.cloneWithTableProps(s(this,ot).node,{dropConstraint:is.cloneWith(s(this,ot).node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return s(this,ot).executor.transformQuery(s(this,ot).node,s(this,ot).queryId)}compile(){return s(this,ot).executor.compileQuery(this.toOperationNode(),s(this,ot).queryId)}async execute(){await s(this,ot).executor.executeQuery(this.compile(),s(this,ot).queryId)}};ot=new WeakMap;let os=gi;Ie(os,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const Ma=h({is(t){return t.kind==="PrimaryKeyConstraintNode"},create(t,e){return h({kind:"PrimaryKeyConstraintNode",columns:h(t.map(tt.create)),name:e?Ke.create(e):void 0})}});class Ba{constructor(e){Q(this,je,void 0);K(this,je,h(e))}renameTo(e){return new wr({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{renameTo:At(e)})})}setSchema(e){return new wr({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{setSchema:Ke.create(e)})})}alterColumn(e,r){const n=r(new vo(e));return new Sn({...s(this,je),node:et.cloneWithColumnAlteration(s(this,je).node,n.toOperationNode())})}dropColumn(e){return new Sn({...s(this,je),node:et.cloneWithColumnAlteration(s(this,je).node,Fa.create(e))})}renameColumn(e,r){return new Sn({...s(this,je),node:et.cloneWithColumnAlteration(s(this,je).node,La.create(e,r))})}addColumn(e,r,n=cr){const S=n(new En(nt.create(e,gr(r))));return new Sn({...s(this,je),node:et.cloneWithColumnAlteration(s(this,je).node,Pa.create(S.toOperationNode()))})}modifyColumn(e,r,n=cr){const S=n(new En(nt.create(e,gr(r))));return new Sn({...s(this,je),node:et.cloneWithColumnAlteration(s(this,je).node,Da.create(S.toOperationNode()))})}addUniqueConstraint(e,r){return new wr({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{addConstraint:rs.create(Ra.create(r,e))})})}addCheckConstraint(e,r){return new wr({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{addConstraint:rs.create(No.create(r.toOperationNode(),e))})})}addForeignKeyConstraint(e,r,n,S){return new ss({...s(this,je),constraintBuilder:new si(ns.create(r.map(tt.create),At(n),S.map(tt.create),e))})}addPrimaryKeyConstraint(e,r){return new wr({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{addConstraint:rs.create(Ma.create(r,e))})})}dropConstraint(e){return new os({...s(this,je),node:et.cloneWithTableProps(s(this,je).node,{dropConstraint:is.create(e)})})}$call(e){return e(this)}}je=new WeakMap;const Zn=class Zn{constructor(e){Q(this,rt,void 0);K(this,rt,h(e))}alterColumn(e,r){const n=r(new vo(e));return new Zn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,n.toOperationNode())})}dropColumn(e){return new Zn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Fa.create(e))})}renameColumn(e,r){return new Zn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,La.create(e,r))})}addColumn(e,r,n=cr){const S=n(new En(nt.create(e,gr(r))));return new Zn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Pa.create(S.toOperationNode()))})}modifyColumn(e,r,n=cr){const S=n(new En(nt.create(e,gr(r))));return new Zn({...s(this,rt),node:et.cloneWithColumnAlteration(s(this,rt).node,Da.create(S.toOperationNode()))})}toOperationNode(){return s(this,rt).executor.transformQuery(s(this,rt).node,s(this,rt).queryId)}compile(){return s(this,rt).executor.compileQuery(this.toOperationNode(),s(this,rt).queryId)}async execute(){await s(this,rt).executor.executeQuery(this.compile(),s(this,rt).queryId)}};rt=new WeakMap;let Sn=Zn;Ie(Ba,"don't await AlterTableBuilder instances"),Ie(vo,"don't await AlterColumnBuilder instances"),Ie(Sn,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");class Qa extends po{transformValue(e){return{...super.transformValue(e),immediate:!0}}}const Zt=class Zt{constructor(e){Q(this,ze,void 0);K(this,ze,h(e))}ifNotExists(){return new Zt({...s(this,ze),node:bn.cloneWith(s(this,ze).node,{ifNotExists:!0})})}unique(){return new Zt({...s(this,ze),node:bn.cloneWith(s(this,ze).node,{unique:!0})})}on(e){return new Zt({...s(this,ze),node:bn.cloneWith(s(this,ze).node,{table:At(e)})})}column(e){return new Zt({...s(this,ze),node:bn.cloneWithColumns(s(this,ze).node,[ra(e)])})}columns(e){return new Zt({...s(this,ze),node:bn.cloneWithColumns(s(this,ze).node,e.map(ra))})}expression(e){return new Zt({...s(this,ze),node:bn.cloneWithColumns(s(this,ze).node,[e.toOperationNode()])})}using(e){return new Zt({...s(this,ze),node:bn.cloneWith(s(this,ze).node,{using:wt.createWithSql(e)})})}where(...e){const r=new Qa;return new Zt({...s(this,ze),node:Ne.cloneWithWhere(s(this,ze).node,r.transformNode(mt(e)))})}$call(e){return e(this)}toOperationNode(){return s(this,ze).executor.transformQuery(s(this,ze).node,s(this,ze).queryId)}compile(){return s(this,ze).executor.compileQuery(this.toOperationNode(),s(this,ze).queryId)}async execute(){await s(this,ze).executor.executeQuery(this.compile(),s(this,ze).queryId)}};ze=new WeakMap;let as=Zt;Ie(as,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");const To=class To{constructor(e){Q(this,Ct,void 0);K(this,Ct,h(e))}ifNotExists(){return new To({...s(this,Ct),node:Jo.cloneWith(s(this,Ct).node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Ct).executor.transformQuery(s(this,Ct).node,s(this,Ct).queryId)}compile(){return s(this,Ct).executor.compileQuery(this.toOperationNode(),s(this,Ct).queryId)}async execute(){await s(this,Ct).executor.executeQuery(this.compile(),s(this,Ct).queryId)}};Ct=new WeakMap;let ls=To;Ie(ls,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");function Gc(t){if(jl.includes(t))return t;throw new Error(`invalid OnCommitAction ${t}`)}const Dt=class Dt{constructor(e){Q(this,Fe,void 0);K(this,Fe,h(e))}temporary(){return new Dt({...s(this,Fe),node:Bt.cloneWith(s(this,Fe).node,{temporary:!0})})}onCommit(e){return new Dt({...s(this,Fe),node:Bt.cloneWith(s(this,Fe).node,{onCommit:Gc(e)})})}ifNotExists(){return new Dt({...s(this,Fe),node:Bt.cloneWith(s(this,Fe).node,{ifNotExists:!0})})}addColumn(e,r,n=cr){const S=n(new En(nt.create(e,gr(r))));return new Dt({...s(this,Fe),node:Bt.cloneWithColumn(s(this,Fe).node,S.toOperationNode())})}addPrimaryKeyConstraint(e,r){return new Dt({...s(this,Fe),node:Bt.cloneWithConstraint(s(this,Fe).node,Ma.create(r,e))})}addUniqueConstraint(e,r){return new Dt({...s(this,Fe),node:Bt.cloneWithConstraint(s(this,Fe).node,Ra.create(r,e))})}addCheckConstraint(e,r){return new Dt({...s(this,Fe),node:Bt.cloneWithConstraint(s(this,Fe).node,No.create(r.toOperationNode(),e))})}addForeignKeyConstraint(e,r,n,S,R=cr){const te=R(new si(ns.create(r.map(tt.create),At(n),S.map(tt.create),e)));return new Dt({...s(this,Fe),node:Bt.cloneWithConstraint(s(this,Fe).node,te.toOperationNode())})}modifyFront(e){return new Dt({...s(this,Fe),node:Bt.cloneWithFrontModifier(s(this,Fe).node,e.toOperationNode())})}modifyEnd(e){return new Dt({...s(this,Fe),node:Bt.cloneWithEndModifier(s(this,Fe).node,e.toOperationNode())})}$call(e){return e(this)}toOperationNode(){return s(this,Fe).executor.transformQuery(s(this,Fe).node,s(this,Fe).queryId)}compile(){return s(this,Fe).executor.compileQuery(this.toOperationNode(),s(this,Fe).queryId)}async execute(){await s(this,Fe).executor.executeQuery(this.compile(),s(this,Fe).queryId)}};Fe=new WeakMap;let cs=Dt;Ie(cs,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");const wi=class wi{constructor(e){Q(this,ft,void 0);K(this,ft,h(e))}on(e){return new wi({...s(this,ft),node:Fi.cloneWith(s(this,ft).node,{table:At(e)})})}ifExists(){return new wi({...s(this,ft),node:Fi.cloneWith(s(this,ft).node,{ifExists:!0})})}cascade(){return new wi({...s(this,ft),node:Fi.cloneWith(s(this,ft).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ft).executor.transformQuery(s(this,ft).node,s(this,ft).queryId)}compile(){return s(this,ft).executor.compileQuery(this.toOperationNode(),s(this,ft).queryId)}async execute(){await s(this,ft).executor.executeQuery(this.compile(),s(this,ft).queryId)}};ft=new WeakMap;let us=wi;Ie(us,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");const Cs=class Cs{constructor(e){Q(this,qt,void 0);K(this,qt,h(e))}ifExists(){return new Cs({...s(this,qt),node:Xs.cloneWith(s(this,qt).node,{ifExists:!0})})}cascade(){return new Cs({...s(this,qt),node:Xs.cloneWith(s(this,qt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,qt).executor.transformQuery(s(this,qt).node,s(this,qt).queryId)}compile(){return s(this,qt).executor.compileQuery(this.toOperationNode(),s(this,qt).queryId)}async execute(){await s(this,qt).executor.executeQuery(this.compile(),s(this,qt).queryId)}};qt=new WeakMap;let ds=Cs;Ie(ds,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");const Ps=class Ps{constructor(e){Q(this,Nt,void 0);K(this,Nt,h(e))}ifExists(){return new Ps({...s(this,Nt),node:Ys.cloneWith(s(this,Nt).node,{ifExists:!0})})}cascade(){return new Ps({...s(this,Nt),node:Ys.cloneWith(s(this,Nt).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Nt).executor.transformQuery(s(this,Nt).node,s(this,Nt).queryId)}compile(){return s(this,Nt).executor.compileQuery(this.toOperationNode(),s(this,Nt).queryId)}async execute(){await s(this,Nt).executor.executeQuery(this.compile(),s(this,Nt).queryId)}};Nt=new WeakMap;let fs=Ps;Ie(fs,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");const An=h({is(t){return t.kind==="CreateViewNode"},create(t){return h({kind:"CreateViewNode",name:qn.create(t)})},cloneWith(t,e){return h({...t,...e})}});class Kc{constructor(){Q(this,Fs,new Qa)}transformQuery(e){return s(this,Fs).transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}Fs=new WeakMap;const Pn=class Pn{constructor(e){Q(this,Xe,void 0);K(this,Xe,h(e))}temporary(){return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{temporary:!0})})}materialized(){return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{materialized:!0})})}ifNotExists(){return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{ifNotExists:!0})})}orReplace(){return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{orReplace:!0})})}columns(e){return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{columns:e.map(na)})})}as(e){const r=e.withPlugin(new Kc).toOperationNode();return new Pn({...s(this,Xe),node:An.cloneWith(s(this,Xe).node,{as:r})})}$call(e){return e(this)}toOperationNode(){return s(this,Xe).executor.transformQuery(s(this,Xe).node,s(this,Xe).queryId)}compile(){return s(this,Xe).executor.compileQuery(this.toOperationNode(),s(this,Xe).queryId)}async execute(){await s(this,Xe).executor.executeQuery(this.compile(),s(this,Xe).queryId)}};Xe=new WeakMap;let hs=Pn;Ie(hs,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const ps=h({is(t){return t.kind==="DropViewNode"},create(t){return h({kind:"DropViewNode",name:qn.create(t)})},cloneWith(t,e){return h({...t,...e})}}),bi=class bi{constructor(e){Q(this,ht,void 0);K(this,ht,h(e))}materialized(){return new bi({...s(this,ht),node:ps.cloneWith(s(this,ht).node,{materialized:!0})})}ifExists(){return new bi({...s(this,ht),node:ps.cloneWith(s(this,ht).node,{ifExists:!0})})}cascade(){return new bi({...s(this,ht),node:ps.cloneWith(s(this,ht).node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,ht).executor.transformQuery(s(this,ht).node,s(this,ht).queryId)}compile(){return s(this,ht).executor.compileQuery(this.toOperationNode(),s(this,ht).queryId)}async execute(){await s(this,ht).executor.executeQuery(this.compile(),s(this,ht).queryId)}};ht=new WeakMap;let _s=bi;Ie(_s,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");const Ua=h({is(t){return t.kind==="CreateTypeNode"},create(t){return h({kind:"CreateTypeNode",name:t})},cloneWithEnum(t,e){return h({...t,enum:oo.create(e.map(r=>Gt.createImmediate(r)))})}}),Co=class Co{constructor(e){Q(this,Pt,void 0);K(this,Pt,h(e))}toOperationNode(){return s(this,Pt).executor.transformQuery(s(this,Pt).node,s(this,Pt).queryId)}asEnum(e){return new Co({...s(this,Pt),node:Ua.cloneWithEnum(s(this,Pt).node,e)})}$call(e){return e(this)}compile(){return s(this,Pt).executor.compileQuery(this.toOperationNode(),s(this,Pt).queryId)}async execute(){await s(this,Pt).executor.executeQuery(this.compile(),s(this,Pt).queryId)}};Pt=new WeakMap;let ms=Co;Ie(ms,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const ja=h({is(t){return t.kind==="DropTypeNode"},create(t){return h({kind:"DropTypeNode",name:t})},cloneWith(t,e){return h({...t,...e})}}),Po=class Po{constructor(e){Q(this,Ft,void 0);K(this,Ft,h(e))}ifExists(){return new Po({...s(this,Ft),node:ja.cloneWith(s(this,Ft).node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return s(this,Ft).executor.transformQuery(s(this,Ft).node,s(this,Ft).queryId)}compile(){return s(this,Ft).executor.compileQuery(this.toOperationNode(),s(this,Ft).queryId)}async execute(){await s(this,Ft).executor.executeQuery(this.compile(),s(this,Ft).queryId)}};Ft=new WeakMap;let ys=Po;Ie(ys,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");function za(t){const e=".";if(t.includes(e)){const r=t.split(e).map(Xc);if(r.length===2)return qn.createWithSchema(r[0],r[1]);throw new Error(`invalid schemable identifier ${t}`)}else return qn.create(t)}function Xc(t){return t.trim()}const qi=class qi{constructor(e){Q(this,ut,void 0);K(this,ut,e)}createTable(e){return new cs({queryId:Me(),executor:s(this,ut),node:Bt.create(At(e))})}dropTable(e){return new fs({queryId:Me(),executor:s(this,ut),node:Ys.create(At(e))})}createIndex(e){return new as({queryId:Me(),executor:s(this,ut),node:bn.create(e)})}dropIndex(e){return new us({queryId:Me(),executor:s(this,ut),node:Fi.create(e)})}createSchema(e){return new ls({queryId:Me(),executor:s(this,ut),node:Jo.create(e)})}dropSchema(e){return new ds({queryId:Me(),executor:s(this,ut),node:Xs.create(e)})}alterTable(e){return new Ba({queryId:Me(),executor:s(this,ut),node:et.create(At(e))})}createView(e){return new hs({queryId:Me(),executor:s(this,ut),node:An.create(e)})}dropView(e){return new _s({queryId:Me(),executor:s(this,ut),node:ps.create(e)})}createType(e){return new ms({queryId:Me(),executor:s(this,ut),node:Ua.create(za(e))})}dropType(e){return new ys({queryId:Me(),executor:s(this,ut),node:ja.create(za(e))})}withPlugin(e){return new qi(s(this,ut).withPlugin(e))}withoutPlugins(){return new qi(s(this,ut).withoutPlugins())}withSchema(e){return new qi(s(this,ut).withPluginAtFront(new ei(e)))}};ut=new WeakMap;let xo=qi;class Yc{ref(e){return new Xl(e)}}class Zc{constructor(e){Q(this,Wr,void 0);K(this,Wr,e)}async provideConnection(e){const r=await s(this,Wr).acquireConnection();try{return await e(r)}finally{await s(this,Wr).releaseConnection(r)}}}Wr=new WeakMap;const er=class er extends xa{constructor(r,n,S,R=[]){super(R);Q(this,en,void 0);Q(this,tn,void 0);Q(this,hn,void 0);K(this,en,r),K(this,tn,n),K(this,hn,S)}get adapter(){return s(this,tn)}compileQuery(r){return s(this,en).compileQuery(r)}provideConnection(r){return s(this,hn).provideConnection(r)}withPlugins(r){return new er(s(this,en),s(this,tn),s(this,hn),[...this.plugins,...r])}withPlugin(r){return new er(s(this,en),s(this,tn),s(this,hn),[...this.plugins,r])}withPluginAtFront(r){return new er(s(this,en),s(this,tn),s(this,hn),[r,...this.plugins])}withConnectionProvider(r){return new er(s(this,en),s(this,tn),r,[...this.plugins])}withoutPlugins(){return new er(s(this,en),s(this,tn),s(this,hn),[])}};en=new WeakMap,tn=new WeakMap,hn=new WeakMap;let Eo=er;function Va(){return typeof performance<"u"&&It(performance.now)?performance.now():Date.now()}class eu{constructor(e,r){Q(this,Ls);Q(this,Ws);Q(this,Ds);Q(this,Rs);Q(this,vi);Q(this,Vt,void 0);Q(this,Fn,void 0);Q(this,pn,void 0);Q(this,Dr,void 0);Q(this,_n,void 0);Q(this,Ni,new WeakSet);K(this,Dr,!1),K(this,Vt,e),K(this,Fn,r)}async init(){if(s(this,_n))throw new Error("driver has already been destroyed");s(this,pn)||K(this,pn,s(this,Vt).init().then(()=>{K(this,Dr,!0)}).catch(e=>(K(this,pn,void 0),Promise.reject(e)))),await s(this,pn)}async acquireConnection(){if(s(this,_n))throw new Error("driver has already been destroyed");s(this,Dr)||await this.init();const e=await s(this,Vt).acquireConnection();return s(this,Ni).has(e)||(Ce(this,Ls,Ll).call(this)&&Ce(this,Ws,Wl).call(this,e),s(this,Ni).add(e)),e}async releaseConnection(e){await s(this,Vt).releaseConnection(e)}beginTransaction(e,r){return s(this,Vt).beginTransaction(e,r)}commitTransaction(e){return s(this,Vt).commitTransaction(e)}rollbackTransaction(e){return s(this,Vt).rollbackTransaction(e)}async destroy(){s(this,pn)&&(await s(this,pn),s(this,_n)||K(this,_n,s(this,Vt).destroy().catch(e=>(K(this,_n,void 0),Promise.reject(e)))),await s(this,_n))}}Vt=new WeakMap,Fn=new WeakMap,pn=new WeakMap,Dr=new WeakMap,_n=new WeakMap,Ni=new WeakMap,Ls=new WeakSet,Ll=function(){return s(this,Fn).isLevelEnabled("query")||s(this,Fn).isLevelEnabled("error")},Ws=new WeakSet,Wl=function(e){const r=e.executeQuery;e.executeQuery=async n=>{const S=Va();try{return await r.call(e,n)}catch(R){throw await Ce(this,Ds,Dl).call(this,R,n,S),R}finally{await Ce(this,Rs,Rl).call(this,n,S)}}},Ds=new WeakSet,Dl=async function(e,r,n){await s(this,Fn).error(()=>({level:"error",error:e,query:r,queryDurationMillis:Ce(this,vi,Vo).call(this,n)}))},Rs=new WeakSet,Rl=async function(e,r){await s(this,Fn).query(()=>({level:"query",query:e,queryDurationMillis:Ce(this,vi,Vo).call(this,r)}))},vi=new WeakSet,Vo=function(e){return Va()-e};class $a{constructor(e){Q(this,Ms);Q(this,xi,void 0);Q(this,Ln,void 0);K(this,xi,e)}async provideConnection(e){for(;s(this,Ln);)await s(this,Ln);const r=Ce(this,Ms,Ml).call(this,e);return K(this,Ln,r.then(()=>{K(this,Ln,void 0)}).catch(()=>{K(this,Ln,void 0)})),r}}xi=new WeakMap,Ln=new WeakMap,Ms=new WeakSet,Ml=async function(e){return await e(s(this,xi))};const tu=["read uncommitted","read committed","repeatable read","serializable"];h(["query","error"]);class nu{constructor(e){Q(this,Wn,void 0);Q(this,tr,void 0);It(e)?(K(this,tr,e),K(this,Wn,h({query:!0,error:!0}))):(K(this,tr,ru),K(this,Wn,h({query:e.includes("query"),error:e.includes("error")})))}isLevelEnabled(e){return s(this,Wn)[e]}async query(e){s(this,Wn).query&&await s(this,tr).call(this,e())}async error(e){s(this,Wn).error&&await s(this,tr).call(this,e())}}Wn=new WeakMap,tr=new WeakMap;function ru(t){t.level==="query"?(console.log(`kysely:query: ${t.query.sql}`),console.log(`kysely:query: duration: ${t.queryDurationMillis.toFixed(1)}ms`)):t.level==="error"&&(t.error instanceof Error?console.error(`kysely:error: ${t.error.stack??t.error.message}`):console.error(`kysely:error: ${t}`))}function iu(t){return Jt(t)&&It(t.compile)}const Rr=class Rr extends Ki{constructor(r){let n,S;if(su(r))n={executor:r.executor},S={...r};else{const R=r.dialect,te=R.createDriver(),fe=R.createQueryCompiler(),Te=R.createAdapter(),Ye=new nu(r.log??[]),Le=new eu(te,Ye),Ve=new Zc(Le),We=new Eo(fe,Te,Ve,r.plugins??[]);n={executor:We},S={config:r,executor:We,dialect:R,driver:Le}}super(n);Q(this,pt,void 0);K(this,pt,h(S))}get schema(){return new xo(s(this,pt).executor)}get dynamic(){return new Yc}get introspection(){return s(this,pt).dialect.createIntrospector(this.withoutPlugins())}case(r){return new ka({node:Xt.create(De(r)?void 0:yr(r))})}get fn(){return Aa()}transaction(){return new gs({...s(this,pt)})}connection(){return new Ha({...s(this,pt)})}withPlugin(r){return new Rr({...s(this,pt),executor:s(this,pt).executor.withPlugin(r)})}withoutPlugins(){return new Rr({...s(this,pt),executor:s(this,pt).executor.withoutPlugins()})}withSchema(r){return new Rr({...s(this,pt),executor:s(this,pt).executor.withPluginAtFront(new ei(r))})}withTables(){return new Rr({...s(this,pt)})}async destroy(){await s(this,pt).driver.destroy()}get isTransaction(){return!1}getExecutor(){return s(this,pt).executor}executeQuery(r,n=Me()){const S=iu(r)?r.compile():r;return this.getExecutor().executeQuery(S,n)}};pt=new WeakMap;let li=Rr;const Mr=class Mr extends li{constructor(r){super(r);Q(this,$t,void 0);K(this,$t,r)}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(r){return new Mr({...s(this,$t),executor:s(this,$t).executor.withPlugin(r)})}withoutPlugins(){return new Mr({...s(this,$t),executor:s(this,$t).executor.withoutPlugins()})}withSchema(r){return new Mr({...s(this,$t),executor:s(this,$t).executor.withPluginAtFront(new ei(r))})}withTables(){return new Mr({...s(this,$t)})}};$t=new WeakMap;let So=Mr;function su(t){return Jt(t)&&Jt(t.config)&&Jt(t.driver)&&Jt(t.executor)&&Jt(t.dialect)}class Ha{constructor(e){Q(this,nr,void 0);K(this,nr,h(e))}async execute(e){return s(this,nr).executor.provideConnection(async r=>{const n=s(this,nr).executor.withConnectionProvider(new $a(r)),S=new li({...s(this,nr),executor:n});return await e(S)})}}nr=new WeakMap,Ie(Ha,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");const Fo=class Fo{constructor(e){Q(this,Ht,void 0);K(this,Ht,h(e))}setIsolationLevel(e){return new Fo({...s(this,Ht),isolationLevel:e})}async execute(e){const{isolationLevel:r,...n}=s(this,Ht),S={isolationLevel:r};return ou(S),s(this,Ht).executor.provideConnection(async R=>{const te=s(this,Ht).executor.withConnectionProvider(new $a(R)),fe=new So({...n,executor:te});try{await s(this,Ht).driver.beginTransaction(R,S);const Te=await e(fe);return await s(this,Ht).driver.commitTransaction(R),Te}catch(Te){throw await s(this,Ht).driver.rollbackTransaction(R),Te}})}};Ht=new WeakMap;let gs=Fo;Ie(gs,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");function ou(t){if(t.isolationLevel&&!tu.includes(t.isolationLevel))throw new Error(`invalid transaction isolation level ${t.isolationLevel}`)}const Bs=class Bs{constructor(e){Q(this,Br);Q(this,Ei);Q(this,Si);Q(this,kt,void 0);K(this,kt,h(e))}get expressionType(){}get isRawBuilder(){return!0}as(e){return new Ja(this,e)}$castTo(){return new Bs({...s(this,kt)})}withPlugin(e){return new Bs({...s(this,kt),plugins:s(this,kt).plugins!==void 0?h([...s(this,kt).plugins,e]):h([e])})}toOperationNode(){return Ce(this,Ei,$o).call(this,Ce(this,Br,Js).call(this))}compile(e){return Ce(this,Si,Ho).call(this,Ce(this,Br,Js).call(this,e))}async execute(e){const r=Ce(this,Br,Js).call(this,e);return r.executeQuery(Ce(this,Si,Ho).call(this,r),s(this,kt).queryId)}};kt=new WeakMap,Br=new WeakSet,Js=function(e){const r=e!==void 0?e.getExecutor():_o;return s(this,kt).plugins!==void 0?r.withPlugins(s(this,kt).plugins):r},Ei=new WeakSet,$o=function(e){return e.transformQuery(s(this,kt).rawNode,s(this,kt).queryId)},Si=new WeakSet,Ho=function(e){return e.compileQuery(Ce(this,Ei,$o).call(this,e),s(this,kt).queryId)};let ws=Bs;function kn(t){return new ws(t)}Ie(ws,"don't await RawBuilder instances directly. To execute the query you need to call `execute`");class Ja{constructor(e,r){Q(this,rr,void 0);Q(this,Dn,void 0);K(this,rr,e),K(this,Dn,r)}get expression(){return s(this,rr)}get alias(){return s(this,Dn)}get rawBuilder(){return s(this,rr)}toOperationNode(){return Nn.create(s(this,rr).toOperationNode(),Wt(s(this,Dn))?s(this,Dn).toOperationNode():Ke.create(s(this,Dn)))}}rr=new WeakMap,Dn=new WeakMap,Ie(Ja,"don't await AliasedRawBuilder instances directly. AliasedRawBuilder should never be executed directly since it's always a part of another query.");const $e=Object.assign((t,...e)=>kn({queryId:Me(),rawNode:wt.create(t,(e==null?void 0:e.map(bt))??[])}),{ref(t){return kn({queryId:Me(),rawNode:wt.createWithChild(an(t))})},val(t){return kn({queryId:Me(),rawNode:wt.createWithChild(bt(t))})},value(t){return this.val(t)},table(t){return kn({queryId:Me(),rawNode:wt.createWithChild(At(t))})},id(...t){const e=new Array(t.length+1).fill(".");return e[0]="",e[e.length-1]="",kn({queryId:Me(),rawNode:wt.create(e,t.map(Ke.create))})},lit(t){return kn({queryId:Me(),rawNode:wt.createWithChild(Gt.createImmediate(t))})},literal(t){return this.lit(t)},raw(t){return kn({queryId:Me(),rawNode:wt.createWithSql(t)})},join(t,e=$e`, `){const r=new Array(2*t.length-1),n=e.toOperationNode();for(let S=0;S<t.length;++S)r[2*S]=bt(t[S]),S!==t.length-1&&(r[2*S+1]=n);return kn({queryId:Me(),rawNode:wt.createWithChildren(r)})}});class au{constructor(){Re(this,"nodeStack",[]);Q(this,Qs,h({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this)}));Re(this,"visitNode",e=>{this.nodeStack.push(e),s(this,Qs)[e.kind](e),this.nodeStack.pop()})}get parentNode(){return this.nodeStack[this.nodeStack.length-2]}}Qs=new WeakMap;class lu extends au{constructor(){super(...arguments);Q(this,Qr,"");Q(this,ir,[])}get numParameters(){return s(this,ir).length}compileQuery(r){return K(this,Qr,""),K(this,ir,[]),this.visitNode(r),h({query:r,sql:this.getSql(),parameters:[...s(this,ir)]})}getSql(){return s(this,Qr)}visitSelectQuery(r){var S,R;const n=this.parentNode!==void 0&&!dr.is(this.parentNode)&&!Kt.is(this.parentNode)&&!An.is(this.parentNode)&&!Ea.is(this.parentNode);this.parentNode===void 0&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("select"),r.distinctOn&&(this.append(" "),this.compileDistinctOn(r.distinctOn)),(S=r.frontModifiers)!=null&&S.length&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.selections&&(this.append(" "),this.compileList(r.selections)),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.groupBy&&(this.append(" "),this.visitNode(r.groupBy)),r.having&&(this.append(" "),this.visitNode(r.having)),r.setOperations&&(this.append(" "),this.compileList(r.setOperations," ")),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.offset&&(this.append(" "),this.visitNode(r.offset)),(R=r.endModifiers)!=null&&R.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...r.endModifiers])," ")),n&&this.append(")")}visitFrom(r){this.append("from "),this.compileList(r.froms)}visitSelection(r){this.visitNode(r.selection)}visitColumn(r){this.visitNode(r.column)}compileDistinctOn(r){this.append("distinct on ("),this.compileList(r),this.append(")")}compileList(r,n=", "){const S=r.length-1;for(let R=0;R<=S;R++)this.visitNode(r[R]),R<S&&this.append(n)}visitWhere(r){this.append("where "),this.visitNode(r.where)}visitHaving(r){this.append("having "),this.visitNode(r.having)}visitInsertQuery(r){const n=this.nodeStack.find(Ne.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append(r.replace?"replace":"insert"),r.ignore&&this.append(" ignore"),this.append(" into "),this.visitNode(r.into),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.values&&(this.append(" "),this.visitNode(r.values)),r.onConflict&&(this.append(" "),this.visitNode(r.onConflict)),r.onDuplicateKey&&(this.append(" "),this.visitNode(r.onDuplicateKey)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitValues(r){this.append("values "),this.compileList(r.values)}visitDeleteQuery(r){const n=this.nodeStack.find(Ne.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("delete "),this.visitNode(r.from),r.using&&(this.append(" "),this.visitNode(r.using)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.orderBy&&(this.append(" "),this.visitNode(r.orderBy)),r.limit&&(this.append(" "),this.visitNode(r.limit)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitReturning(r){this.append("returning "),this.compileList(r.selections)}visitAlias(r){this.visitNode(r.node),this.append(" as "),this.visitNode(r.alias)}visitReference(r){r.table&&(this.visitNode(r.table),this.append(".")),this.visitNode(r.column)}visitSelectAll(r){this.append("*")}visitIdentifier(r){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(r),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(r){if(!Oe(r.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(r.name))}visitAnd(r){this.visitNode(r.left),this.append(" and "),this.visitNode(r.right)}visitOr(r){this.visitNode(r.left),this.append(" or "),this.visitNode(r.right)}visitValue(r){r.immediate?this.appendImmediateValue(r.value):this.appendValue(r.value)}visitValueList(r){this.append("("),this.compileList(r.values),this.append(")")}visitTuple(r){this.append("("),this.compileList(r.values),this.append(")")}visitPrimitiveValueList(r){this.append("(");const{values:n}=r;for(let S=0;S<n.length;++S)this.appendValue(n[S]),S!==n.length-1&&this.append(", ");this.append(")")}visitParens(r){this.append("("),this.visitNode(r.node),this.append(")")}visitJoin(r){this.append(uu[r.joinType]),this.append(" "),this.visitNode(r.table),r.on&&(this.append(" "),this.visitNode(r.on))}visitOn(r){this.append("on "),this.visitNode(r.on)}visitRaw(r){const{sqlFragments:n,parameters:S}=r;for(let R=0;R<n.length;++R)this.append(n[R]),S.length>R&&this.visitNode(S[R])}visitOperator(r){this.append(r.operator)}visitTable(r){this.visitNode(r.table)}visitSchemableIdentifier(r){r.schema&&(this.visitNode(r.schema),this.append(".")),this.visitNode(r.identifier)}visitCreateTable(r){this.append("create "),r.frontModifiers&&r.frontModifiers.length>0&&(this.compileList(r.frontModifiers," "),this.append(" ")),r.temporary&&this.append("temporary "),this.append("table "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.table),this.append(" ("),this.compileList([...r.columns,...r.constraints??[]]),this.append(")"),r.onCommit&&(this.append(" on commit "),this.append(r.onCommit)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}visitColumnDefinition(r){this.visitNode(r.column),this.append(" "),this.visitNode(r.dataType),r.unsigned&&this.append(" unsigned"),r.frontModifiers&&r.frontModifiers.length>0&&(this.append(" "),this.compileList(r.frontModifiers," ")),r.generated&&(this.append(" "),this.visitNode(r.generated)),r.defaultTo&&(this.append(" "),this.visitNode(r.defaultTo)),r.notNull&&this.append(" not null"),r.unique&&this.append(" unique"),r.primaryKey&&this.append(" primary key"),r.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),r.references&&(this.append(" "),this.visitNode(r.references)),r.check&&(this.append(" "),this.visitNode(r.check)),r.endModifiers&&r.endModifiers.length>0&&(this.append(" "),this.compileList(r.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(r){this.append("references "),this.visitNode(r.table),this.append(" ("),this.compileList(r.columns),this.append(")"),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitDropTable(r){this.append("drop table "),r.ifExists&&this.append("if exists "),this.visitNode(r.table),r.cascade&&this.append(" cascade")}visitDataType(r){this.append(r.dataType)}visitOrderBy(r){this.append("order by "),this.compileList(r.items)}visitOrderByItem(r){this.visitNode(r.orderBy),r.direction&&(this.append(" "),this.visitNode(r.direction))}visitGroupBy(r){this.append("group by "),this.compileList(r.items)}visitGroupByItem(r){this.visitNode(r.groupBy)}visitUpdateQuery(r){const n=this.nodeStack.find(Ne.is)!==r;!n&&r.explain&&(this.visitNode(r.explain),this.append(" ")),n&&this.append("("),r.with&&(this.visitNode(r.with),this.append(" ")),this.append("update "),this.visitNode(r.table),this.append(" set "),r.updates&&this.compileList(r.updates),r.from&&(this.append(" "),this.visitNode(r.from)),r.joins&&(this.append(" "),this.compileList(r.joins," ")),r.where&&(this.append(" "),this.visitNode(r.where)),r.returning&&(this.append(" "),this.visitNode(r.returning)),n&&this.append(")")}visitColumnUpdate(r){this.visitNode(r.column),this.append(" = "),this.visitNode(r.value)}visitLimit(r){this.append("limit "),this.visitNode(r.limit)}visitOffset(r){this.append("offset "),this.visitNode(r.offset)}visitOnConflict(r){this.append("on conflict"),r.columns?(this.append(" ("),this.compileList(r.columns),this.append(")")):r.constraint?(this.append(" on constraint "),this.visitNode(r.constraint)):r.indexExpression&&(this.append(" ("),this.visitNode(r.indexExpression),this.append(")")),r.indexWhere&&(this.append(" "),this.visitNode(r.indexWhere)),r.doNothing===!0?this.append(" do nothing"):r.updates&&(this.append(" do update set "),this.compileList(r.updates),r.updateWhere&&(this.append(" "),this.visitNode(r.updateWhere)))}visitOnDuplicateKey(r){this.append("on duplicate key update "),this.compileList(r.updates)}visitCreateIndex(r){this.append("create "),r.unique&&this.append("unique "),this.append("index "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.using&&(this.append(" using "),this.visitNode(r.using)),r.columns&&(this.append(" ("),this.compileList(r.columns),this.append(")")),r.where&&(this.append(" "),this.visitNode(r.where))}visitDropIndex(r){this.append("drop index "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.table&&(this.append(" on "),this.visitNode(r.table)),r.cascade&&this.append(" cascade")}visitCreateSchema(r){this.append("create schema "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.schema)}visitDropSchema(r){this.append("drop schema "),r.ifExists&&this.append("if exists "),this.visitNode(r.schema),r.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("primary key ("),this.compileList(r.columns),this.append(")")}visitUniqueConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("unique ("),this.compileList(r.columns),this.append(")")}visitCheckConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("check ("),this.visitNode(r.expression),this.append(")")}visitForeignKeyConstraint(r){r.name&&(this.append("constraint "),this.visitNode(r.name),this.append(" ")),this.append("foreign key ("),this.compileList(r.columns),this.append(") "),this.visitNode(r.references),r.onDelete&&(this.append(" on delete "),this.append(r.onDelete)),r.onUpdate&&(this.append(" on update "),this.append(r.onUpdate))}visitList(r){this.compileList(r.items)}visitWith(r){this.append("with "),r.recursive&&this.append("recursive "),this.compileList(r.expressions)}visitCommonTableExpression(r){this.visitNode(r.name),this.append(" as "),Qn(r.materialized)&&(r.materialized||this.append("not "),this.append("materialized ")),this.visitNode(r.expression)}visitCommonTableExpressionName(r){this.visitNode(r.table),r.columns&&(this.append("("),this.compileList(r.columns),this.append(")"))}visitAlterTable(r){this.append("alter table "),this.visitNode(r.table),this.append(" "),r.renameTo&&(this.append("rename to "),this.visitNode(r.renameTo)),r.setSchema&&(this.append("set schema "),this.visitNode(r.setSchema)),r.addConstraint&&this.visitNode(r.addConstraint),r.dropConstraint&&this.visitNode(r.dropConstraint),r.columnAlterations&&this.compileList(r.columnAlterations)}visitAddColumn(r){this.append("add column "),this.visitNode(r.column)}visitRenameColumn(r){this.append("rename column "),this.visitNode(r.column),this.append(" to "),this.visitNode(r.renameTo)}visitDropColumn(r){this.append("drop column "),this.visitNode(r.column)}visitAlterColumn(r){this.append("alter column "),this.visitNode(r.column),this.append(" "),r.dataType&&(this.append("type "),this.visitNode(r.dataType),r.dataTypeExpression&&(this.append("using "),this.visitNode(r.dataTypeExpression))),r.setDefault&&(this.append("set default "),this.visitNode(r.setDefault)),r.dropDefault&&this.append("drop default"),r.setNotNull&&this.append("set not null"),r.dropNotNull&&this.append("drop not null")}visitModifyColumn(r){this.append("modify column "),this.visitNode(r.column)}visitAddConstraint(r){this.append("add "),this.visitNode(r.constraint)}visitDropConstraint(r){this.append("drop constraint "),r.ifExists&&this.append("if exists "),this.visitNode(r.constraintName),r.modifier==="cascade"?this.append(" cascade"):r.modifier==="restrict"&&this.append(" restrict")}visitSetOperation(r){this.append(r.operator),this.append(" "),r.all&&this.append("all "),this.visitNode(r.expression)}visitCreateView(r){this.append("create "),r.orReplace&&this.append("or replace "),r.materialized&&this.append("materialized "),r.temporary&&this.append("temporary "),this.append("view "),r.ifNotExists&&this.append("if not exists "),this.visitNode(r.name),this.append(" "),r.columns&&(this.append("("),this.compileList(r.columns),this.append(") ")),r.as&&(this.append("as "),this.visitNode(r.as))}visitDropView(r){this.append("drop "),r.materialized&&this.append("materialized "),this.append("view "),r.ifExists&&this.append("if exists "),this.visitNode(r.name),r.cascade&&this.append(" cascade")}visitGenerated(r){this.append("generated "),r.always&&this.append("always "),r.byDefault&&this.append("by default "),this.append("as "),r.identity&&this.append("identity"),r.expression&&(this.append("("),this.visitNode(r.expression),this.append(")")),r.stored&&this.append(" stored")}visitDefaultValue(r){this.append("default "),this.visitNode(r.defaultValue)}visitSelectModifier(r){r.rawModifier?this.visitNode(r.rawModifier):this.append(cu[r.modifier])}visitCreateType(r){this.append("create type "),this.visitNode(r.name),r.enum&&(this.append(" as enum "),this.visitNode(r.enum))}visitDropType(r){this.append("drop type "),r.ifExists&&this.append("if exists "),this.visitNode(r.name)}visitExplain(r){this.append("explain"),(r.options||r.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),r.options&&(this.visitNode(r.options),r.format&&this.append(this.getExplainOptionsDelimiter())),r.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(r.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(r){this.append("default")}visitAggregateFunction(r){this.append(r.func),this.append("("),r.distinct&&this.append("distinct "),this.compileList(r.aggregated),this.append(")"),r.filter&&(this.append(" filter("),this.visitNode(r.filter),this.append(")")),r.over&&(this.append(" "),this.visitNode(r.over))}visitOver(r){this.append("over("),r.partitionBy&&(this.visitNode(r.partitionBy),r.orderBy&&this.append(" ")),r.orderBy&&this.visitNode(r.orderBy),this.append(")")}visitPartitionBy(r){this.append("partition by "),this.compileList(r.items)}visitPartitionByItem(r){this.visitNode(r.partitionBy)}visitBinaryOperation(r){this.visitNode(r.leftOperand),this.append(" "),this.visitNode(r.operator),this.append(" "),this.visitNode(r.rightOperand)}visitUnaryOperation(r){this.visitNode(r.operator),this.isMinusOperator(r.operator)||this.append(" "),this.visitNode(r.operand)}isMinusOperator(r){return Un.is(r)&&r.operator==="-"}visitUsing(r){this.append("using "),this.compileList(r.tables)}visitFunction(r){this.append(r.func),this.append("("),this.compileList(r.arguments),this.append(")")}visitCase(r){this.append("case"),r.value&&(this.append(" "),this.visitNode(r.value)),r.when&&(this.append(" "),this.compileList(r.when," ")),r.else&&(this.append(" else "),this.visitNode(r.else)),this.append(" end"),r.isStatement&&this.append(" case")}visitWhen(r){this.append("when "),this.visitNode(r.condition),r.result&&(this.append(" then "),this.visitNode(r.result))}visitJSONReference(r){this.visitNode(r.reference),this.visitNode(r.traversal)}visitJSONPath(r){r.inOperator&&this.visitNode(r.inOperator),this.append("'$");for(const n of r.pathLegs)this.visitNode(n);this.append("'")}visitJSONPathLeg(r){const n=r.type==="ArrayLocation";this.append(n?"[":"."),this.append(String(r.value)),n&&this.append("]")}visitJSONOperatorChain(r){for(let n=0,S=r.values.length;n<S;n++)n===S-1?this.visitNode(r.operator):this.append("->"),this.visitNode(r.values[n])}append(r){K(this,Qr,s(this,Qr)+r)}appendValue(r){this.addParameter(r),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(r){const n=this.getLeftIdentifierWrapper(),S=this.getRightIdentifierWrapper();let R="";for(const te of r)R+=te,te===n?R+=n:te===S&&(R+=S);return R}addParameter(r){s(this,ir).push(r)}appendImmediateValue(r){if(Oe(r))this.append(`'${r}'`);else if(Ze(r)||Qn(r))this.append(r.toString());else if(Ks(r))this.append("null");else if(Ql(r))this.appendImmediateValue(r.toISOString());else if(Ul(r))this.appendImmediateValue(r.toString());else throw new Error(`invalid immediate value ${r}`)}sortSelectModifiers(r){return r.sort((n,S)=>n.modifier&&S.modifier?Ga[n.modifier]-Ga[S.modifier]:1),h(r)}}Qr=new WeakMap,ir=new WeakMap;const cu=h({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),Ga=h({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),uu=h({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral"}),cn=h({raw(t,e=[]){return h({sql:t,query:wt.createWithSql(t),parameters:h(e)})}}),du=/"/g;class fu extends lu{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(du,'""')}visitDefaultInsertValue(e){this.append("null")}}const Ka="kysely_migration",Xa="kysely_migration_lock";h({__noMigrations__:!0});class hu{constructor(e){Q(this,Us);Q(this,Ur,void 0);K(this,Ur,e)}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){let r=s(this,Ur).selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select("name").orderBy("name").$castTo();e.withInternalKyselyTables||(r=r.where("name","!=",Ka).where("name","!=",Xa));const n=await r.execute();return Promise.all(n.map(({name:S})=>Ce(this,Us,Bl).call(this,S)))}async getMetadata(e){return{tables:await this.getTables(e)}}}Ur=new WeakMap,Us=new WeakSet,Bl=async function(e){var te,fe,Te,Ye,Le,Ve;const r=s(this,Ur),n=await r.selectFrom("sqlite_master").where("name","=",e).select(["sql","type"]).$castTo().executeTakeFirstOrThrow(),S=(Ve=(Le=(Ye=(Te=(fe=(te=n.sql)==null?void 0:te.split(/[\(\),]/))==null?void 0:fe.find(We=>We.toLowerCase().includes("autoincrement")))==null?void 0:Te.trimStart())==null?void 0:Ye.split(/\s+/))==null?void 0:Le[0])==null?void 0:Ve.replace(/["`]/g,""),R=await r.selectFrom($e`pragma_table_info(${e})`.as("table_info")).select(["name","type","notnull","dflt_value"]).orderBy("cid").execute();return{name:e,isView:n.type==="view",columns:R.map(We=>({name:We.name,dataType:We.type,isNullable:!We.notnull,isAutoIncrementing:We.name===S,hasDefaultValue:We.dflt_value!=null}))}};class pu{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,r){}async releaseMigrationLock(e,r){}}var _u=class{createQueryCompiler(){return new fu}createAdapter(){return new pu}createIntrospector(t){return new hu(t)}},mu=(cl=class{constructor(){Q(this,Ai,new yu);Re(this,"connection")}async acquireConnection(){return await s(this,Ai).lock(),this.connection}async beginTransaction(t){await t.executeQuery(cn.raw("begin"))}async commitTransaction(t){await t.executeQuery(cn.raw("commit"))}async rollbackTransaction(t){await t.executeQuery(cn.raw("rollback"))}async releaseConnection(){s(this,Ai).unlock()}},Ai=new WeakMap,cl),yu=class{constructor(){Re(this,"promise");Re(this,"resolve")}async lock(){for(;this.promise;)await this.promise;this.promise=new Promise(t=>{this.resolve=t})}unlock(){const t=this.resolve;this.promise=void 0,this.resolve=void 0,t==null||t()}},gu=class{streamQuery(){throw new Error("Sqlite driver doesn't support streaming")}async executeQuery(t){const{parameters:e,sql:r,query:n}=t;return["SelectQueryNode","RawNode"].includes(n.kind)?{rows:await this.query(r,e)}:{rows:[],...await this.exec(r,e)}}},wu=class extends mu{constructor(e){super();Re(this,"config");Re(this,"db");this.config=e}async init(){var e,r;this.db=typeof this.config.database=="function"?await this.config.database():this.config.database,this.connection=new bu(this.db),await((r=(e=this.config).onCreateConnection)==null?void 0:r.call(e,this.connection))}async destroy(){var e;(e=this.db)==null||e.close()}},bu=class extends gu{constructor(e){super();Re(this,"db");this.db=e}query(e,r){const n=[];return this.db.exec({sql:e,bind:r??[],rowMode:"object",resultRows:n}),n}exec(e,r){return this.db.exec({sql:e,bind:r??[]}),{numAffectedRows:BigInt(this.db.changes(!1,!0)),insertId:BigInt(this.query("SELECT last_insert_rowid() as id")[0].id)}}},qu=(ul=class extends _u{constructor(e){super();Q(this,ki,void 0);K(this,ki,e)}createDriver(){return new wu(s(this,ki))}},ki=new WeakMap,ul);async function Nu(t,e=4096,r=32*1024){await t.executeQuery(cn.raw(`PRAGMA cache_size = ${e};`)),await t.executeQuery(cn.raw("PRAGMA journal_mode = WAL;")),await t.executeQuery(cn.raw("PRAGMA temp_store = MEMORY;")),await t.executeQuery(cn.raw(`PRAGMA page_size = ${r};`)),await t.executeQuery(cn.raw("PRAGMA synchronous = NORMAL;"))}var Ao=(()=>{var t=self.location.href;return function(e){var r=e||{},n=typeof r<"u"?r:{},S,R;n.ready=new Promise(function(o,i){S=o,R=i});const te=globalThis.sqlite3InitModuleState||Object.assign(Object.create(null),{debugModule:()=>{}});delete globalThis.sqlite3InitModuleState,te.debugModule("globalThis.location =",globalThis.location);const fe="emscripten-bug-17951";n[fe]=function o(i,l){i.env.foo=function(){};const a=n.locateFile(o.uri,typeof We>"u"?"":We);te.debugModule("instantiateWasm() uri =",a);const c=()=>fetch(a,{credentials:"same-origin"});return(WebAssembly.instantiateStreaming?async()=>WebAssembly.instantiateStreaming(c(),i).then(b=>l(b.instance,b.module)):async()=>c().then(b=>b.arrayBuffer()).then(b=>WebAssembly.instantiate(b,i)).then(b=>l(b.instance,b.module)))(),{}},n[fe].uri="sqlite3.wasm";var Te=Object.assign({},n),Ye="./this.program",Le=typeof window=="object",Ve=typeof importScripts=="function";typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;var We="";function mn(o){return n.locateFile?n.locateFile(o,We):We+o}var Rn,nn,ke;(Le||Ve)&&(Ve?We=self.location.href:typeof document<"u"&&document.currentScript&&(We=document.currentScript.src),t&&(We=t),We.indexOf("blob:")!==0?We=We.substr(0,We.replace(/[?#].*/,"").lastIndexOf("/")+1):We="",Rn=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.send(null),i.responseText},Ve&&(ke=o=>{var i=new XMLHttpRequest;return i.open("GET",o,!1),i.responseType="arraybuffer",i.send(null),new Uint8Array(i.response)}),nn=(o,i,l)=>{var a=new XMLHttpRequest;a.open("GET",o,!0),a.responseType="arraybuffer",a.onload=()=>{if(a.status==200||a.status==0&&a.response){i(a.response);return}l()},a.onerror=l,a.send(null)});var at=n.print||console.log.bind(console),Rt=n.printErr||console.warn.bind(console);Object.assign(n,Te),Te=null,n.arguments&&n.arguments,n.thisProgram&&(Ye=n.thisProgram),n.quit&&n.quit;var sr;n.wasmBinary&&(sr=n.wasmBinary),n.noExitRuntime,typeof WebAssembly!="object"&&zr("no native wasm support detected");var rn,Mn=!1;function vt(o,i){o||zr(i)}var or=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Bn(o,i,l){for(var a=i+l,c=i;o[c]&&!(c>=a);)++c;if(c-i>16&&o.buffer&&or)return or.decode(o.subarray(i,c));for(var d="";i<c;){var b=o[i++];if(!(b&128)){d+=String.fromCharCode(b);continue}var k=o[i++]&63;if((b&224)==192){d+=String.fromCharCode((b&31)<<6|k);continue}var L=o[i++]&63;if((b&240)==224?b=(b&15)<<12|k<<6|L:b=(b&7)<<18|k<<12|L<<6|o[i++]&63,b<65536)d+=String.fromCharCode(b);else{var X=b-65536;d+=String.fromCharCode(55296|X>>10,56320|X&1023)}}return d}function Ii(o,i){return o?Bn(jr,o,i):""}function js(o,i,l,a){if(!(a>0))return 0;for(var c=l,d=l+a-1,b=0;b<o.length;++b){var k=o.charCodeAt(b);if(k>=55296&&k<=57343){var L=o.charCodeAt(++b);k=65536+((k&1023)<<10)|L&1023}if(k<=127){if(l>=d)break;i[l++]=k}else if(k<=2047){if(l+1>=d)break;i[l++]=192|k>>6,i[l++]=128|k&63}else if(k<=65535){if(l+2>=d)break;i[l++]=224|k>>12,i[l++]=128|k>>6&63,i[l++]=128|k&63}else{if(l+3>=d)break;i[l++]=240|k>>18,i[l++]=128|k>>12&63,i[l++]=128|k>>6&63,i[l++]=128|k&63}}return i[l]=0,l-c}function dl(o,i,l){return js(o,jr,i,l)}function Oi(o){for(var i=0,l=0;l<o.length;++l){var a=o.charCodeAt(l);a<=127?i++:a<=2047?i+=2:a>=55296&&a<=57343?(i+=4,++l):i+=3}return i}var Lt,jr,fl,be,it;function hl(){var o=rn.buffer;n.HEAP8=Lt=new Int8Array(o),n.HEAP16=fl=new Int16Array(o),n.HEAP32=be=new Int32Array(o),n.HEAPU8=jr=new Uint8Array(o),n.HEAPU16=new Uint16Array(o),n.HEAPU32=it=new Uint32Array(o),n.HEAPF32=new Float32Array(o),n.HEAPF64=new Float64Array(o),n.HEAP64=new BigInt64Array(o),n.HEAPU64=new BigUint64Array(o)}var pl=n.INITIAL_MEMORY||16777216;n.wasmMemory?rn=n.wasmMemory:rn=new WebAssembly.Memory({initial:pl/65536,maximum:2147483648/65536}),hl(),pl=rn.buffer.byteLength;var _l=[],ml=[],yl=[];function Gu(){if(n.preRun)for(typeof n.preRun=="function"&&(n.preRun=[n.preRun]);n.preRun.length;)Yu(n.preRun.shift());Wo(_l)}function Ku(){!n.noFSInit&&!u.init.initialized&&u.init(),u.ignorePermissions=!1,Wo(ml)}function Xu(){if(n.postRun)for(typeof n.postRun=="function"&&(n.postRun=[n.postRun]);n.postRun.length;)ed(n.postRun.shift());Wo(yl)}function Yu(o){_l.unshift(o)}function Zu(o){ml.unshift(o)}function ed(o){yl.unshift(o)}var ar=0,Ti=null;function uf(o){return o}function Lo(o){ar++,n.monitorRunDependencies&&n.monitorRunDependencies(ar)}function zs(o){if(ar--,n.monitorRunDependencies&&n.monitorRunDependencies(ar),ar==0&&Ti){var i=Ti;Ti=null,i()}}function zr(o){n.onAbort&&n.onAbort(o),o="Aborted("+o+")",Rt(o),Mn=!0,o+=". Build with -sASSERTIONS for more info.";var i=new WebAssembly.RuntimeError(o);throw R(i),i}var td="data:application/octet-stream;base64,";function gl(o){return o.startsWith(td)}var Mt;n.locateFile?(Mt="sqlite3.wasm",gl(Mt)||(Mt=mn(Mt))):Mt=new URL(""+new URL("sqlite3-8caf4ae4.wasm",self.location.href).href,self.location).href;function wl(o){try{if(o==Mt&&sr)return new Uint8Array(sr);if(ke)return ke(o);throw"both async and sync fetching of the wasm failed"}catch(i){zr(i)}}function nd(){return!sr&&(Le||Ve)&&typeof fetch=="function"?fetch(Mt,{credentials:"same-origin"}).then(function(o){if(!o.ok)throw"failed to load wasm binary file at '"+Mt+"'";return o.arrayBuffer()}).catch(function(){return wl(Mt)}):Promise.resolve().then(function(){return wl(Mt)})}function rd(){var o={env:El,wasi_snapshot_preview1:El};function i(b,k){var L=b.exports;n.asm=L,n.asm.__indirect_function_table,Zu(n.asm.__wasm_call_ctors),zs()}Lo();function l(b){i(b.instance)}function a(b){return nd().then(function(k){return WebAssembly.instantiate(k,o)}).then(function(k){return k}).then(b,function(k){Rt("failed to asynchronously prepare wasm: "+k),zr(k)})}function c(){return!sr&&typeof WebAssembly.instantiateStreaming=="function"&&!gl(Mt)&&typeof fetch=="function"?fetch(Mt,{credentials:"same-origin"}).then(function(b){var k=WebAssembly.instantiateStreaming(b,o);return k.then(l,function(L){return Rt("wasm streaming compile failed: "+L),Rt("falling back to ArrayBuffer instantiation"),a(l)})}):a(l)}if(n.instantiateWasm)try{var d=n.instantiateWasm(o,i);return d}catch(b){Rt("Module.instantiateWasm callback failed with error: "+b),R(b)}return c().catch(R),{}}var Ee,dt;function Wo(o){for(;o.length>0;)o.shift()(n)}var Pe={isAbs:o=>o.charAt(0)==="/",splitPath:o=>{var i=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;return i.exec(o).slice(1)},normalizeArray:(o,i)=>{for(var l=0,a=o.length-1;a>=0;a--){var c=o[a];c==="."?o.splice(a,1):c===".."?(o.splice(a,1),l++):l&&(o.splice(a,1),l--)}if(i)for(;l;l--)o.unshift("..");return o},normalize:o=>{var i=Pe.isAbs(o),l=o.substr(-1)==="/";return o=Pe.normalizeArray(o.split("/").filter(a=>!!a),!i).join("/"),!o&&!i&&(o="."),o&&l&&(o+="/"),(i?"/":"")+o},dirname:o=>{var i=Pe.splitPath(o),l=i[0],a=i[1];return!l&&!a?".":(a&&(a=a.substr(0,a.length-1)),l+a)},basename:o=>{if(o==="/")return"/";o=Pe.normalize(o),o=o.replace(/\/$/,"");var i=o.lastIndexOf("/");return i===-1?o:o.substr(i+1)},join:function(){var o=Array.prototype.slice.call(arguments);return Pe.normalize(o.join("/"))},join2:(o,i)=>Pe.normalize(o+"/"+i)};function id(){if(typeof crypto=="object"&&typeof crypto.getRandomValues=="function"){var o=new Uint8Array(1);return()=>(crypto.getRandomValues(o),o[0])}else return()=>zr("randomDevice")}var yn={resolve:function(){for(var o="",i=!1,l=arguments.length-1;l>=-1&&!i;l--){var a=l>=0?arguments[l]:u.cwd();if(typeof a!="string")throw new TypeError("Arguments to path.resolve must be strings");if(!a)return"";o=a+"/"+o,i=Pe.isAbs(a)}return o=Pe.normalizeArray(o.split("/").filter(c=>!!c),!i).join("/"),(i?"/":"")+o||"."},relative:(o,i)=>{o=yn.resolve(o).substr(1),i=yn.resolve(i).substr(1);function l(X){for(var ee=0;ee<X.length&&X[ee]==="";ee++);for(var oe=X.length-1;oe>=0&&X[oe]==="";oe--);return ee>oe?[]:X.slice(ee,oe-ee+1)}for(var a=l(o.split("/")),c=l(i.split("/")),d=Math.min(a.length,c.length),b=d,k=0;k<d;k++)if(a[k]!==c[k]){b=k;break}for(var L=[],k=b;k<a.length;k++)L.push("..");return L=L.concat(c.slice(b)),L.join("/")}};function Do(o,i,l){var a=l>0?l:Oi(o)+1,c=new Array(a),d=js(o,c,0,c.length);return i&&(c.length=d),c}var lr={ttys:[],init:function(){},shutdown:function(){},register:function(o,i){lr.ttys[o]={input:[],output:[],ops:i},u.registerDevice(o,lr.stream_ops)},stream_ops:{open:function(o){var i=lr.ttys[o.node.rdev];if(!i)throw new u.ErrnoError(43);o.tty=i,o.seekable=!1},close:function(o){o.tty.ops.fsync(o.tty)},fsync:function(o){o.tty.ops.fsync(o.tty)},read:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.get_char)throw new u.ErrnoError(60);for(var d=0,b=0;b<a;b++){var k;try{k=o.tty.ops.get_char(o.tty)}catch{throw new u.ErrnoError(29)}if(k===void 0&&d===0)throw new u.ErrnoError(6);if(k==null)break;d++,i[l+b]=k}return d&&(o.node.timestamp=Date.now()),d},write:function(o,i,l,a,c){if(!o.tty||!o.tty.ops.put_char)throw new u.ErrnoError(60);try{for(var d=0;d<a;d++)o.tty.ops.put_char(o.tty,i[l+d])}catch{throw new u.ErrnoError(29)}return a&&(o.node.timestamp=Date.now()),d}},default_tty_ops:{get_char:function(o){if(!o.input.length){var i=null;if(typeof window<"u"&&typeof window.prompt=="function"?(i=window.prompt("Input: "),i!==null&&(i+=`
`)):typeof readline=="function"&&(i=readline(),i!==null&&(i+=`
`)),!i)return null;o.input=Do(i,!0)}return o.input.shift()},put_char:function(o,i){i===null||i===10?(at(Bn(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(at(Bn(o.output,0)),o.output=[])}},default_tty1_ops:{put_char:function(o,i){i===null||i===10?(Rt(Bn(o.output,0)),o.output=[]):i!=0&&o.output.push(i)},fsync:function(o){o.output&&o.output.length>0&&(Rt(Bn(o.output,0)),o.output=[])}}};function sd(o,i){return jr.fill(0,o,o+i),o}function od(o,i){return Math.ceil(o/i)*i}function bl(o){o=od(o,65536);var i=kl(65536,o);return i?sd(i,o):0}var ge={ops_table:null,mount:function(o){return ge.createNode(null,"/",16895,0)},createNode:function(o,i,l,a){if(u.isBlkdev(l)||u.isFIFO(l))throw new u.ErrnoError(63);ge.ops_table||(ge.ops_table={dir:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr,lookup:ge.node_ops.lookup,mknod:ge.node_ops.mknod,rename:ge.node_ops.rename,unlink:ge.node_ops.unlink,rmdir:ge.node_ops.rmdir,readdir:ge.node_ops.readdir,symlink:ge.node_ops.symlink},stream:{llseek:ge.stream_ops.llseek}},file:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr},stream:{llseek:ge.stream_ops.llseek,read:ge.stream_ops.read,write:ge.stream_ops.write,allocate:ge.stream_ops.allocate,mmap:ge.stream_ops.mmap,msync:ge.stream_ops.msync}},link:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr,readlink:ge.node_ops.readlink},stream:{}},chrdev:{node:{getattr:ge.node_ops.getattr,setattr:ge.node_ops.setattr},stream:u.chrdev_stream_ops}});var c=u.createNode(o,i,l,a);return u.isDir(c.mode)?(c.node_ops=ge.ops_table.dir.node,c.stream_ops=ge.ops_table.dir.stream,c.contents={}):u.isFile(c.mode)?(c.node_ops=ge.ops_table.file.node,c.stream_ops=ge.ops_table.file.stream,c.usedBytes=0,c.contents=null):u.isLink(c.mode)?(c.node_ops=ge.ops_table.link.node,c.stream_ops=ge.ops_table.link.stream):u.isChrdev(c.mode)&&(c.node_ops=ge.ops_table.chrdev.node,c.stream_ops=ge.ops_table.chrdev.stream),c.timestamp=Date.now(),o&&(o.contents[i]=c,o.timestamp=c.timestamp),c},getFileDataAsTypedArray:function(o){return o.contents?o.contents.subarray?o.contents.subarray(0,o.usedBytes):new Uint8Array(o.contents):new Uint8Array(0)},expandFileStorage:function(o,i){var l=o.contents?o.contents.length:0;if(!(l>=i)){var a=1024*1024;i=Math.max(i,l*(l<a?2:1.125)>>>0),l!=0&&(i=Math.max(i,256));var c=o.contents;o.contents=new Uint8Array(i),o.usedBytes>0&&o.contents.set(c.subarray(0,o.usedBytes),0)}},resizeFileStorage:function(o,i){if(o.usedBytes!=i)if(i==0)o.contents=null,o.usedBytes=0;else{var l=o.contents;o.contents=new Uint8Array(i),l&&o.contents.set(l.subarray(0,Math.min(i,o.usedBytes))),o.usedBytes=i}},node_ops:{getattr:function(o){var i={};return i.dev=u.isChrdev(o.mode)?o.id:1,i.ino=o.id,i.mode=o.mode,i.nlink=1,i.uid=0,i.gid=0,i.rdev=o.rdev,u.isDir(o.mode)?i.size=4096:u.isFile(o.mode)?i.size=o.usedBytes:u.isLink(o.mode)?i.size=o.link.length:i.size=0,i.atime=new Date(o.timestamp),i.mtime=new Date(o.timestamp),i.ctime=new Date(o.timestamp),i.blksize=4096,i.blocks=Math.ceil(i.size/i.blksize),i},setattr:function(o,i){i.mode!==void 0&&(o.mode=i.mode),i.timestamp!==void 0&&(o.timestamp=i.timestamp),i.size!==void 0&&ge.resizeFileStorage(o,i.size)},lookup:function(o,i){throw u.genericErrors[44]},mknod:function(o,i,l,a){return ge.createNode(o,i,l,a)},rename:function(o,i,l){if(u.isDir(o.mode)){var a;try{a=u.lookupNode(i,l)}catch{}if(a)for(var c in a.contents)throw new u.ErrnoError(55)}delete o.parent.contents[o.name],o.parent.timestamp=Date.now(),o.name=l,i.contents[l]=o,i.timestamp=o.parent.timestamp,o.parent=i},unlink:function(o,i){delete o.contents[i],o.timestamp=Date.now()},rmdir:function(o,i){var l=u.lookupNode(o,i);for(var a in l.contents)throw new u.ErrnoError(55);delete o.contents[i],o.timestamp=Date.now()},readdir:function(o){var i=[".",".."];for(var l in o.contents)o.contents.hasOwnProperty(l)&&i.push(l);return i},symlink:function(o,i,l){var a=ge.createNode(o,i,41471,0);return a.link=l,a},readlink:function(o){if(!u.isLink(o.mode))throw new u.ErrnoError(28);return o.link}},stream_ops:{read:function(o,i,l,a,c){var d=o.node.contents;if(c>=o.node.usedBytes)return 0;var b=Math.min(o.node.usedBytes-c,a);if(b>8&&d.subarray)i.set(d.subarray(c,c+b),l);else for(var k=0;k<b;k++)i[l+k]=d[c+k];return b},write:function(o,i,l,a,c,d){if(i.buffer===Lt.buffer&&(d=!1),!a)return 0;var b=o.node;if(b.timestamp=Date.now(),i.subarray&&(!b.contents||b.contents.subarray)){if(d)return b.contents=i.subarray(l,l+a),b.usedBytes=a,a;if(b.usedBytes===0&&c===0)return b.contents=i.slice(l,l+a),b.usedBytes=a,a;if(c+a<=b.usedBytes)return b.contents.set(i.subarray(l,l+a),c),a}if(ge.expandFileStorage(b,c+a),b.contents.subarray&&i.subarray)b.contents.set(i.subarray(l,l+a),c);else for(var k=0;k<a;k++)b.contents[c+k]=i[l+k];return b.usedBytes=Math.max(b.usedBytes,c+a),a},llseek:function(o,i,l){var a=i;if(l===1?a+=o.position:l===2&&u.isFile(o.node.mode)&&(a+=o.node.usedBytes),a<0)throw new u.ErrnoError(28);return a},allocate:function(o,i,l){ge.expandFileStorage(o.node,i+l),o.node.usedBytes=Math.max(o.node.usedBytes,i+l)},mmap:function(o,i,l,a,c){if(!u.isFile(o.node.mode))throw new u.ErrnoError(43);var d,b,k=o.node.contents;if(!(c&2)&&k.buffer===Lt.buffer)b=!1,d=k.byteOffset;else{if((l>0||l+i<k.length)&&(k.subarray?k=k.subarray(l,l+i):k=Array.prototype.slice.call(k,l,l+i)),b=!0,d=bl(i),!d)throw new u.ErrnoError(48);Lt.set(k,d)}return{ptr:d,allocated:b}},msync:function(o,i,l,a,c){return ge.stream_ops.write(o,i,0,a,l,!1),0}}};function ad(o,i,l,a){var c=a?"":"al "+o;nn(o,d=>{vt(d,'Loading data file "'+o+'" failed (no arrayBuffer).'),i(new Uint8Array(d)),c&&zs()},d=>{if(l)l();else throw'Loading data file "'+o+'" failed.'}),c&&Lo()}var u={root:null,mounts:[],devices:{},streams:[],nextInode:1,nameTable:null,currentPath:"/",initialized:!1,ignorePermissions:!0,ErrnoError:null,genericErrors:{},filesystems:null,syncFSRequests:0,lookupPath:(o,i={})=>{if(o=yn.resolve(o),!o)return{path:"",node:null};var l={follow_mount:!0,recurse_count:0};if(i=Object.assign(l,i),i.recurse_count>8)throw new u.ErrnoError(32);for(var a=o.split("/").filter(oe=>!!oe),c=u.root,d="/",b=0;b<a.length;b++){var k=b===a.length-1;if(k&&i.parent)break;if(c=u.lookupNode(c,a[b]),d=Pe.join2(d,a[b]),u.isMountpoint(c)&&(!k||k&&i.follow_mount)&&(c=c.mounted.root),!k||i.follow)for(var L=0;u.isLink(c.mode);){var X=u.readlink(d);d=yn.resolve(Pe.dirname(d),X);var ee=u.lookupPath(d,{recurse_count:i.recurse_count+1});if(c=ee.node,L++>40)throw new u.ErrnoError(32)}}return{path:d,node:c}},getPath:o=>{for(var i;;){if(u.isRoot(o)){var l=o.mount.mountpoint;return i?l[l.length-1]!=="/"?l+"/"+i:l+i:l}i=i?o.name+"/"+i:o.name,o=o.parent}},hashName:(o,i)=>{for(var l=0,a=0;a<i.length;a++)l=(l<<5)-l+i.charCodeAt(a)|0;return(o+l>>>0)%u.nameTable.length},hashAddNode:o=>{var i=u.hashName(o.parent.id,o.name);o.name_next=u.nameTable[i],u.nameTable[i]=o},hashRemoveNode:o=>{var i=u.hashName(o.parent.id,o.name);if(u.nameTable[i]===o)u.nameTable[i]=o.name_next;else for(var l=u.nameTable[i];l;){if(l.name_next===o){l.name_next=o.name_next;break}l=l.name_next}},lookupNode:(o,i)=>{var l=u.mayLookup(o);if(l)throw new u.ErrnoError(l,o);for(var a=u.hashName(o.id,i),c=u.nameTable[a];c;c=c.name_next){var d=c.name;if(c.parent.id===o.id&&d===i)return c}return u.lookup(o,i)},createNode:(o,i,l,a)=>{var c=new u.FSNode(o,i,l,a);return u.hashAddNode(c),c},destroyNode:o=>{u.hashRemoveNode(o)},isRoot:o=>o===o.parent,isMountpoint:o=>!!o.mounted,isFile:o=>(o&61440)===32768,isDir:o=>(o&61440)===16384,isLink:o=>(o&61440)===40960,isChrdev:o=>(o&61440)===8192,isBlkdev:o=>(o&61440)===24576,isFIFO:o=>(o&61440)===4096,isSocket:o=>(o&49152)===49152,flagModes:{r:0,"r+":2,w:577,"w+":578,a:1089,"a+":1090},modeStringToFlags:o=>{var i=u.flagModes[o];if(typeof i>"u")throw new Error("Unknown file open mode: "+o);return i},flagsToPermissionString:o=>{var i=["r","w","rw"][o&3];return o&512&&(i+="w"),i},nodePermissions:(o,i)=>u.ignorePermissions?0:i.includes("r")&&!(o.mode&292)||i.includes("w")&&!(o.mode&146)||i.includes("x")&&!(o.mode&73)?2:0,mayLookup:o=>{var i=u.nodePermissions(o,"x");return i||(o.node_ops.lookup?0:2)},mayCreate:(o,i)=>{try{var l=u.lookupNode(o,i);return 20}catch{}return u.nodePermissions(o,"wx")},mayDelete:(o,i,l)=>{var a;try{a=u.lookupNode(o,i)}catch(d){return d.errno}var c=u.nodePermissions(o,"wx");if(c)return c;if(l){if(!u.isDir(a.mode))return 54;if(u.isRoot(a)||u.getPath(a)===u.cwd())return 10}else if(u.isDir(a.mode))return 31;return 0},mayOpen:(o,i)=>o?u.isLink(o.mode)?32:u.isDir(o.mode)&&(u.flagsToPermissionString(i)!=="r"||i&512)?31:u.nodePermissions(o,u.flagsToPermissionString(i)):44,MAX_OPEN_FDS:4096,nextfd:(o=0,i=u.MAX_OPEN_FDS)=>{for(var l=o;l<=i;l++)if(!u.streams[l])return l;throw new u.ErrnoError(33)},getStream:o=>u.streams[o],createStream:(o,i,l)=>{u.FSStream||(u.FSStream=function(){this.shared={}},u.FSStream.prototype={},Object.defineProperties(u.FSStream.prototype,{object:{get:function(){return this.node},set:function(c){this.node=c}},isRead:{get:function(){return(this.flags&2097155)!==1}},isWrite:{get:function(){return(this.flags&2097155)!==0}},isAppend:{get:function(){return this.flags&1024}},flags:{get:function(){return this.shared.flags},set:function(c){this.shared.flags=c}},position:{get:function(){return this.shared.position},set:function(c){this.shared.position=c}}})),o=Object.assign(new u.FSStream,o);var a=u.nextfd(i,l);return o.fd=a,u.streams[a]=o,o},closeStream:o=>{u.streams[o]=null},chrdev_stream_ops:{open:o=>{var i=u.getDevice(o.node.rdev);o.stream_ops=i.stream_ops,o.stream_ops.open&&o.stream_ops.open(o)},llseek:()=>{throw new u.ErrnoError(70)}},major:o=>o>>8,minor:o=>o&255,makedev:(o,i)=>o<<8|i,registerDevice:(o,i)=>{u.devices[o]={stream_ops:i}},getDevice:o=>u.devices[o],getMounts:o=>{for(var i=[],l=[o];l.length;){var a=l.pop();i.push(a),l.push.apply(l,a.mounts)}return i},syncfs:(o,i)=>{typeof o=="function"&&(i=o,o=!1),u.syncFSRequests++,u.syncFSRequests>1&&Rt("warning: "+u.syncFSRequests+" FS.syncfs operations in flight at once, probably just doing extra work");var l=u.getMounts(u.root.mount),a=0;function c(b){return u.syncFSRequests--,i(b)}function d(b){if(b)return d.errored?void 0:(d.errored=!0,c(b));++a>=l.length&&c(null)}l.forEach(b=>{if(!b.type.syncfs)return d(null);b.type.syncfs(b,o,d)})},mount:(o,i,l)=>{var a=l==="/",c=!l,d;if(a&&u.root)throw new u.ErrnoError(10);if(!a&&!c){var b=u.lookupPath(l,{follow_mount:!1});if(l=b.path,d=b.node,u.isMountpoint(d))throw new u.ErrnoError(10);if(!u.isDir(d.mode))throw new u.ErrnoError(54)}var k={type:o,opts:i,mountpoint:l,mounts:[]},L=o.mount(k);return L.mount=k,k.root=L,a?u.root=L:d&&(d.mounted=k,d.mount&&d.mount.mounts.push(k)),L},unmount:o=>{var i=u.lookupPath(o,{follow_mount:!1});if(!u.isMountpoint(i.node))throw new u.ErrnoError(28);var l=i.node,a=l.mounted,c=u.getMounts(a);Object.keys(u.nameTable).forEach(b=>{for(var k=u.nameTable[b];k;){var L=k.name_next;c.includes(k.mount)&&u.destroyNode(k),k=L}}),l.mounted=null;var d=l.mount.mounts.indexOf(a);l.mount.mounts.splice(d,1)},lookup:(o,i)=>o.node_ops.lookup(o,i),mknod:(o,i,l)=>{var a=u.lookupPath(o,{parent:!0}),c=a.node,d=Pe.basename(o);if(!d||d==="."||d==="..")throw new u.ErrnoError(28);var b=u.mayCreate(c,d);if(b)throw new u.ErrnoError(b);if(!c.node_ops.mknod)throw new u.ErrnoError(63);return c.node_ops.mknod(c,d,i,l)},create:(o,i)=>(i=i!==void 0?i:438,i&=4095,i|=32768,u.mknod(o,i,0)),mkdir:(o,i)=>(i=i!==void 0?i:511,i&=1023,i|=16384,u.mknod(o,i,0)),mkdirTree:(o,i)=>{for(var l=o.split("/"),a="",c=0;c<l.length;++c)if(l[c]){a+="/"+l[c];try{u.mkdir(a,i)}catch(d){if(d.errno!=20)throw d}}},mkdev:(o,i,l)=>(typeof l>"u"&&(l=i,i=438),i|=8192,u.mknod(o,i,l)),symlink:(o,i)=>{if(!yn.resolve(o))throw new u.ErrnoError(44);var l=u.lookupPath(i,{parent:!0}),a=l.node;if(!a)throw new u.ErrnoError(44);var c=Pe.basename(i),d=u.mayCreate(a,c);if(d)throw new u.ErrnoError(d);if(!a.node_ops.symlink)throw new u.ErrnoError(63);return a.node_ops.symlink(a,c,o)},rename:(o,i)=>{var l=Pe.dirname(o),a=Pe.dirname(i),c=Pe.basename(o),d=Pe.basename(i),b,k,L;if(b=u.lookupPath(o,{parent:!0}),k=b.node,b=u.lookupPath(i,{parent:!0}),L=b.node,!k||!L)throw new u.ErrnoError(44);if(k.mount!==L.mount)throw new u.ErrnoError(75);var X=u.lookupNode(k,c),ee=yn.relative(o,a);if(ee.charAt(0)!==".")throw new u.ErrnoError(28);if(ee=yn.relative(i,l),ee.charAt(0)!==".")throw new u.ErrnoError(55);var oe;try{oe=u.lookupNode(L,d)}catch{}if(X!==oe){var T=u.isDir(X.mode),g=u.mayDelete(k,c,T);if(g)throw new u.ErrnoError(g);if(g=oe?u.mayDelete(L,d,T):u.mayCreate(L,d),g)throw new u.ErrnoError(g);if(!k.node_ops.rename)throw new u.ErrnoError(63);if(u.isMountpoint(X)||oe&&u.isMountpoint(oe))throw new u.ErrnoError(10);if(L!==k&&(g=u.nodePermissions(k,"w"),g))throw new u.ErrnoError(g);u.hashRemoveNode(X);try{k.node_ops.rename(X,L,d)}catch(w){throw w}finally{u.hashAddNode(X)}}},rmdir:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node,a=Pe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!0);if(d)throw new u.ErrnoError(d);if(!l.node_ops.rmdir)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.rmdir(l,a),u.destroyNode(c)},readdir:o=>{var i=u.lookupPath(o,{follow:!0}),l=i.node;if(!l.node_ops.readdir)throw new u.ErrnoError(54);return l.node_ops.readdir(l)},unlink:o=>{var i=u.lookupPath(o,{parent:!0}),l=i.node;if(!l)throw new u.ErrnoError(44);var a=Pe.basename(o),c=u.lookupNode(l,a),d=u.mayDelete(l,a,!1);if(d)throw new u.ErrnoError(d);if(!l.node_ops.unlink)throw new u.ErrnoError(63);if(u.isMountpoint(c))throw new u.ErrnoError(10);l.node_ops.unlink(l,a),u.destroyNode(c)},readlink:o=>{var i=u.lookupPath(o),l=i.node;if(!l)throw new u.ErrnoError(44);if(!l.node_ops.readlink)throw new u.ErrnoError(28);return yn.resolve(u.getPath(l.parent),l.node_ops.readlink(l))},stat:(o,i)=>{var l=u.lookupPath(o,{follow:!i}),a=l.node;if(!a)throw new u.ErrnoError(44);if(!a.node_ops.getattr)throw new u.ErrnoError(63);return a.node_ops.getattr(a)},lstat:o=>u.stat(o,!0),chmod:(o,i,l)=>{var a;if(typeof o=="string"){var c=u.lookupPath(o,{follow:!l});a=c.node}else a=o;if(!a.node_ops.setattr)throw new u.ErrnoError(63);a.node_ops.setattr(a,{mode:i&4095|a.mode&-4096,timestamp:Date.now()})},lchmod:(o,i)=>{u.chmod(o,i,!0)},fchmod:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);u.chmod(l.node,i)},chown:(o,i,l,a)=>{var c;if(typeof o=="string"){var d=u.lookupPath(o,{follow:!a});c=d.node}else c=o;if(!c.node_ops.setattr)throw new u.ErrnoError(63);c.node_ops.setattr(c,{timestamp:Date.now()})},lchown:(o,i,l)=>{u.chown(o,i,l,!0)},fchown:(o,i,l)=>{var a=u.getStream(o);if(!a)throw new u.ErrnoError(8);u.chown(a.node,i,l)},truncate:(o,i)=>{if(i<0)throw new u.ErrnoError(28);var l;if(typeof o=="string"){var a=u.lookupPath(o,{follow:!0});l=a.node}else l=o;if(!l.node_ops.setattr)throw new u.ErrnoError(63);if(u.isDir(l.mode))throw new u.ErrnoError(31);if(!u.isFile(l.mode))throw new u.ErrnoError(28);var c=u.nodePermissions(l,"w");if(c)throw new u.ErrnoError(c);l.node_ops.setattr(l,{size:i,timestamp:Date.now()})},ftruncate:(o,i)=>{var l=u.getStream(o);if(!l)throw new u.ErrnoError(8);if(!(l.flags&2097155))throw new u.ErrnoError(28);u.truncate(l.node,i)},utime:(o,i,l)=>{var a=u.lookupPath(o,{follow:!0}),c=a.node;c.node_ops.setattr(c,{timestamp:Math.max(i,l)})},open:(o,i,l)=>{if(o==="")throw new u.ErrnoError(44);i=typeof i=="string"?u.modeStringToFlags(i):i,l=typeof l>"u"?438:l,i&64?l=l&4095|32768:l=0;var a;if(typeof o=="object")a=o;else{o=Pe.normalize(o);try{var c=u.lookupPath(o,{follow:!(i&131072)});a=c.node}catch{}}var d=!1;if(i&64)if(a){if(i&128)throw new u.ErrnoError(20)}else a=u.mknod(o,l,0),d=!0;if(!a)throw new u.ErrnoError(44);if(u.isChrdev(a.mode)&&(i&=-513),i&65536&&!u.isDir(a.mode))throw new u.ErrnoError(54);if(!d){var b=u.mayOpen(a,i);if(b)throw new u.ErrnoError(b)}i&512&&!d&&u.truncate(a,0),i&=-131713;var k=u.createStream({node:a,path:u.getPath(a),flags:i,seekable:!0,position:0,stream_ops:a.stream_ops,ungotten:[],error:!1});return k.stream_ops.open&&k.stream_ops.open(k),n.logReadFiles&&!(i&1)&&(u.readFiles||(u.readFiles={}),o in u.readFiles||(u.readFiles[o]=1)),k},close:o=>{if(u.isClosed(o))throw new u.ErrnoError(8);o.getdents&&(o.getdents=null);try{o.stream_ops.close&&o.stream_ops.close(o)}catch(i){throw i}finally{u.closeStream(o.fd)}o.fd=null},isClosed:o=>o.fd===null,llseek:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(!o.seekable||!o.stream_ops.llseek)throw new u.ErrnoError(70);if(l!=0&&l!=1&&l!=2)throw new u.ErrnoError(28);return o.position=o.stream_ops.llseek(o,i,l),o.ungotten=[],o.position},read:(o,i,l,a,c)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if((o.flags&2097155)===1)throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.read)throw new u.ErrnoError(28);var d=typeof c<"u";if(!d)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var b=o.stream_ops.read(o,i,l,a,c);return d||(o.position+=b),b},write:(o,i,l,a,c,d)=>{if(a<0||c<0)throw new u.ErrnoError(28);if(u.isClosed(o))throw new u.ErrnoError(8);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(u.isDir(o.node.mode))throw new u.ErrnoError(31);if(!o.stream_ops.write)throw new u.ErrnoError(28);o.seekable&&o.flags&1024&&u.llseek(o,0,2);var b=typeof c<"u";if(!b)c=o.position;else if(!o.seekable)throw new u.ErrnoError(70);var k=o.stream_ops.write(o,i,l,a,c,d);return b||(o.position+=k),k},allocate:(o,i,l)=>{if(u.isClosed(o))throw new u.ErrnoError(8);if(i<0||l<=0)throw new u.ErrnoError(28);if(!(o.flags&2097155))throw new u.ErrnoError(8);if(!u.isFile(o.node.mode)&&!u.isDir(o.node.mode))throw new u.ErrnoError(43);if(!o.stream_ops.allocate)throw new u.ErrnoError(138);o.stream_ops.allocate(o,i,l)},mmap:(o,i,l,a,c)=>{if(a&2&&!(c&2)&&(o.flags&2097155)!==2)throw new u.ErrnoError(2);if((o.flags&2097155)===1)throw new u.ErrnoError(2);if(!o.stream_ops.mmap)throw new u.ErrnoError(43);return o.stream_ops.mmap(o,i,l,a,c)},msync:(o,i,l,a,c)=>o.stream_ops.msync?o.stream_ops.msync(o,i,l,a,c):0,munmap:o=>0,ioctl:(o,i,l)=>{if(!o.stream_ops.ioctl)throw new u.ErrnoError(59);return o.stream_ops.ioctl(o,i,l)},readFile:(o,i={})=>{if(i.flags=i.flags||0,i.encoding=i.encoding||"binary",i.encoding!=="utf8"&&i.encoding!=="binary")throw new Error('Invalid encoding type "'+i.encoding+'"');var l,a=u.open(o,i.flags),c=u.stat(o),d=c.size,b=new Uint8Array(d);return u.read(a,b,0,d,0),i.encoding==="utf8"?l=Bn(b,0):i.encoding==="binary"&&(l=b),u.close(a),l},writeFile:(o,i,l={})=>{l.flags=l.flags||577;var a=u.open(o,l.flags,l.mode);if(typeof i=="string"){var c=new Uint8Array(Oi(i)+1),d=js(i,c,0,c.length);u.write(a,c,0,d,void 0,l.canOwn)}else if(ArrayBuffer.isView(i))u.write(a,i,0,i.byteLength,void 0,l.canOwn);else throw new Error("Unsupported data type");u.close(a)},cwd:()=>u.currentPath,chdir:o=>{var i=u.lookupPath(o,{follow:!0});if(i.node===null)throw new u.ErrnoError(44);if(!u.isDir(i.node.mode))throw new u.ErrnoError(54);var l=u.nodePermissions(i.node,"x");if(l)throw new u.ErrnoError(l);u.currentPath=i.path},createDefaultDirectories:()=>{u.mkdir("/tmp"),u.mkdir("/home"),u.mkdir("/home/web_user")},createDefaultDevices:()=>{u.mkdir("/dev"),u.registerDevice(u.makedev(1,3),{read:()=>0,write:(i,l,a,c,d)=>c}),u.mkdev("/dev/null",u.makedev(1,3)),lr.register(u.makedev(5,0),lr.default_tty_ops),lr.register(u.makedev(6,0),lr.default_tty1_ops),u.mkdev("/dev/tty",u.makedev(5,0)),u.mkdev("/dev/tty1",u.makedev(6,0));var o=id();u.createDevice("/dev","random",o),u.createDevice("/dev","urandom",o),u.mkdir("/dev/shm"),u.mkdir("/dev/shm/tmp")},createSpecialDirectories:()=>{u.mkdir("/proc");var o=u.mkdir("/proc/self");u.mkdir("/proc/self/fd"),u.mount({mount:()=>{var i=u.createNode(o,"fd",16895,73);return i.node_ops={lookup:(l,a)=>{var c=+a,d=u.getStream(c);if(!d)throw new u.ErrnoError(8);var b={parent:null,mount:{mountpoint:"fake"},node_ops:{readlink:()=>d.path}};return b.parent=b,b}},i}},{},"/proc/self/fd")},createStandardStreams:()=>{n.stdin?u.createDevice("/dev","stdin",n.stdin):u.symlink("/dev/tty","/dev/stdin"),n.stdout?u.createDevice("/dev","stdout",null,n.stdout):u.symlink("/dev/tty","/dev/stdout"),n.stderr?u.createDevice("/dev","stderr",null,n.stderr):u.symlink("/dev/tty1","/dev/stderr"),u.open("/dev/stdin",0),u.open("/dev/stdout",1),u.open("/dev/stderr",1)},ensureErrnoError:()=>{u.ErrnoError||(u.ErrnoError=function(i,l){this.node=l,this.setErrno=function(a){this.errno=a},this.setErrno(i),this.message="FS error"},u.ErrnoError.prototype=new Error,u.ErrnoError.prototype.constructor=u.ErrnoError,[44].forEach(o=>{u.genericErrors[o]=new u.ErrnoError(o),u.genericErrors[o].stack="<generic error, no stack>"}))},staticInit:()=>{u.ensureErrnoError(),u.nameTable=new Array(4096),u.mount(ge,{},"/"),u.createDefaultDirectories(),u.createDefaultDevices(),u.createSpecialDirectories(),u.filesystems={MEMFS:ge}},init:(o,i,l)=>{u.init.initialized=!0,u.ensureErrnoError(),n.stdin=o||n.stdin,n.stdout=i||n.stdout,n.stderr=l||n.stderr,u.createStandardStreams()},quit:()=>{u.init.initialized=!1;for(var o=0;o<u.streams.length;o++){var i=u.streams[o];i&&u.close(i)}},getMode:(o,i)=>{var l=0;return o&&(l|=365),i&&(l|=146),l},findObject:(o,i)=>{var l=u.analyzePath(o,i);return l.exists?l.object:null},analyzePath:(o,i)=>{try{var l=u.lookupPath(o,{follow:!i});o=l.path}catch{}var a={isRoot:!1,exists:!1,error:0,name:null,path:null,object:null,parentExists:!1,parentPath:null,parentObject:null};try{var l=u.lookupPath(o,{parent:!0});a.parentExists=!0,a.parentPath=l.path,a.parentObject=l.node,a.name=Pe.basename(o),l=u.lookupPath(o,{follow:!i}),a.exists=!0,a.path=l.path,a.object=l.node,a.name=l.node.name,a.isRoot=l.path==="/"}catch(c){a.error=c.errno}return a},createPath:(o,i,l,a)=>{o=typeof o=="string"?o:u.getPath(o);for(var c=i.split("/").reverse();c.length;){var d=c.pop();if(d){var b=Pe.join2(o,d);try{u.mkdir(b)}catch{}o=b}}return b},createFile:(o,i,l,a,c)=>{var d=Pe.join2(typeof o=="string"?o:u.getPath(o),i),b=u.getMode(a,c);return u.create(d,b)},createDataFile:(o,i,l,a,c,d)=>{var b=i;o&&(o=typeof o=="string"?o:u.getPath(o),b=i?Pe.join2(o,i):o);var k=u.getMode(a,c),L=u.create(b,k);if(l){if(typeof l=="string"){for(var X=new Array(l.length),ee=0,oe=l.length;ee<oe;++ee)X[ee]=l.charCodeAt(ee);l=X}u.chmod(L,k|146);var T=u.open(L,577);u.write(T,l,0,l.length,0,d),u.close(T),u.chmod(L,k)}return L},createDevice:(o,i,l,a)=>{var c=Pe.join2(typeof o=="string"?o:u.getPath(o),i),d=u.getMode(!!l,!!a);u.createDevice.major||(u.createDevice.major=64);var b=u.makedev(u.createDevice.major++,0);return u.registerDevice(b,{open:k=>{k.seekable=!1},close:k=>{a&&a.buffer&&a.buffer.length&&a(10)},read:(k,L,X,ee,oe)=>{for(var T=0,g=0;g<ee;g++){var w;try{w=l()}catch{throw new u.ErrnoError(29)}if(w===void 0&&T===0)throw new u.ErrnoError(6);if(w==null)break;T++,L[X+g]=w}return T&&(k.node.timestamp=Date.now()),T},write:(k,L,X,ee,oe)=>{for(var T=0;T<ee;T++)try{a(L[X+T])}catch{throw new u.ErrnoError(29)}return ee&&(k.node.timestamp=Date.now()),T}}),u.mkdev(c,d,b)},forceLoadFile:o=>{if(o.isDevice||o.isFolder||o.link||o.contents)return!0;if(typeof XMLHttpRequest<"u")throw new Error("Lazy loading should have been performed (contents set) in createLazyFile, but it was not. Lazy loading only works in web workers. Use --embed-file or --preload-file in emcc on the main thread.");if(Rn)try{o.contents=Do(Rn(o.url),!0),o.usedBytes=o.contents.length}catch{throw new u.ErrnoError(29)}else throw new Error("Cannot load without read() or XMLHttpRequest.")},createLazyFile:(o,i,l,a,c)=>{function d(){this.lengthKnown=!1,this.chunks=[]}if(d.prototype.get=function(g){if(!(g>this.length-1||g<0)){var w=g%this.chunkSize,E=g/this.chunkSize|0;return this.getter(E)[w]}},d.prototype.setDataGetter=function(g){this.getter=g},d.prototype.cacheLength=function(){var g=new XMLHttpRequest;if(g.open("HEAD",l,!1),g.send(null),!(g.status>=200&&g.status<300||g.status===304))throw new Error("Couldn't load "+l+". Status: "+g.status);var w=Number(g.getResponseHeader("Content-length")),E,A=(E=g.getResponseHeader("Accept-Ranges"))&&E==="bytes",q=(E=g.getResponseHeader("Content-Encoding"))&&E==="gzip",B=1024*1024;A||(B=w);var J=(U,le)=>{if(U>le)throw new Error("invalid range ("+U+", "+le+") or no bytes requested!");if(le>w-1)throw new Error("only "+w+" bytes available! programmer error!");var m=new XMLHttpRequest;if(m.open("GET",l,!1),w!==B&&m.setRequestHeader("Range","bytes="+U+"-"+le),m.responseType="arraybuffer",m.overrideMimeType&&m.overrideMimeType("text/plain; charset=x-user-defined"),m.send(null),!(m.status>=200&&m.status<300||m.status===304))throw new Error("Couldn't load "+l+". Status: "+m.status);return m.response!==void 0?new Uint8Array(m.response||[]):Do(m.responseText||"",!0)},H=this;H.setDataGetter(U=>{var le=U*B,m=(U+1)*B-1;if(m=Math.min(m,w-1),typeof H.chunks[U]>"u"&&(H.chunks[U]=J(le,m)),typeof H.chunks[U]>"u")throw new Error("doXHR failed!");return H.chunks[U]}),(q||!w)&&(B=w=1,w=this.getter(0).length,B=w,at("LazyFiles on gzip forces download of the whole file when length is accessed")),this._length=w,this._chunkSize=B,this.lengthKnown=!0},typeof XMLHttpRequest<"u"){if(!Ve)throw"Cannot do synchronous binary XHRs outside webworkers in modern browsers. Use --embed-file or --preload-file in emcc";var b=new d;Object.defineProperties(b,{length:{get:function(){return this.lengthKnown||this.cacheLength(),this._length}},chunkSize:{get:function(){return this.lengthKnown||this.cacheLength(),this._chunkSize}}});var k={isDevice:!1,contents:b}}else var k={isDevice:!1,url:l};var L=u.createFile(o,i,k,a,c);k.contents?L.contents=k.contents:k.url&&(L.contents=null,L.url=k.url),Object.defineProperties(L,{usedBytes:{get:function(){return this.contents.length}}});var X={},ee=Object.keys(L.stream_ops);ee.forEach(T=>{var g=L.stream_ops[T];X[T]=function(){return u.forceLoadFile(L),g.apply(null,arguments)}});function oe(T,g,w,E,A){var q=T.node.contents;if(A>=q.length)return 0;var B=Math.min(q.length-A,E);if(q.slice)for(var J=0;J<B;J++)g[w+J]=q[A+J];else for(var J=0;J<B;J++)g[w+J]=q.get(A+J);return B}return X.read=(T,g,w,E,A)=>(u.forceLoadFile(L),oe(T,g,w,E,A)),X.mmap=(T,g,w,E,A)=>{u.forceLoadFile(L);var q=bl(g);if(!q)throw new u.ErrnoError(48);return oe(T,Lt,q,g,w),{ptr:q,allocated:!0}},L.stream_ops=X,L},createPreloadedFile:(o,i,l,a,c,d,b,k,L,X)=>{var ee=i?yn.resolve(Pe.join2(o,i)):o;function oe(T){function g(w){X&&X(),k||u.createDataFile(o,i,w,a,c,L),d&&d(),zs()}Browser.handledByPreloadPlugin(T,ee,g,()=>{b&&b(),zs()})||g(T)}Lo(),typeof l=="string"?ad(l,T=>oe(T),b):oe(l)},indexedDB:()=>window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB,DB_NAME:()=>"EM_FS_"+window.location.pathname,DB_VERSION:20,DB_STORE_NAME:"FILE_DATA",saveFilesToDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=()=>{at("creating db");var d=c.result;d.createObjectStore(u.DB_STORE_NAME)},c.onsuccess=()=>{var d=c.result,b=d.transaction([u.DB_STORE_NAME],"readwrite"),k=b.objectStore(u.DB_STORE_NAME),L=0,X=0,ee=o.length;function oe(){X==0?i():l()}o.forEach(T=>{var g=k.put(u.analyzePath(T).object.contents,T);g.onsuccess=()=>{L++,L+X==ee&&oe()},g.onerror=()=>{X++,L+X==ee&&oe()}}),b.onerror=l},c.onerror=l},loadFilesFromDB:(o,i,l)=>{i=i||(()=>{}),l=l||(()=>{});var a=u.indexedDB();try{var c=a.open(u.DB_NAME(),u.DB_VERSION)}catch(d){return l(d)}c.onupgradeneeded=l,c.onsuccess=()=>{var d=c.result;try{var b=d.transaction([u.DB_STORE_NAME],"readonly")}catch(T){l(T);return}var k=b.objectStore(u.DB_STORE_NAME),L=0,X=0,ee=o.length;function oe(){X==0?i():l()}o.forEach(T=>{var g=k.get(T);g.onsuccess=()=>{u.analyzePath(T).exists&&u.unlink(T),u.createDataFile(Pe.dirname(T),Pe.basename(T),g.result,!0,!0,!0),L++,L+X==ee&&oe()},g.onerror=()=>{X++,L+X==ee&&oe()}}),b.onerror=l},c.onerror=l}},pe={DEFAULT_POLLMASK:5,calculateAt:function(o,i,l){if(Pe.isAbs(i))return i;var a;if(o===-100)a=u.cwd();else{var c=pe.getStreamFromFD(o);a=c.path}if(i.length==0){if(!l)throw new u.ErrnoError(44);return a}return Pe.join2(a,i)},doStat:function(o,i,l){try{var a=o(i)}catch(k){if(k&&k.node&&Pe.normalize(i)!==Pe.normalize(u.getPath(k.node)))return-54;throw k}be[l>>2]=a.dev,be[l+8>>2]=a.ino,be[l+12>>2]=a.mode,it[l+16>>2]=a.nlink,be[l+20>>2]=a.uid,be[l+24>>2]=a.gid,be[l+28>>2]=a.rdev,dt=[a.size>>>0,(Ee=a.size,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[l+40>>2]=dt[0],be[l+44>>2]=dt[1],be[l+48>>2]=4096,be[l+52>>2]=a.blocks;var c=a.atime.getTime(),d=a.mtime.getTime(),b=a.ctime.getTime();return dt=[Math.floor(c/1e3)>>>0,(Ee=Math.floor(c/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[l+56>>2]=dt[0],be[l+60>>2]=dt[1],it[l+64>>2]=c%1e3*1e3,dt=[Math.floor(d/1e3)>>>0,(Ee=Math.floor(d/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[l+72>>2]=dt[0],be[l+76>>2]=dt[1],it[l+80>>2]=d%1e3*1e3,dt=[Math.floor(b/1e3)>>>0,(Ee=Math.floor(b/1e3),+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[l+88>>2]=dt[0],be[l+92>>2]=dt[1],it[l+96>>2]=b%1e3*1e3,dt=[a.ino>>>0,(Ee=a.ino,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[l+104>>2]=dt[0],be[l+108>>2]=dt[1],0},doMsync:function(o,i,l,a,c){if(!u.isFile(i.node.mode))throw new u.ErrnoError(43);if(a&2)return 0;var d=jr.slice(o,o+l);u.msync(i,d,c,l,a)},varargs:void 0,get:function(){pe.varargs+=4;var o=be[pe.varargs-4>>2];return o},getStr:function(o){var i=Ii(o);return i},getStreamFromFD:function(o){var i=u.getStream(o);if(!i)throw new u.ErrnoError(8);return i}};function ld(o,i){try{return o=pe.getStr(o),u.chmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function cd(o,i,l,a){try{if(i=pe.getStr(i),i=pe.calculateAt(o,i),l&-8)return-28;var c=u.lookupPath(i,{follow:!0}),d=c.node;if(!d)return-44;var b="";return l&4&&(b+="r"),l&2&&(b+="w"),l&1&&(b+="x"),b&&u.nodePermissions(d,b)?-2:0}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function ud(o,i){try{return u.fchmod(o,i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function dd(o,i,l){try{return u.fchown(o,i,l),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function fd(o){return be[Sl()>>2]=o,o}function hd(o,i,l){pe.varargs=l;try{var a=pe.getStreamFromFD(o);switch(i){case 0:{var c=pe.get();if(c<0)return-28;var d;return d=u.createStream(a,c),d.fd}case 1:case 2:return 0;case 3:return a.flags;case 4:{var c=pe.get();return a.flags|=c,0}case 5:{var c=pe.get(),b=0;return fl[c+b>>1]=2,0}case 6:case 7:return 0;case 16:case 8:return-28;case 9:return fd(28),-1;default:return-28}}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function pd(o,i){try{var l=pe.getStreamFromFD(o);return pe.doStat(u.stat,l.path,i)}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}var _d=9007199254740992,md=-9007199254740992;function ql(o){return o<md||o>_d?NaN:Number(o)}function yd(o,i){try{return i=ql(i),isNaN(i)?-61:(u.ftruncate(o,i),0)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function gd(o,i){try{if(i===0)return-28;var l=u.cwd(),a=Oi(l)+1;return i<a?-68:(dl(l,o,i),a)}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return-c.errno}}function wd(o,i,l){pe.varargs=l;try{var a=pe.getStreamFromFD(o);switch(i){case 21509:case 21505:return a.tty?0:-59;case 21510:case 21511:case 21512:case 21506:case 21507:case 21508:return a.tty?0:-59;case 21519:{if(!a.tty)return-59;var c=pe.get();return be[c>>2]=0,0}case 21520:return a.tty?-28:-59;case 21531:{var c=pe.get();return u.ioctl(a,i,c)}case 21523:return a.tty?0:-59;case 21524:return a.tty?0:-59;default:return-28}}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function bd(o,i){try{return o=pe.getStr(o),pe.doStat(u.lstat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function qd(o,i,l){try{return i=pe.getStr(i),i=pe.calculateAt(o,i),i=Pe.normalize(i),i[i.length-1]==="/"&&(i=i.substr(0,i.length-1)),u.mkdir(i,l,0),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Nd(o,i,l,a){try{i=pe.getStr(i);var c=a&256,d=a&4096;return a=a&-6401,i=pe.calculateAt(o,i,d),pe.doStat(c?u.lstat:u.stat,i,l)}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return-b.errno}}function vd(o,i,l,a){pe.varargs=a;try{i=pe.getStr(i),i=pe.calculateAt(o,i);var c=a?pe.get():0;return u.open(i,l,c).fd}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return-d.errno}}function xd(o,i,l,a){try{if(i=pe.getStr(i),i=pe.calculateAt(o,i),a<=0)return-28;var c=u.readlink(i),d=Math.min(a,Oi(c)),b=Lt[l+d];return dl(c,l,a+1),Lt[l+d]=b,d}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function Ed(o){try{return o=pe.getStr(o),u.rmdir(o),0}catch(i){if(typeof u>"u"||!(i instanceof u.ErrnoError))throw i;return-i.errno}}function Sd(o,i){try{return o=pe.getStr(o),pe.doStat(u.stat,o,i)}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return-l.errno}}function Ad(o,i,l){try{return i=pe.getStr(i),i=pe.calculateAt(o,i),l===0?u.unlink(i):l===512?u.rmdir(i):zr("Invalid flags passed to unlinkat"),0}catch(a){if(typeof u>"u"||!(a instanceof u.ErrnoError))throw a;return-a.errno}}function Ro(o){return it[o>>2]+be[o+4>>2]*4294967296}function kd(o,i,l,a){try{if(i=pe.getStr(i),i=pe.calculateAt(o,i,!0),l){var b=Ro(l),k=be[l+8>>2];c=b*1e3+k/(1e3*1e3),l+=16,b=Ro(l),k=be[l+8>>2],d=b*1e3+k/(1e3*1e3)}else var c=Date.now(),d=c;return u.utime(i,c,d),0}catch(L){if(typeof u>"u"||!(L instanceof u.ErrnoError))throw L;return-L.errno}}var Id=!0;function Od(){return Id}function Td(o){return o%4===0&&(o%100!==0||o%400===0)}var Cd=[0,31,60,91,121,152,182,213,244,274,305,335],Pd=[0,31,59,90,120,151,181,212,243,273,304,334];function Fd(o){var i=Td(o.getFullYear()),l=i?Cd:Pd,a=l[o.getMonth()]+o.getDate()-1;return a}function Ld(o,i){var l=new Date(Ro(o)*1e3);be[i>>2]=l.getSeconds(),be[i+4>>2]=l.getMinutes(),be[i+8>>2]=l.getHours(),be[i+12>>2]=l.getDate(),be[i+16>>2]=l.getMonth(),be[i+20>>2]=l.getFullYear()-1900,be[i+24>>2]=l.getDay();var a=Fd(l)|0;be[i+28>>2]=a,be[i+36>>2]=-(l.getTimezoneOffset()*60);var c=new Date(l.getFullYear(),0,1),d=new Date(l.getFullYear(),6,1).getTimezoneOffset(),b=c.getTimezoneOffset(),k=(d!=b&&l.getTimezoneOffset()==Math.min(b,d))|0;be[i+32>>2]=k}function Wd(o,i,l,a,c,d,b){try{var k=pe.getStreamFromFD(a),L=u.mmap(k,o,c,i,l),X=L.ptr;return be[d>>2]=L.allocated,it[b>>2]=X,0}catch(ee){if(typeof u>"u"||!(ee instanceof u.ErrnoError))throw ee;return-ee.errno}}function Dd(o,i,l,a,c,d){try{var b=pe.getStreamFromFD(c);l&2&&pe.doMsync(o,b,i,a,d),u.munmap(b)}catch(k){if(typeof u>"u"||!(k instanceof u.ErrnoError))throw k;return-k.errno}}function Nl(o){var i=Oi(o)+1,l=Al(i);return l&&js(o,Lt,l,i),l}function Rd(o,i,l){var a=new Date().getFullYear(),c=new Date(a,0,1),d=new Date(a,6,1),b=c.getTimezoneOffset(),k=d.getTimezoneOffset(),L=Math.max(b,k);it[o>>2]=L*60,be[i>>2]=+(b!=k);function X(w){var E=w.toTimeString().match(/\(([A-Za-z ]+)\)$/);return E?E[1]:"GMT"}var ee=X(c),oe=X(d),T=Nl(ee),g=Nl(oe);k<b?(it[l>>2]=T,it[l+4>>2]=g):(it[l>>2]=g,it[l+4>>2]=T)}function Md(){return Date.now()}var vl;vl=()=>performance.now();function Bd(){return 2147483648}function Qd(o){var i=rn.buffer;try{return rn.grow(o-i.byteLength+65535>>>16),hl(),1}catch{}}function Ud(o){var i=jr.length;o=o>>>0;var l=Bd();if(o>l)return!1;let a=(L,X)=>L+(X-L%X)%X;for(var c=1;c<=4;c*=2){var d=i*(1+.2/c);d=Math.min(d,o+100663296);var b=Math.min(l,a(Math.max(o,d),65536)),k=Qd(b);if(k)return!0}return!1}var Mo={};function jd(){return Ye||"./this.program"}function Ci(){if(!Ci.strings){var o=(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",i={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:o,_:jd()};for(var l in Mo)Mo[l]===void 0?delete i[l]:i[l]=Mo[l];var a=[];for(var l in i)a.push(l+"="+i[l]);Ci.strings=a}return Ci.strings}function zd(o,i,l){for(var a=0;a<o.length;++a)Lt[i++>>0]=o.charCodeAt(a);l||(Lt[i>>0]=0)}function Vd(o,i){var l=0;return Ci().forEach(function(a,c){var d=i+l;it[o+c*4>>2]=d,zd(a,d),l+=a.length+1}),0}function $d(o,i){var l=Ci();it[o>>2]=l.length;var a=0;return l.forEach(function(c){a+=c.length+1}),it[i>>2]=a,0}function Hd(o){try{var i=pe.getStreamFromFD(o);return u.close(i),0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Jd(o,i){try{var l=pe.getStreamFromFD(o),a=l.tty?2:u.isDir(l.mode)?3:u.isLink(l.mode)?7:4;return Lt[i>>0]=a,0}catch(c){if(typeof u>"u"||!(c instanceof u.ErrnoError))throw c;return c.errno}}function Gd(o,i,l,a){for(var c=0,d=0;d<l;d++){var b=it[i>>2],k=it[i+4>>2];i+=8;var L=u.read(o,Lt,b,k,a);if(L<0)return-1;if(c+=L,L<k)break;typeof a<"u"&&(a+=L)}return c}function Kd(o,i,l,a){try{var c=pe.getStreamFromFD(o),d=Gd(c,i,l);return it[a>>2]=d,0}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return b.errno}}function Xd(o,i,l,a){try{if(i=ql(i),isNaN(i))return 61;var c=pe.getStreamFromFD(o);return u.llseek(c,i,l),dt=[c.position>>>0,(Ee=c.position,+Math.abs(Ee)>=1?Ee>0?(Math.min(+Math.floor(Ee/4294967296),4294967295)|0)>>>0:~~+Math.ceil((Ee-+(~~Ee>>>0))/4294967296)>>>0:0)],be[a>>2]=dt[0],be[a+4>>2]=dt[1],c.getdents&&i===0&&l===0&&(c.getdents=null),0}catch(d){if(typeof u>"u"||!(d instanceof u.ErrnoError))throw d;return d.errno}}function Yd(o){try{var i=pe.getStreamFromFD(o);return i.stream_ops&&i.stream_ops.fsync?i.stream_ops.fsync(i):0}catch(l){if(typeof u>"u"||!(l instanceof u.ErrnoError))throw l;return l.errno}}function Zd(o,i,l,a){for(var c=0,d=0;d<l;d++){var b=it[i>>2],k=it[i+4>>2];i+=8;var L=u.write(o,Lt,b,k,a);if(L<0)return-1;c+=L,typeof a<"u"&&(a+=L)}return c}function ef(o,i,l,a){try{var c=pe.getStreamFromFD(o),d=Zd(c,i,l);return it[a>>2]=d,0}catch(b){if(typeof u>"u"||!(b instanceof u.ErrnoError))throw b;return b.errno}}var xl=function(o,i,l,a){o||(o=this),this.parent=o,this.mount=o.mount,this.mounted=null,this.id=u.nextInode++,this.name=i,this.mode=l,this.node_ops={},this.stream_ops={},this.rdev=a},Vs=365,$s=146;Object.defineProperties(xl.prototype,{read:{get:function(){return(this.mode&Vs)===Vs},set:function(o){o?this.mode|=Vs:this.mode&=~Vs}},write:{get:function(){return(this.mode&$s)===$s},set:function(o){o?this.mode|=$s:this.mode&=~$s}},isFolder:{get:function(){return u.isDir(this.mode)}},isDevice:{get:function(){return u.isChrdev(this.mode)}}}),u.FSNode=xl,u.staticInit();var El={__syscall_chmod:ld,__syscall_faccessat:cd,__syscall_fchmod:ud,__syscall_fchown32:dd,__syscall_fcntl64:hd,__syscall_fstat64:pd,__syscall_ftruncate64:yd,__syscall_getcwd:gd,__syscall_ioctl:wd,__syscall_lstat64:bd,__syscall_mkdirat:qd,__syscall_newfstatat:Nd,__syscall_openat:vd,__syscall_readlinkat:xd,__syscall_rmdir:Ed,__syscall_stat64:Sd,__syscall_unlinkat:Ad,__syscall_utimensat:kd,_emscripten_get_now_is_monotonic:Od,_localtime_js:Ld,_mmap_js:Wd,_munmap_js:Dd,_tzset_js:Rd,emscripten_date_now:Md,emscripten_get_now:vl,emscripten_resize_heap:Ud,environ_get:Vd,environ_sizes_get:$d,fd_close:Hd,fd_fdstat_get:Jd,fd_read:Kd,fd_seek:Xd,fd_sync:Yd,fd_write:ef,memory:rn};rd(),n.___wasm_call_ctors=function(){return(n.___wasm_call_ctors=n.asm.__wasm_call_ctors).apply(null,arguments)},n._sqlite3_status64=function(){return(n._sqlite3_status64=n.asm.sqlite3_status64).apply(null,arguments)},n._sqlite3_status=function(){return(n._sqlite3_status=n.asm.sqlite3_status).apply(null,arguments)},n._sqlite3_db_status=function(){return(n._sqlite3_db_status=n.asm.sqlite3_db_status).apply(null,arguments)},n._sqlite3_msize=function(){return(n._sqlite3_msize=n.asm.sqlite3_msize).apply(null,arguments)},n._sqlite3_vfs_find=function(){return(n._sqlite3_vfs_find=n.asm.sqlite3_vfs_find).apply(null,arguments)},n._sqlite3_initialize=function(){return(n._sqlite3_initialize=n.asm.sqlite3_initialize).apply(null,arguments)},n._sqlite3_malloc=function(){return(n._sqlite3_malloc=n.asm.sqlite3_malloc).apply(null,arguments)},n._sqlite3_free=function(){return(n._sqlite3_free=n.asm.sqlite3_free).apply(null,arguments)},n._sqlite3_vfs_register=function(){return(n._sqlite3_vfs_register=n.asm.sqlite3_vfs_register).apply(null,arguments)},n._sqlite3_vfs_unregister=function(){return(n._sqlite3_vfs_unregister=n.asm.sqlite3_vfs_unregister).apply(null,arguments)},n._sqlite3_malloc64=function(){return(n._sqlite3_malloc64=n.asm.sqlite3_malloc64).apply(null,arguments)},n._sqlite3_realloc=function(){return(n._sqlite3_realloc=n.asm.sqlite3_realloc).apply(null,arguments)},n._sqlite3_realloc64=function(){return(n._sqlite3_realloc64=n.asm.sqlite3_realloc64).apply(null,arguments)},n._sqlite3_value_text=function(){return(n._sqlite3_value_text=n.asm.sqlite3_value_text).apply(null,arguments)},n._sqlite3_randomness=function(){return(n._sqlite3_randomness=n.asm.sqlite3_randomness).apply(null,arguments)},n._sqlite3_stricmp=function(){return(n._sqlite3_stricmp=n.asm.sqlite3_stricmp).apply(null,arguments)},n._sqlite3_strnicmp=function(){return(n._sqlite3_strnicmp=n.asm.sqlite3_strnicmp).apply(null,arguments)},n._sqlite3_uri_parameter=function(){return(n._sqlite3_uri_parameter=n.asm.sqlite3_uri_parameter).apply(null,arguments)};var Sl=n.___errno_location=function(){return(Sl=n.___errno_location=n.asm.__errno_location).apply(null,arguments)};n._sqlite3_uri_boolean=function(){return(n._sqlite3_uri_boolean=n.asm.sqlite3_uri_boolean).apply(null,arguments)},n._sqlite3_serialize=function(){return(n._sqlite3_serialize=n.asm.sqlite3_serialize).apply(null,arguments)},n._sqlite3_prepare_v2=function(){return(n._sqlite3_prepare_v2=n.asm.sqlite3_prepare_v2).apply(null,arguments)},n._sqlite3_step=function(){return(n._sqlite3_step=n.asm.sqlite3_step).apply(null,arguments)},n._sqlite3_column_int64=function(){return(n._sqlite3_column_int64=n.asm.sqlite3_column_int64).apply(null,arguments)},n._sqlite3_column_int=function(){return(n._sqlite3_column_int=n.asm.sqlite3_column_int).apply(null,arguments)},n._sqlite3_finalize=function(){return(n._sqlite3_finalize=n.asm.sqlite3_finalize).apply(null,arguments)},n._sqlite3_file_control=function(){return(n._sqlite3_file_control=n.asm.sqlite3_file_control).apply(null,arguments)},n._sqlite3_reset=function(){return(n._sqlite3_reset=n.asm.sqlite3_reset).apply(null,arguments)},n._sqlite3_deserialize=function(){return(n._sqlite3_deserialize=n.asm.sqlite3_deserialize).apply(null,arguments)},n._sqlite3_clear_bindings=function(){return(n._sqlite3_clear_bindings=n.asm.sqlite3_clear_bindings).apply(null,arguments)},n._sqlite3_value_blob=function(){return(n._sqlite3_value_blob=n.asm.sqlite3_value_blob).apply(null,arguments)},n._sqlite3_value_bytes=function(){return(n._sqlite3_value_bytes=n.asm.sqlite3_value_bytes).apply(null,arguments)},n._sqlite3_value_double=function(){return(n._sqlite3_value_double=n.asm.sqlite3_value_double).apply(null,arguments)},n._sqlite3_value_int=function(){return(n._sqlite3_value_int=n.asm.sqlite3_value_int).apply(null,arguments)},n._sqlite3_value_int64=function(){return(n._sqlite3_value_int64=n.asm.sqlite3_value_int64).apply(null,arguments)},n._sqlite3_value_subtype=function(){return(n._sqlite3_value_subtype=n.asm.sqlite3_value_subtype).apply(null,arguments)},n._sqlite3_value_pointer=function(){return(n._sqlite3_value_pointer=n.asm.sqlite3_value_pointer).apply(null,arguments)},n._sqlite3_value_type=function(){return(n._sqlite3_value_type=n.asm.sqlite3_value_type).apply(null,arguments)},n._sqlite3_value_nochange=function(){return(n._sqlite3_value_nochange=n.asm.sqlite3_value_nochange).apply(null,arguments)},n._sqlite3_value_frombind=function(){return(n._sqlite3_value_frombind=n.asm.sqlite3_value_frombind).apply(null,arguments)},n._sqlite3_value_dup=function(){return(n._sqlite3_value_dup=n.asm.sqlite3_value_dup).apply(null,arguments)},n._sqlite3_value_free=function(){return(n._sqlite3_value_free=n.asm.sqlite3_value_free).apply(null,arguments)},n._sqlite3_result_blob=function(){return(n._sqlite3_result_blob=n.asm.sqlite3_result_blob).apply(null,arguments)},n._sqlite3_result_error_nomem=function(){return(n._sqlite3_result_error_nomem=n.asm.sqlite3_result_error_nomem).apply(null,arguments)},n._sqlite3_result_error_toobig=function(){return(n._sqlite3_result_error_toobig=n.asm.sqlite3_result_error_toobig).apply(null,arguments)},n._sqlite3_result_double=function(){return(n._sqlite3_result_double=n.asm.sqlite3_result_double).apply(null,arguments)},n._sqlite3_result_error=function(){return(n._sqlite3_result_error=n.asm.sqlite3_result_error).apply(null,arguments)},n._sqlite3_result_int=function(){return(n._sqlite3_result_int=n.asm.sqlite3_result_int).apply(null,arguments)},n._sqlite3_result_int64=function(){return(n._sqlite3_result_int64=n.asm.sqlite3_result_int64).apply(null,arguments)},n._sqlite3_result_null=function(){return(n._sqlite3_result_null=n.asm.sqlite3_result_null).apply(null,arguments)},n._sqlite3_result_pointer=function(){return(n._sqlite3_result_pointer=n.asm.sqlite3_result_pointer).apply(null,arguments)},n._sqlite3_result_subtype=function(){return(n._sqlite3_result_subtype=n.asm.sqlite3_result_subtype).apply(null,arguments)},n._sqlite3_result_text=function(){return(n._sqlite3_result_text=n.asm.sqlite3_result_text).apply(null,arguments)},n._sqlite3_result_zeroblob=function(){return(n._sqlite3_result_zeroblob=n.asm.sqlite3_result_zeroblob).apply(null,arguments)},n._sqlite3_result_zeroblob64=function(){return(n._sqlite3_result_zeroblob64=n.asm.sqlite3_result_zeroblob64).apply(null,arguments)},n._sqlite3_result_error_code=function(){return(n._sqlite3_result_error_code=n.asm.sqlite3_result_error_code).apply(null,arguments)},n._sqlite3_user_data=function(){return(n._sqlite3_user_data=n.asm.sqlite3_user_data).apply(null,arguments)},n._sqlite3_context_db_handle=function(){return(n._sqlite3_context_db_handle=n.asm.sqlite3_context_db_handle).apply(null,arguments)},n._sqlite3_vtab_nochange=function(){return(n._sqlite3_vtab_nochange=n.asm.sqlite3_vtab_nochange).apply(null,arguments)},n._sqlite3_vtab_in_first=function(){return(n._sqlite3_vtab_in_first=n.asm.sqlite3_vtab_in_first).apply(null,arguments)},n._sqlite3_vtab_in_next=function(){return(n._sqlite3_vtab_in_next=n.asm.sqlite3_vtab_in_next).apply(null,arguments)},n._sqlite3_aggregate_context=function(){return(n._sqlite3_aggregate_context=n.asm.sqlite3_aggregate_context).apply(null,arguments)},n._sqlite3_get_auxdata=function(){return(n._sqlite3_get_auxdata=n.asm.sqlite3_get_auxdata).apply(null,arguments)},n._sqlite3_set_auxdata=function(){return(n._sqlite3_set_auxdata=n.asm.sqlite3_set_auxdata).apply(null,arguments)},n._sqlite3_column_count=function(){return(n._sqlite3_column_count=n.asm.sqlite3_column_count).apply(null,arguments)},n._sqlite3_data_count=function(){return(n._sqlite3_data_count=n.asm.sqlite3_data_count).apply(null,arguments)},n._sqlite3_column_blob=function(){return(n._sqlite3_column_blob=n.asm.sqlite3_column_blob).apply(null,arguments)},n._sqlite3_column_bytes=function(){return(n._sqlite3_column_bytes=n.asm.sqlite3_column_bytes).apply(null,arguments)},n._sqlite3_column_double=function(){return(n._sqlite3_column_double=n.asm.sqlite3_column_double).apply(null,arguments)},n._sqlite3_column_text=function(){return(n._sqlite3_column_text=n.asm.sqlite3_column_text).apply(null,arguments)},n._sqlite3_column_value=function(){return(n._sqlite3_column_value=n.asm.sqlite3_column_value).apply(null,arguments)},n._sqlite3_column_type=function(){return(n._sqlite3_column_type=n.asm.sqlite3_column_type).apply(null,arguments)},n._sqlite3_column_name=function(){return(n._sqlite3_column_name=n.asm.sqlite3_column_name).apply(null,arguments)},n._sqlite3_bind_blob=function(){return(n._sqlite3_bind_blob=n.asm.sqlite3_bind_blob).apply(null,arguments)},n._sqlite3_bind_double=function(){return(n._sqlite3_bind_double=n.asm.sqlite3_bind_double).apply(null,arguments)},n._sqlite3_bind_int=function(){return(n._sqlite3_bind_int=n.asm.sqlite3_bind_int).apply(null,arguments)},n._sqlite3_bind_int64=function(){return(n._sqlite3_bind_int64=n.asm.sqlite3_bind_int64).apply(null,arguments)},n._sqlite3_bind_null=function(){return(n._sqlite3_bind_null=n.asm.sqlite3_bind_null).apply(null,arguments)},n._sqlite3_bind_pointer=function(){return(n._sqlite3_bind_pointer=n.asm.sqlite3_bind_pointer).apply(null,arguments)},n._sqlite3_bind_text=function(){return(n._sqlite3_bind_text=n.asm.sqlite3_bind_text).apply(null,arguments)},n._sqlite3_bind_parameter_count=function(){return(n._sqlite3_bind_parameter_count=n.asm.sqlite3_bind_parameter_count).apply(null,arguments)},n._sqlite3_bind_parameter_index=function(){return(n._sqlite3_bind_parameter_index=n.asm.sqlite3_bind_parameter_index).apply(null,arguments)},n._sqlite3_db_handle=function(){return(n._sqlite3_db_handle=n.asm.sqlite3_db_handle).apply(null,arguments)},n._sqlite3_stmt_readonly=function(){return(n._sqlite3_stmt_readonly=n.asm.sqlite3_stmt_readonly).apply(null,arguments)},n._sqlite3_stmt_isexplain=function(){return(n._sqlite3_stmt_isexplain=n.asm.sqlite3_stmt_isexplain).apply(null,arguments)},n._sqlite3_stmt_status=function(){return(n._sqlite3_stmt_status=n.asm.sqlite3_stmt_status).apply(null,arguments)},n._sqlite3_sql=function(){return(n._sqlite3_sql=n.asm.sqlite3_sql).apply(null,arguments)},n._sqlite3_expanded_sql=function(){return(n._sqlite3_expanded_sql=n.asm.sqlite3_expanded_sql).apply(null,arguments)},n._sqlite3_preupdate_old=function(){return(n._sqlite3_preupdate_old=n.asm.sqlite3_preupdate_old).apply(null,arguments)},n._sqlite3_preupdate_count=function(){return(n._sqlite3_preupdate_count=n.asm.sqlite3_preupdate_count).apply(null,arguments)},n._sqlite3_preupdate_depth=function(){return(n._sqlite3_preupdate_depth=n.asm.sqlite3_preupdate_depth).apply(null,arguments)},n._sqlite3_preupdate_blobwrite=function(){return(n._sqlite3_preupdate_blobwrite=n.asm.sqlite3_preupdate_blobwrite).apply(null,arguments)},n._sqlite3_preupdate_new=function(){return(n._sqlite3_preupdate_new=n.asm.sqlite3_preupdate_new).apply(null,arguments)},n._sqlite3_value_numeric_type=function(){return(n._sqlite3_value_numeric_type=n.asm.sqlite3_value_numeric_type).apply(null,arguments)},n._sqlite3_errmsg=function(){return(n._sqlite3_errmsg=n.asm.sqlite3_errmsg).apply(null,arguments)},n._sqlite3_set_authorizer=function(){return(n._sqlite3_set_authorizer=n.asm.sqlite3_set_authorizer).apply(null,arguments)},n._sqlite3_strglob=function(){return(n._sqlite3_strglob=n.asm.sqlite3_strglob).apply(null,arguments)},n._sqlite3_strlike=function(){return(n._sqlite3_strlike=n.asm.sqlite3_strlike).apply(null,arguments)},n._sqlite3_exec=function(){return(n._sqlite3_exec=n.asm.sqlite3_exec).apply(null,arguments)},n._sqlite3_auto_extension=function(){return(n._sqlite3_auto_extension=n.asm.sqlite3_auto_extension).apply(null,arguments)},n._sqlite3_cancel_auto_extension=function(){return(n._sqlite3_cancel_auto_extension=n.asm.sqlite3_cancel_auto_extension).apply(null,arguments)},n._sqlite3_reset_auto_extension=function(){return(n._sqlite3_reset_auto_extension=n.asm.sqlite3_reset_auto_extension).apply(null,arguments)},n._sqlite3_prepare_v3=function(){return(n._sqlite3_prepare_v3=n.asm.sqlite3_prepare_v3).apply(null,arguments)},n._sqlite3_create_module=function(){return(n._sqlite3_create_module=n.asm.sqlite3_create_module).apply(null,arguments)},n._sqlite3_create_module_v2=function(){return(n._sqlite3_create_module_v2=n.asm.sqlite3_create_module_v2).apply(null,arguments)},n._sqlite3_drop_modules=function(){return(n._sqlite3_drop_modules=n.asm.sqlite3_drop_modules).apply(null,arguments)},n._sqlite3_declare_vtab=function(){return(n._sqlite3_declare_vtab=n.asm.sqlite3_declare_vtab).apply(null,arguments)},n._sqlite3_vtab_on_conflict=function(){return(n._sqlite3_vtab_on_conflict=n.asm.sqlite3_vtab_on_conflict).apply(null,arguments)},n._sqlite3_vtab_collation=function(){return(n._sqlite3_vtab_collation=n.asm.sqlite3_vtab_collation).apply(null,arguments)},n._sqlite3_vtab_in=function(){return(n._sqlite3_vtab_in=n.asm.sqlite3_vtab_in).apply(null,arguments)},n._sqlite3_vtab_rhs_value=function(){return(n._sqlite3_vtab_rhs_value=n.asm.sqlite3_vtab_rhs_value).apply(null,arguments)},n._sqlite3_vtab_distinct=function(){return(n._sqlite3_vtab_distinct=n.asm.sqlite3_vtab_distinct).apply(null,arguments)},n._sqlite3_keyword_name=function(){return(n._sqlite3_keyword_name=n.asm.sqlite3_keyword_name).apply(null,arguments)},n._sqlite3_keyword_count=function(){return(n._sqlite3_keyword_count=n.asm.sqlite3_keyword_count).apply(null,arguments)},n._sqlite3_keyword_check=function(){return(n._sqlite3_keyword_check=n.asm.sqlite3_keyword_check).apply(null,arguments)},n._sqlite3_complete=function(){return(n._sqlite3_complete=n.asm.sqlite3_complete).apply(null,arguments)},n._sqlite3_libversion=function(){return(n._sqlite3_libversion=n.asm.sqlite3_libversion).apply(null,arguments)},n._sqlite3_libversion_number=function(){return(n._sqlite3_libversion_number=n.asm.sqlite3_libversion_number).apply(null,arguments)},n._sqlite3_shutdown=function(){return(n._sqlite3_shutdown=n.asm.sqlite3_shutdown).apply(null,arguments)},n._sqlite3_last_insert_rowid=function(){return(n._sqlite3_last_insert_rowid=n.asm.sqlite3_last_insert_rowid).apply(null,arguments)},n._sqlite3_set_last_insert_rowid=function(){return(n._sqlite3_set_last_insert_rowid=n.asm.sqlite3_set_last_insert_rowid).apply(null,arguments)},n._sqlite3_changes64=function(){return(n._sqlite3_changes64=n.asm.sqlite3_changes64).apply(null,arguments)},n._sqlite3_changes=function(){return(n._sqlite3_changes=n.asm.sqlite3_changes).apply(null,arguments)},n._sqlite3_total_changes64=function(){return(n._sqlite3_total_changes64=n.asm.sqlite3_total_changes64).apply(null,arguments)},n._sqlite3_total_changes=function(){return(n._sqlite3_total_changes=n.asm.sqlite3_total_changes).apply(null,arguments)},n._sqlite3_txn_state=function(){return(n._sqlite3_txn_state=n.asm.sqlite3_txn_state).apply(null,arguments)},n._sqlite3_close_v2=function(){return(n._sqlite3_close_v2=n.asm.sqlite3_close_v2).apply(null,arguments)},n._sqlite3_busy_handler=function(){return(n._sqlite3_busy_handler=n.asm.sqlite3_busy_handler).apply(null,arguments)},n._sqlite3_progress_handler=function(){return(n._sqlite3_progress_handler=n.asm.sqlite3_progress_handler).apply(null,arguments)},n._sqlite3_busy_timeout=function(){return(n._sqlite3_busy_timeout=n.asm.sqlite3_busy_timeout).apply(null,arguments)},n._sqlite3_create_function=function(){return(n._sqlite3_create_function=n.asm.sqlite3_create_function).apply(null,arguments)},n._sqlite3_create_function_v2=function(){return(n._sqlite3_create_function_v2=n.asm.sqlite3_create_function_v2).apply(null,arguments)},n._sqlite3_create_window_function=function(){return(n._sqlite3_create_window_function=n.asm.sqlite3_create_window_function).apply(null,arguments)},n._sqlite3_overload_function=function(){return(n._sqlite3_overload_function=n.asm.sqlite3_overload_function).apply(null,arguments)},n._sqlite3_trace_v2=function(){return(n._sqlite3_trace_v2=n.asm.sqlite3_trace_v2).apply(null,arguments)},n._sqlite3_commit_hook=function(){return(n._sqlite3_commit_hook=n.asm.sqlite3_commit_hook).apply(null,arguments)},n._sqlite3_update_hook=function(){return(n._sqlite3_update_hook=n.asm.sqlite3_update_hook).apply(null,arguments)},n._sqlite3_rollback_hook=function(){return(n._sqlite3_rollback_hook=n.asm.sqlite3_rollback_hook).apply(null,arguments)},n._sqlite3_preupdate_hook=function(){return(n._sqlite3_preupdate_hook=n.asm.sqlite3_preupdate_hook).apply(null,arguments)},n._sqlite3_error_offset=function(){return(n._sqlite3_error_offset=n.asm.sqlite3_error_offset).apply(null,arguments)},n._sqlite3_errcode=function(){return(n._sqlite3_errcode=n.asm.sqlite3_errcode).apply(null,arguments)},n._sqlite3_extended_errcode=function(){return(n._sqlite3_extended_errcode=n.asm.sqlite3_extended_errcode).apply(null,arguments)},n._sqlite3_errstr=function(){return(n._sqlite3_errstr=n.asm.sqlite3_errstr).apply(null,arguments)},n._sqlite3_limit=function(){return(n._sqlite3_limit=n.asm.sqlite3_limit).apply(null,arguments)},n._sqlite3_open=function(){return(n._sqlite3_open=n.asm.sqlite3_open).apply(null,arguments)},n._sqlite3_open_v2=function(){return(n._sqlite3_open_v2=n.asm.sqlite3_open_v2).apply(null,arguments)},n._sqlite3_create_collation=function(){return(n._sqlite3_create_collation=n.asm.sqlite3_create_collation).apply(null,arguments)},n._sqlite3_create_collation_v2=function(){return(n._sqlite3_create_collation_v2=n.asm.sqlite3_create_collation_v2).apply(null,arguments)},n._sqlite3_collation_needed=function(){return(n._sqlite3_collation_needed=n.asm.sqlite3_collation_needed).apply(null,arguments)},n._sqlite3_table_column_metadata=function(){return(n._sqlite3_table_column_metadata=n.asm.sqlite3_table_column_metadata).apply(null,arguments)},n._sqlite3_extended_result_codes=function(){return(n._sqlite3_extended_result_codes=n.asm.sqlite3_extended_result_codes).apply(null,arguments)},n._sqlite3_uri_key=function(){return(n._sqlite3_uri_key=n.asm.sqlite3_uri_key).apply(null,arguments)},n._sqlite3_uri_int64=function(){return(n._sqlite3_uri_int64=n.asm.sqlite3_uri_int64).apply(null,arguments)},n._sqlite3_db_name=function(){return(n._sqlite3_db_name=n.asm.sqlite3_db_name).apply(null,arguments)},n._sqlite3_db_filename=function(){return(n._sqlite3_db_filename=n.asm.sqlite3_db_filename).apply(null,arguments)},n._sqlite3_compileoption_used=function(){return(n._sqlite3_compileoption_used=n.asm.sqlite3_compileoption_used).apply(null,arguments)},n._sqlite3_compileoption_get=function(){return(n._sqlite3_compileoption_get=n.asm.sqlite3_compileoption_get).apply(null,arguments)},n._sqlite3session_diff=function(){return(n._sqlite3session_diff=n.asm.sqlite3session_diff).apply(null,arguments)},n._sqlite3session_attach=function(){return(n._sqlite3session_attach=n.asm.sqlite3session_attach).apply(null,arguments)},n._sqlite3session_create=function(){return(n._sqlite3session_create=n.asm.sqlite3session_create).apply(null,arguments)},n._sqlite3session_delete=function(){return(n._sqlite3session_delete=n.asm.sqlite3session_delete).apply(null,arguments)},n._sqlite3session_table_filter=function(){return(n._sqlite3session_table_filter=n.asm.sqlite3session_table_filter).apply(null,arguments)},n._sqlite3session_changeset=function(){return(n._sqlite3session_changeset=n.asm.sqlite3session_changeset).apply(null,arguments)},n._sqlite3session_changeset_strm=function(){return(n._sqlite3session_changeset_strm=n.asm.sqlite3session_changeset_strm).apply(null,arguments)},n._sqlite3session_patchset_strm=function(){return(n._sqlite3session_patchset_strm=n.asm.sqlite3session_patchset_strm).apply(null,arguments)},n._sqlite3session_patchset=function(){return(n._sqlite3session_patchset=n.asm.sqlite3session_patchset).apply(null,arguments)},n._sqlite3session_enable=function(){return(n._sqlite3session_enable=n.asm.sqlite3session_enable).apply(null,arguments)},n._sqlite3session_indirect=function(){return(n._sqlite3session_indirect=n.asm.sqlite3session_indirect).apply(null,arguments)},n._sqlite3session_isempty=function(){return(n._sqlite3session_isempty=n.asm.sqlite3session_isempty).apply(null,arguments)},n._sqlite3session_memory_used=function(){return(n._sqlite3session_memory_used=n.asm.sqlite3session_memory_used).apply(null,arguments)},n._sqlite3session_object_config=function(){return(n._sqlite3session_object_config=n.asm.sqlite3session_object_config).apply(null,arguments)},n._sqlite3session_changeset_size=function(){return(n._sqlite3session_changeset_size=n.asm.sqlite3session_changeset_size).apply(null,arguments)},n._sqlite3changeset_start=function(){return(n._sqlite3changeset_start=n.asm.sqlite3changeset_start).apply(null,arguments)},n._sqlite3changeset_start_v2=function(){return(n._sqlite3changeset_start_v2=n.asm.sqlite3changeset_start_v2).apply(null,arguments)},n._sqlite3changeset_start_strm=function(){return(n._sqlite3changeset_start_strm=n.asm.sqlite3changeset_start_strm).apply(null,arguments)},n._sqlite3changeset_start_v2_strm=function(){return(n._sqlite3changeset_start_v2_strm=n.asm.sqlite3changeset_start_v2_strm).apply(null,arguments)},n._sqlite3changeset_next=function(){return(n._sqlite3changeset_next=n.asm.sqlite3changeset_next).apply(null,arguments)},n._sqlite3changeset_op=function(){return(n._sqlite3changeset_op=n.asm.sqlite3changeset_op).apply(null,arguments)},n._sqlite3changeset_pk=function(){return(n._sqlite3changeset_pk=n.asm.sqlite3changeset_pk).apply(null,arguments)},n._sqlite3changeset_old=function(){return(n._sqlite3changeset_old=n.asm.sqlite3changeset_old).apply(null,arguments)},n._sqlite3changeset_new=function(){return(n._sqlite3changeset_new=n.asm.sqlite3changeset_new).apply(null,arguments)},n._sqlite3changeset_conflict=function(){return(n._sqlite3changeset_conflict=n.asm.sqlite3changeset_conflict).apply(null,arguments)},n._sqlite3changeset_fk_conflicts=function(){return(n._sqlite3changeset_fk_conflicts=n.asm.sqlite3changeset_fk_conflicts).apply(null,arguments)},n._sqlite3changeset_finalize=function(){return(n._sqlite3changeset_finalize=n.asm.sqlite3changeset_finalize).apply(null,arguments)},n._sqlite3changeset_invert=function(){return(n._sqlite3changeset_invert=n.asm.sqlite3changeset_invert).apply(null,arguments)},n._sqlite3changeset_invert_strm=function(){return(n._sqlite3changeset_invert_strm=n.asm.sqlite3changeset_invert_strm).apply(null,arguments)},n._sqlite3changeset_apply_v2=function(){return(n._sqlite3changeset_apply_v2=n.asm.sqlite3changeset_apply_v2).apply(null,arguments)},n._sqlite3changeset_apply=function(){return(n._sqlite3changeset_apply=n.asm.sqlite3changeset_apply).apply(null,arguments)},n._sqlite3changeset_apply_v2_strm=function(){return(n._sqlite3changeset_apply_v2_strm=n.asm.sqlite3changeset_apply_v2_strm).apply(null,arguments)},n._sqlite3changeset_apply_strm=function(){return(n._sqlite3changeset_apply_strm=n.asm.sqlite3changeset_apply_strm).apply(null,arguments)},n._sqlite3changegroup_new=function(){return(n._sqlite3changegroup_new=n.asm.sqlite3changegroup_new).apply(null,arguments)},n._sqlite3changegroup_add=function(){return(n._sqlite3changegroup_add=n.asm.sqlite3changegroup_add).apply(null,arguments)},n._sqlite3changegroup_output=function(){return(n._sqlite3changegroup_output=n.asm.sqlite3changegroup_output).apply(null,arguments)},n._sqlite3changegroup_add_strm=function(){return(n._sqlite3changegroup_add_strm=n.asm.sqlite3changegroup_add_strm).apply(null,arguments)},n._sqlite3changegroup_output_strm=function(){return(n._sqlite3changegroup_output_strm=n.asm.sqlite3changegroup_output_strm).apply(null,arguments)},n._sqlite3changegroup_delete=function(){return(n._sqlite3changegroup_delete=n.asm.sqlite3changegroup_delete).apply(null,arguments)},n._sqlite3changeset_concat=function(){return(n._sqlite3changeset_concat=n.asm.sqlite3changeset_concat).apply(null,arguments)},n._sqlite3changeset_concat_strm=function(){return(n._sqlite3changeset_concat_strm=n.asm.sqlite3changeset_concat_strm).apply(null,arguments)},n._sqlite3session_config=function(){return(n._sqlite3session_config=n.asm.sqlite3session_config).apply(null,arguments)},n._sqlite3_sourceid=function(){return(n._sqlite3_sourceid=n.asm.sqlite3_sourceid).apply(null,arguments)},n._sqlite3_wasm_pstack_ptr=function(){return(n._sqlite3_wasm_pstack_ptr=n.asm.sqlite3_wasm_pstack_ptr).apply(null,arguments)},n._sqlite3_wasm_pstack_restore=function(){return(n._sqlite3_wasm_pstack_restore=n.asm.sqlite3_wasm_pstack_restore).apply(null,arguments)},n._sqlite3_wasm_pstack_alloc=function(){return(n._sqlite3_wasm_pstack_alloc=n.asm.sqlite3_wasm_pstack_alloc).apply(null,arguments)},n._sqlite3_wasm_pstack_remaining=function(){return(n._sqlite3_wasm_pstack_remaining=n.asm.sqlite3_wasm_pstack_remaining).apply(null,arguments)},n._sqlite3_wasm_pstack_quota=function(){return(n._sqlite3_wasm_pstack_quota=n.asm.sqlite3_wasm_pstack_quota).apply(null,arguments)},n._sqlite3_wasm_db_error=function(){return(n._sqlite3_wasm_db_error=n.asm.sqlite3_wasm_db_error).apply(null,arguments)},n._sqlite3_wasm_test_struct=function(){return(n._sqlite3_wasm_test_struct=n.asm.sqlite3_wasm_test_struct).apply(null,arguments)},n._sqlite3_wasm_enum_json=function(){return(n._sqlite3_wasm_enum_json=n.asm.sqlite3_wasm_enum_json).apply(null,arguments)},n._sqlite3_wasm_vfs_unlink=function(){return(n._sqlite3_wasm_vfs_unlink=n.asm.sqlite3_wasm_vfs_unlink).apply(null,arguments)},n._sqlite3_wasm_db_vfs=function(){return(n._sqlite3_wasm_db_vfs=n.asm.sqlite3_wasm_db_vfs).apply(null,arguments)},n._sqlite3_wasm_db_reset=function(){return(n._sqlite3_wasm_db_reset=n.asm.sqlite3_wasm_db_reset).apply(null,arguments)},n._sqlite3_wasm_db_export_chunked=function(){return(n._sqlite3_wasm_db_export_chunked=n.asm.sqlite3_wasm_db_export_chunked).apply(null,arguments)},n._sqlite3_wasm_db_serialize=function(){return(n._sqlite3_wasm_db_serialize=n.asm.sqlite3_wasm_db_serialize).apply(null,arguments)},n._sqlite3_wasm_vfs_create_file=function(){return(n._sqlite3_wasm_vfs_create_file=n.asm.sqlite3_wasm_vfs_create_file).apply(null,arguments)},n._sqlite3_wasm_posix_create_file=function(){return(n._sqlite3_wasm_posix_create_file=n.asm.sqlite3_wasm_posix_create_file).apply(null,arguments)},n._sqlite3_wasm_kvvfsMakeKeyOnPstack=function(){return(n._sqlite3_wasm_kvvfsMakeKeyOnPstack=n.asm.sqlite3_wasm_kvvfsMakeKeyOnPstack).apply(null,arguments)},n._sqlite3_wasm_kvvfs_methods=function(){return(n._sqlite3_wasm_kvvfs_methods=n.asm.sqlite3_wasm_kvvfs_methods).apply(null,arguments)},n._sqlite3_wasm_vtab_config=function(){return(n._sqlite3_wasm_vtab_config=n.asm.sqlite3_wasm_vtab_config).apply(null,arguments)},n._sqlite3_wasm_db_config_ip=function(){return(n._sqlite3_wasm_db_config_ip=n.asm.sqlite3_wasm_db_config_ip).apply(null,arguments)},n._sqlite3_wasm_db_config_pii=function(){return(n._sqlite3_wasm_db_config_pii=n.asm.sqlite3_wasm_db_config_pii).apply(null,arguments)},n._sqlite3_wasm_db_config_s=function(){return(n._sqlite3_wasm_db_config_s=n.asm.sqlite3_wasm_db_config_s).apply(null,arguments)},n._sqlite3_wasm_config_i=function(){return(n._sqlite3_wasm_config_i=n.asm.sqlite3_wasm_config_i).apply(null,arguments)},n._sqlite3_wasm_config_ii=function(){return(n._sqlite3_wasm_config_ii=n.asm.sqlite3_wasm_config_ii).apply(null,arguments)},n._sqlite3_wasm_config_j=function(){return(n._sqlite3_wasm_config_j=n.asm.sqlite3_wasm_config_j).apply(null,arguments)},n._sqlite3_wasm_init_wasmfs=function(){return(n._sqlite3_wasm_init_wasmfs=n.asm.sqlite3_wasm_init_wasmfs).apply(null,arguments)},n._sqlite3_wasm_test_intptr=function(){return(n._sqlite3_wasm_test_intptr=n.asm.sqlite3_wasm_test_intptr).apply(null,arguments)},n._sqlite3_wasm_test_voidptr=function(){return(n._sqlite3_wasm_test_voidptr=n.asm.sqlite3_wasm_test_voidptr).apply(null,arguments)},n._sqlite3_wasm_test_int64_max=function(){return(n._sqlite3_wasm_test_int64_max=n.asm.sqlite3_wasm_test_int64_max).apply(null,arguments)},n._sqlite3_wasm_test_int64_min=function(){return(n._sqlite3_wasm_test_int64_min=n.asm.sqlite3_wasm_test_int64_min).apply(null,arguments)},n._sqlite3_wasm_test_int64_times2=function(){return(n._sqlite3_wasm_test_int64_times2=n.asm.sqlite3_wasm_test_int64_times2).apply(null,arguments)},n._sqlite3_wasm_test_int64_minmax=function(){return(n._sqlite3_wasm_test_int64_minmax=n.asm.sqlite3_wasm_test_int64_minmax).apply(null,arguments)},n._sqlite3_wasm_test_int64ptr=function(){return(n._sqlite3_wasm_test_int64ptr=n.asm.sqlite3_wasm_test_int64ptr).apply(null,arguments)},n._sqlite3_wasm_test_stack_overflow=function(){return(n._sqlite3_wasm_test_stack_overflow=n.asm.sqlite3_wasm_test_stack_overflow).apply(null,arguments)},n._sqlite3_wasm_test_str_hello=function(){return(n._sqlite3_wasm_test_str_hello=n.asm.sqlite3_wasm_test_str_hello).apply(null,arguments)};var Al=n._malloc=function(){return(Al=n._malloc=n.asm.malloc).apply(null,arguments)};n._free=function(){return(n._free=n.asm.free).apply(null,arguments)},n._realloc=function(){return(n._realloc=n.asm.realloc).apply(null,arguments)};var kl=n._emscripten_builtin_memalign=function(){return(kl=n._emscripten_builtin_memalign=n.asm.emscripten_builtin_memalign).apply(null,arguments)};n.stackSave=function(){return(n.stackSave=n.asm.stackSave).apply(null,arguments)},n.stackRestore=function(){return(n.stackRestore=n.asm.stackRestore).apply(null,arguments)},n.stackAlloc=function(){return(n.stackAlloc=n.asm.stackAlloc).apply(null,arguments)},n.wasmMemory=rn;var Hs;Ti=function o(){Hs||Il(),Hs||(Ti=o)};function Il(o){if(ar>0||(Gu(),ar>0))return;function i(){Hs||(Hs=!0,n.calledRun=!0,!Mn&&(Ku(),S(n),n.onRuntimeInitialized&&n.onRuntimeInitialized(),Xu()))}n.setStatus?(n.setStatus("Running..."),setTimeout(function(){setTimeout(function(){n.setStatus("")},1),i()},1)):i()}if(n.preInit)for(typeof n.preInit=="function"&&(n.preInit=[n.preInit]);n.preInit.length>0;)n.preInit.pop()();return Il(),n.postRun||(n.postRun=[]),n.postRun.push(function(o){if(globalThis.sqlite3ApiBootstrap=function i(l=globalThis.sqlite3ApiConfig||i.defaultConfig){if(i.sqlite3)return console.warn("sqlite3ApiBootstrap() called multiple times.","Config and external initializers are ignored on calls after the first."),i.sqlite3;const a=Object.assign(Object.create(null),{exports:void 0,memory:void 0,bigIntEnabled:(()=>typeof o<"u"?!!o.HEAPU64:!!globalThis.BigInt64Array)(),debug:console.debug.bind(console),warn:console.warn.bind(console),error:console.error.bind(console),log:console.log.bind(console),wasmfsOpfsDir:"/opfs",useStdAlloc:!1},l||{});Object.assign(a,{allocExportName:a.useStdAlloc?"malloc":"sqlite3_malloc",deallocExportName:a.useStdAlloc?"free":"sqlite3_free",reallocExportName:a.useStdAlloc?"realloc":"sqlite3_realloc"},a),["exports","memory","wasmfsOpfsDir"].forEach(f=>{typeof a[f]=="function"&&(a[f]=a[f]())});const c=Object.create(null),d=Object.create(null),b=f=>c.sqlite3_js_rc_str&&c.sqlite3_js_rc_str(f)||"Unknown result code #"+f,k=f=>typeof f=="number"&&f===(f|0);class L extends Error{constructor(...p){let _;if(p.length)if(k(p[0]))if(_=p[0],p.length===1)super(b(p[0]));else{const F=b(_);typeof p[1]=="object"?super(F,p[1]):(p[0]=F+":",super(p.join(" ")))}else p.length===2&&typeof p[1]=="object"?super(...p):super(p.join(" "));this.resultCode=_||c.SQLITE_ERROR,this.name="SQLite3Error"}}L.toss=(...f)=>{throw new L(...f)};const X=L.toss;a.wasmfsOpfsDir&&!/^\/[^/]+$/.test(a.wasmfsOpfsDir)&&X("config.wasmfsOpfsDir must be falsy or in the form '/dir-name'.");const ee=f=>typeof f!="bigint"&&f===(f|0)&&f<=2147483647&&f>=-2147483648,oe=function f(p){return f._max||(f._max=BigInt("0x7fffffffffffffff"),f._min=~f._max),p>=f._min&&p<=f._max},T=f=>f>=-0x7fffffffn-1n&&f<=0x7fffffffn,g=function f(p){return f._min||(f._min=Number.MIN_SAFE_INTEGER,f._max=Number.MAX_SAFE_INTEGER),p>=f._min&&p<=f._max},w=f=>f&&f.constructor&&ee(f.constructor.BYTES_PER_ELEMENT)?f:!1,E=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,A=f=>f.buffer instanceof E,q=(f,p,_)=>A(f)?f.slice(p,_):f.subarray(p,_),B=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),J=f=>f&&(f instanceof Uint8Array||f instanceof Int8Array||f instanceof ArrayBuffer),H=f=>B(f)||X("Value is not of a supported TypedArray type."),U=new TextDecoder("utf-8"),le=function(f,p,_){return U.decode(q(f,p,_))},m=function(f){return J(f)?le(f instanceof ArrayBuffer?new Uint8Array(f):f):Array.isArray(f)?f.join(""):(d.isPtr(f)&&(f=d.cstrToJs(f)),f)};class N extends Error{constructor(...p){p.length===2&&typeof p[1]=="object"?super(...p):p.length?super(p.join(" ")):super("Allocation failed."),this.resultCode=c.SQLITE_NOMEM,this.name="WasmAllocError"}}N.toss=(...f)=>{throw new N(...f)},Object.assign(c,{sqlite3_bind_blob:void 0,sqlite3_bind_text:void 0,sqlite3_create_function_v2:(f,p,_,F,G,re,ae,ie,ce)=>{},sqlite3_create_function:(f,p,_,F,G,re,ae,ie)=>{},sqlite3_create_window_function:(f,p,_,F,G,re,ae,ie,ce,ue)=>{},sqlite3_prepare_v3:(f,p,_,F,G,re)=>{},sqlite3_prepare_v2:(f,p,_,F,G)=>{},sqlite3_exec:(f,p,_,F,G)=>{},sqlite3_randomness:(f,p)=>{}});const O={affirmBindableTypedArray:H,flexibleString:m,bigIntFits32:T,bigIntFits64:oe,bigIntFitsDouble:g,isBindableTypedArray:B,isInt32:ee,isSQLableTypedArray:J,isTypedArray:w,typedArrayToString:le,isUIThread:()=>globalThis.window===globalThis&&!!globalThis.document,isSharedTypedArray:A,toss:function(...f){throw new Error(f.join(" "))},toss3:X,typedArrayPart:q};Object.assign(d,{ptrSizeof:a.wasmPtrSizeof||4,ptrIR:a.wasmPtrIR||"i32",bigIntEnabled:!!a.bigIntEnabled,exports:a.exports||X("Missing API config.exports (WASM module exports)."),memory:a.memory||a.exports.memory||X("API config object requires a WebAssembly.Memory object","in either config.exports.memory (exported)","or config.memory (imported)."),alloc:void 0,realloc:void 0,dealloc:void 0}),d.allocFromTypedArray=function(f){f instanceof ArrayBuffer&&(f=new Uint8Array(f)),H(f);const p=d.alloc(f.byteLength||1);return d.heapForSize(f.constructor).set(f.byteLength?f:[0],p),p};{const f=a.allocExportName,p=a.deallocExportName,_=a.reallocExportName;for(const F of[f,p,_])d.exports[F]instanceof Function||X("Missing required exports[",F,"] function.");d.alloc=function F(G){return F.impl(G)||N.toss("Failed to allocate",G," bytes.")},d.alloc.impl=d.exports[f],d.realloc=function F(G,re){const ae=F.impl(G,re);return re?ae||N.toss("Failed to reallocate",re," bytes."):0},d.realloc.impl=d.exports[_],d.dealloc=d.exports[p]}d.compileOptionUsed=function f(p){if(arguments.length){if(Array.isArray(p)){const _={};return p.forEach(F=>{_[F]=c.sqlite3_compileoption_used(F)}),_}else if(typeof p=="object")return Object.keys(p).forEach(_=>{p[_]=c.sqlite3_compileoption_used(_)}),p}else{if(f._result)return f._result;f._opt||(f._rx=/^([^=]+)=(.+)/,f._rxInt=/^-?\d+$/,f._opt=function(ae,ie){const ce=f._rx.exec(ae);ie[0]=ce?ce[1]:ae,ie[1]=ce?f._rxInt.test(ce[2])?+ce[2]:ce[2]:!0});const _={},F=[0,0];let G=0,re;for(;re=c.sqlite3_compileoption_get(G++);)f._opt(re,F),_[F[0]]=F[1];return f._result=_}return typeof p=="string"?!!c.sqlite3_compileoption_used(p):!1},d.pstack=Object.assign(Object.create(null),{restore:d.exports.sqlite3_wasm_pstack_restore,alloc:function(f){return typeof f=="string"&&!(f=d.sizeofIR(f))&&N.toss("Invalid value for pstack.alloc(",arguments[0],")"),d.exports.sqlite3_wasm_pstack_alloc(f)||N.toss("Could not allocate",f,"bytes from the pstack.")},allocChunks:function(f,p){typeof p=="string"&&!(p=d.sizeofIR(p))&&N.toss("Invalid size value for allocChunks(",arguments[1],")");const _=d.pstack.alloc(f*p),F=[];let G=0,re=0;for(;G<f;++G,re+=p)F.push(_+re);return F},allocPtr:(f=1,p=!0)=>f===1?d.pstack.alloc(p?8:d.ptrSizeof):d.pstack.allocChunks(f,p?8:d.ptrSizeof)}),Object.defineProperties(d.pstack,{pointer:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_ptr},quota:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_quota},remaining:{configurable:!1,iterable:!0,writeable:!1,get:d.exports.sqlite3_wasm_pstack_remaining}}),c.sqlite3_randomness=(...f)=>{if(f.length===1&&O.isTypedArray(f[0])&&f[0].BYTES_PER_ELEMENT===1){const p=f[0];if(p.byteLength===0)return d.exports.sqlite3_randomness(0,0),p;const _=d.pstack.pointer;try{let F=p.byteLength,G=0;const re=d.exports.sqlite3_randomness,ae=d.heap8u(),ie=F<512?F:512,ce=d.pstack.alloc(ie);do{const ue=F>ie?ie:F;re(ue,ce),p.set(q(ae,ce,ce+ue),G),F-=ue,G+=ue}while(F>0)}catch(F){console.error("Highly unexpected (and ignored!) exception in sqlite3_randomness():",F)}finally{d.pstack.restore(_)}return p}d.exports.sqlite3_randomness(...f)};let z;if(c.sqlite3_wasmfs_opfs_dir=function(){if(z!==void 0)return z;const f=a.wasmfsOpfsDir;if(!f||!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle)return z="";try{return f&&d.xCallWrapped("sqlite3_wasm_init_wasmfs","i32",["string"],f)===0?z=f:z=""}catch{return z=""}},c.sqlite3_wasmfs_filename_is_persistent=function(f){const p=c.sqlite3_wasmfs_opfs_dir();return p&&f?f.startsWith(p+"/"):!1},c.sqlite3_js_db_uses_vfs=function(f,p,_=0){try{const F=c.sqlite3_vfs_find(p);return F?f?F===c.sqlite3_js_db_vfs(f,_)?F:!1:F===c.sqlite3_vfs_find(0)?F:!1:!1}catch{return!1}},c.sqlite3_js_vfs_list=function(){const f=[];let p=c.sqlite3_vfs_find(0);for(;p;){const _=new c.sqlite3_vfs(p);f.push(d.cstrToJs(_.$zName)),p=_.$pNext,_.dispose()}return f},c.sqlite3_js_db_export=function(f,p=0){f=d.xWrap.testConvertArg("sqlite3*",f),f||X("Invalid sqlite3* argument."),d.bigIntEnabled||X("BigInt64 support is not enabled.");const _=d.scopedAllocPush();let F;try{const G=d.scopedAlloc(8+d.ptrSizeof),re=G+8,ae=p?d.isPtr(p)?p:d.scopedAllocCString(""+p):0;let ie=d.exports.sqlite3_wasm_db_serialize(f,ae,re,G,0);ie&&X("Database serialization failed with code",v.capi.sqlite3_js_rc_str(ie)),F=d.peekPtr(re);const ce=d.peek(G,"i64");return ie=ce?d.heap8u().slice(F,F+Number(ce)):new Uint8Array,ie}finally{F&&d.exports.sqlite3_free(F),d.scopedAllocPop(_)}},c.sqlite3_js_db_vfs=(f,p=0)=>d.sqlite3_wasm_db_vfs(f,p),c.sqlite3_js_aggregate_context=(f,p)=>c.sqlite3_aggregate_context(f,p)||(p?N.toss("Cannot allocate",p,"bytes for sqlite3_aggregate_context()"):0),c.sqlite3_js_posix_create_file=function(f,p,_){let F;p&&d.isPtr(p)?F=p:p instanceof ArrayBuffer||p instanceof Uint8Array?(F=d.allocFromTypedArray(p),(arguments.length<3||!O.isInt32(_)||_<0)&&(_=p.byteLength)):L.toss("Invalid 2nd argument for sqlite3_js_posix_create_file().");try{(!O.isInt32(_)||_<0)&&L.toss("Invalid 3rd argument for sqlite3_js_posix_create_file().");const G=d.sqlite3_wasm_posix_create_file(f,F,_);G&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(G))}finally{d.dealloc(F)}},c.sqlite3_js_vfs_create_file=function(f,p,_,F){a.warn("sqlite3_js_vfs_create_file() is deprecated and","should be avoided because it can lead to C-level crashes.","See its documentation for alternative options.");let G;_?(d.isPtr(_)?G=_:_ instanceof ArrayBuffer&&(_=new Uint8Array(_)),_ instanceof Uint8Array?(G=d.allocFromTypedArray(_),(arguments.length<4||!O.isInt32(F)||F<0)&&(F=_.byteLength)):L.toss("Invalid 3rd argument type for sqlite3_js_vfs_create_file().")):G=0,(!O.isInt32(F)||F<0)&&(d.dealloc(G),L.toss("Invalid 4th argument for sqlite3_js_vfs_create_file()."));try{const re=d.sqlite3_wasm_vfs_create_file(f,p,G,F);re&&L.toss("Creation of file failed with sqlite3 result code",c.sqlite3_js_rc_str(re))}finally{d.dealloc(G)}},O.isUIThread()){const f=function(p){const _=Object.create(null);return _.prefix="kvvfs-"+p,_.stores=[],(p==="session"||p==="")&&_.stores.push(globalThis.sessionStorage),(p==="local"||p==="")&&_.stores.push(globalThis.localStorage),_};c.sqlite3_js_kvvfs_clear=function(p=""){let _=0;const F=f(p);return F.stores.forEach(G=>{const re=[];let ae;for(ae=0;ae<G.length;++ae){const ie=G.key(ae);ie.startsWith(F.prefix)&&re.push(ie)}re.forEach(ie=>G.removeItem(ie)),_+=re.length}),_},c.sqlite3_js_kvvfs_size=function(p=""){let _=0;const F=f(p);return F.stores.forEach(G=>{let re;for(re=0;re<G.length;++re){const ae=G.key(re);ae.startsWith(F.prefix)&&(_+=ae.length,_+=G.getItem(ae).length)}}),_*2}}c.sqlite3_db_config=(function(f,p,..._){switch(this.s||(this.s=d.xWrap("sqlite3_wasm_db_config_s","int",["sqlite3*","int","string:static"]),this.pii=d.xWrap("sqlite3_wasm_db_config_pii","int",["sqlite3*","int","*","int","int"]),this.ip=d.xWrap("sqlite3_wasm_db_config_ip","int",["sqlite3*","int","int","*"])),p){case c.SQLITE_DBCONFIG_ENABLE_FKEY:case c.SQLITE_DBCONFIG_ENABLE_TRIGGER:case c.SQLITE_DBCONFIG_ENABLE_FTS3_TOKENIZER:case c.SQLITE_DBCONFIG_ENABLE_LOAD_EXTENSION:case c.SQLITE_DBCONFIG_NO_CKPT_ON_CLOSE:case c.SQLITE_DBCONFIG_ENABLE_QPSG:case c.SQLITE_DBCONFIG_TRIGGER_EQP:case c.SQLITE_DBCONFIG_RESET_DATABASE:case c.SQLITE_DBCONFIG_DEFENSIVE:case c.SQLITE_DBCONFIG_WRITABLE_SCHEMA:case c.SQLITE_DBCONFIG_LEGACY_ALTER_TABLE:case c.SQLITE_DBCONFIG_DQS_DML:case c.SQLITE_DBCONFIG_DQS_DDL:case c.SQLITE_DBCONFIG_ENABLE_VIEW:case c.SQLITE_DBCONFIG_LEGACY_FILE_FORMAT:case c.SQLITE_DBCONFIG_TRUSTED_SCHEMA:case c.SQLITE_DBCONFIG_STMT_SCANSTATUS:case c.SQLITE_DBCONFIG_REVERSE_SCANORDER:return this.ip(f,p,_[0],_[1]||0);case c.SQLITE_DBCONFIG_LOOKASIDE:return this.pii(f,p,_[0],_[1],_[2]);case c.SQLITE_DBCONFIG_MAINDBNAME:return this.s(f,p,_[0]);default:return c.SQLITE_MISUSE}}).bind(Object.create(null)),c.sqlite3_value_to_js=function(f,p=!0){let _;const F=c.sqlite3_value_type(f);switch(F){case c.SQLITE_INTEGER:d.bigIntEnabled?(_=c.sqlite3_value_int64(f),O.bigIntFitsDouble(_)&&(_=Number(_))):_=c.sqlite3_value_double(f);break;case c.SQLITE_FLOAT:_=c.sqlite3_value_double(f);break;case c.SQLITE_TEXT:_=c.sqlite3_value_text(f);break;case c.SQLITE_BLOB:{const G=c.sqlite3_value_bytes(f),re=c.sqlite3_value_blob(f);G&&!re&&v.WasmAllocError.toss("Cannot allocate memory for blob argument of",G,"byte(s)"),_=G?d.heap8u().slice(re,re+Number(G)):null;break}case c.SQLITE_NULL:_=null;break;default:p&&X(c.SQLITE_MISMATCH,"Unhandled sqlite3_value_type():",F),_=void 0}return _},c.sqlite3_values_to_js=function(f,p,_=!0){let F;const G=[];for(F=0;F<f;++F)G.push(c.sqlite3_value_to_js(d.peekPtr(p+d.ptrSizeof*F),_));return G},c.sqlite3_result_error_js=function(f,p){p instanceof N?c.sqlite3_result_error_nomem(f):c.sqlite3_result_error(f,""+p,-1)},c.sqlite3_result_js=function(f,p){if(p instanceof Error){c.sqlite3_result_error_js(f,p);return}try{switch(typeof p){case"undefined":break;case"boolean":c.sqlite3_result_int(f,p?1:0);break;case"bigint":O.bigIntFits32(p)?c.sqlite3_result_int(f,Number(p)):O.bigIntFitsDouble(p)?c.sqlite3_result_double(f,Number(p)):d.bigIntEnabled?O.bigIntFits64(p)?c.sqlite3_result_int64(f,p):X("BigInt value",p.toString(),"is too BigInt for int64."):X("BigInt value",p.toString(),"is too BigInt.");break;case"number":{let _;O.isInt32(p)?_=c.sqlite3_result_int:d.bigIntEnabled&&Number.isInteger(p)&&O.bigIntFits64(BigInt(p))?_=c.sqlite3_result_int64:_=c.sqlite3_result_double,_(f,p);break}case"string":{const[_,F]=d.allocCString(p,!0);c.sqlite3_result_text(f,_,F,c.SQLITE_WASM_DEALLOC);break}case"object":if(p===null){c.sqlite3_result_null(f);break}else if(O.isBindableTypedArray(p)){const _=d.allocFromTypedArray(p);c.sqlite3_result_blob(f,_,p.byteLength,c.SQLITE_WASM_DEALLOC);break}default:X("Don't not how to handle this UDF result value:",typeof p,p)}}catch(_){c.sqlite3_result_error_js(f,_)}},c.sqlite3_column_js=function(f,p,_=!0){const F=c.sqlite3_column_value(f,p);return F===0?void 0:c.sqlite3_value_to_js(F,_)};const y=(function(f,p,_){_=c[_],this.ptr?d.pokePtr(this.ptr,0):this.ptr=d.allocPtr();const F=_(f,p,this.ptr);if(F)return L.toss(F,arguments[2]+"() failed with code "+F);const G=d.peekPtr(this.ptr);return G?c.sqlite3_value_to_js(G,!0):void 0}).bind(Object.create(null));c.sqlite3_preupdate_new_js=(f,p)=>y(f,p,"sqlite3_preupdate_new"),c.sqlite3_preupdate_old_js=(f,p)=>y(f,p,"sqlite3_preupdate_old"),c.sqlite3changeset_new_js=(f,p)=>y(f,p,"sqlite3changeset_new"),c.sqlite3changeset_old_js=(f,p)=>y(f,p,"sqlite3changeset_old");const v={WasmAllocError:N,SQLite3Error:L,capi:c,util:O,wasm:d,config:a,version:Object.create(null),client:void 0,asyncPostInit:async function f(){if(f.isReady instanceof Promise)return f.isReady;let p=i.initializersAsync;delete i.initializersAsync;const _=async()=>(v.__isUnderTest||(delete v.util,delete v.StructBinder),v),F=re=>{throw a.error("an async sqlite3 initializer failed:",re),re};if(!p||!p.length)return f.isReady=_().catch(F);p=p.map(re=>re instanceof Function?async ae=>re(v):re),p.push(_);let G=Promise.resolve(v);for(;p.length;)G=G.then(p.shift());return f.isReady=G.catch(F)},scriptInfo:void 0};try{i.initializers.forEach(f=>{f(v)})}catch(f){throw console.error("sqlite3 bootstrap initializer threw:",f),f}return delete i.initializers,i.sqlite3=v,v},globalThis.sqlite3ApiBootstrap.initializers=[],globalThis.sqlite3ApiBootstrap.initializersAsync=[],globalThis.sqlite3ApiBootstrap.defaultConfig=Object.create(null),globalThis.sqlite3ApiBootstrap.sqlite3=void 0,globalThis.WhWasmUtilInstaller=function(i){i.bigIntEnabled===void 0&&(i.bigIntEnabled=!!globalThis.BigInt64Array);const l=(...m)=>{throw new Error(m.join(" "))};i.exports||Object.defineProperty(i,"exports",{enumerable:!0,configurable:!0,get:()=>i.instance&&i.instance.exports});const a=i.pointerIR||"i32",c=i.ptrSizeof=a==="i32"?4:a==="i64"?8:l("Unhandled ptrSizeof:",a),d=Object.create(null);d.heapSize=0,d.memory=null,d.freeFuncIndexes=[],d.scopedAlloc=[],d.utf8Decoder=new TextDecoder,d.utf8Encoder=new TextEncoder("utf-8"),i.sizeofIR=m=>{switch(m){case"i8":return 1;case"i16":return 2;case"i32":case"f32":case"float":return 4;case"i64":case"f64":case"double":return 8;case"*":return c;default:return(""+m).endsWith("*")?c:void 0}};const b=function(){if(!d.memory)d.memory=i.memory instanceof WebAssembly.Memory?i.memory:i.exports.memory;else if(d.heapSize===d.memory.buffer.byteLength)return d;const m=d.memory.buffer;return d.HEAP8=new Int8Array(m),d.HEAP8U=new Uint8Array(m),d.HEAP16=new Int16Array(m),d.HEAP16U=new Uint16Array(m),d.HEAP32=new Int32Array(m),d.HEAP32U=new Uint32Array(m),i.bigIntEnabled&&(d.HEAP64=new BigInt64Array(m),d.HEAP64U=new BigUint64Array(m)),d.HEAP32F=new Float32Array(m),d.HEAP64F=new Float64Array(m),d.heapSize=m.byteLength,d};i.heap8=()=>b().HEAP8,i.heap8u=()=>b().HEAP8U,i.heap16=()=>b().HEAP16,i.heap16u=()=>b().HEAP16U,i.heap32=()=>b().HEAP32,i.heap32u=()=>b().HEAP32U,i.heapForSize=function(m,N=!0){const O=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b();switch(m){case Int8Array:return O.HEAP8;case Uint8Array:return O.HEAP8U;case Int16Array:return O.HEAP16;case Uint16Array:return O.HEAP16U;case Int32Array:return O.HEAP32;case Uint32Array:return O.HEAP32U;case 8:return N?O.HEAP8U:O.HEAP8;case 16:return N?O.HEAP16U:O.HEAP16;case 32:return N?O.HEAP32U:O.HEAP32;case 64:if(O.HEAP64)return N?O.HEAP64U:O.HEAP64;break;default:if(i.bigIntEnabled){if(m===globalThis.BigUint64Array)return O.HEAP64U;if(m===globalThis.BigInt64Array)return O.HEAP64;break}}l("Invalid heapForSize() size: expecting 8, 16, 32,","or (if BigInt is enabled) 64.")},i.functionTable=function(){return i.exports.__indirect_function_table},i.functionEntry=function(m){const N=i.functionTable();return m<N.length?N.get(m):void 0},i.jsFuncToWasm=function m(N,O){if(m._||(m._={sigTypes:Object.assign(Object.create(null),{i:"i32",p:"i32",P:"i32",s:"i32",j:"i64",f:"f32",d:"f64"}),typeCodes:Object.assign(Object.create(null),{f64:124,f32:125,i64:126,i32:127}),uleb128Encode:function(v,f,p){p<128?v[f](p):v[f](p%128|128,p>>7)},rxJSig:/^(\w)\((\w*)\)$/,sigParams:function(v){const f=m._.rxJSig.exec(v);return f?f[2]:v.substr(1)},letterType:v=>m._.sigTypes[v]||l("Invalid signature letter:",v),pushSigType:(v,f)=>v.push(m._.typeCodes[m._.letterType(f)])}),typeof N=="string"){const v=O;O=N,N=v}const z=m._.sigParams(O),y=[1,96];m._.uleb128Encode(y,"push",z.length);for(const v of z)m._.pushSigType(y,v);return O[0]==="v"?y.push(0):(y.push(1),m._.pushSigType(y,O[0])),m._.uleb128Encode(y,"unshift",y.length),y.unshift(0,97,115,109,1,0,0,0,1),y.push(2,7,1,1,101,1,102,0,0,7,5,1,1,102,0,0),new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array(y)),{e:{f:N}}).exports.f};const k=function(N,O,z){if(z&&!d.scopedAlloc.length&&l("No scopedAllocPush() scope is active."),typeof N=="string"){const p=O;O=N,N=p}(typeof O!="string"||!(N instanceof Function))&&l("Invalid arguments: expecting (function,signature) or (signature,function).");const y=i.functionTable(),v=y.length;let f;for(;d.freeFuncIndexes.length&&(f=d.freeFuncIndexes.pop(),y.get(f));){f=null;continue}f||(f=v,y.grow(1));try{return y.set(f,N),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(f),f}catch(p){if(!(p instanceof TypeError))throw f===v&&d.freeFuncIndexes.push(v),p}try{const p=i.jsFuncToWasm(N,O);y.set(f,p),z&&d.scopedAlloc[d.scopedAlloc.length-1].push(f)}catch(p){throw f===v&&d.freeFuncIndexes.push(v),p}return f};i.installFunction=(m,N)=>k(m,N,!1),i.scopedInstallFunction=(m,N)=>k(m,N,!0),i.uninstallFunction=function(m){if(!m&&m!==0)return;const N=d.freeFuncIndexes,O=i.functionTable();N.push(m);const z=O.get(m);return O.set(m,null),z},i.peek=function(N,O="i8"){O.endsWith("*")&&(O=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b(),y=Array.isArray(N)?[]:void 0;let v;do{switch(y&&(N=arguments[0].shift()),O){case"i1":case"i8":v=z.HEAP8[N>>0];break;case"i16":v=z.HEAP16[N>>1];break;case"i32":v=z.HEAP32[N>>2];break;case"float":case"f32":v=z.HEAP32F[N>>2];break;case"double":case"f64":v=Number(z.HEAP64F[N>>3]);break;case"i64":if(i.bigIntEnabled){v=BigInt(z.HEAP64[N>>3]);break}default:l("Invalid type for peek():",O)}y&&y.push(v)}while(y&&arguments[0].length);return y||v},i.poke=function(m,N,O="i8"){O.endsWith("*")&&(O=a);const z=d.memory&&d.heapSize===d.memory.buffer.byteLength?d:b();for(const y of Array.isArray(m)?m:[m])switch(O){case"i1":case"i8":z.HEAP8[y>>0]=N;continue;case"i16":z.HEAP16[y>>1]=N;continue;case"i32":z.HEAP32[y>>2]=N;continue;case"float":case"f32":z.HEAP32F[y>>2]=N;continue;case"double":case"f64":z.HEAP64F[y>>3]=N;continue;case"i64":if(z.HEAP64){z.HEAP64[y>>3]=BigInt(N);continue}default:l("Invalid type for poke(): "+O)}return this},i.peekPtr=(...m)=>i.peek(m.length===1?m[0]:m,a),i.pokePtr=(m,N=0)=>i.poke(m,N,a),i.peek8=(...m)=>i.peek(m.length===1?m[0]:m,"i8"),i.poke8=(m,N)=>i.poke(m,N,"i8"),i.peek16=(...m)=>i.peek(m.length===1?m[0]:m,"i16"),i.poke16=(m,N)=>i.poke(m,N,"i16"),i.peek32=(...m)=>i.peek(m.length===1?m[0]:m,"i32"),i.poke32=(m,N)=>i.poke(m,N,"i32"),i.peek64=(...m)=>i.peek(m.length===1?m[0]:m,"i64"),i.poke64=(m,N)=>i.poke(m,N,"i64"),i.peek32f=(...m)=>i.peek(m.length===1?m[0]:m,"f32"),i.poke32f=(m,N)=>i.poke(m,N,"f32"),i.peek64f=(...m)=>i.peek(m.length===1?m[0]:m,"f64"),i.poke64f=(m,N)=>i.poke(m,N,"f64"),i.getMemValue=i.peek,i.getPtrValue=i.peekPtr,i.setMemValue=i.poke,i.setPtrValue=i.pokePtr,i.isPtr32=m=>typeof m=="number"&&m===(m|0)&&m>=0,i.isPtr=i.isPtr32,i.cstrlen=function(m){if(!m||!i.isPtr(m))return null;const N=b().HEAP8U;let O=m;for(;N[O]!==0;++O);return O-m};const L=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,X=function(m,N,O){return d.utf8Decoder.decode(m.buffer instanceof L?m.slice(N,O):m.subarray(N,O))};i.cstrToJs=function(m){const N=i.cstrlen(m);return N?X(b().HEAP8U,m,m+N):N===null?N:""},i.jstrlen=function(m){if(typeof m!="string")return null;const N=m.length;let O=0;for(let z=0;z<N;++z){let y=m.charCodeAt(z);y>=55296&&y<=57343&&(y=65536+((y&1023)<<10)|m.charCodeAt(++z)&1023),y<=127?++O:y<=2047?O+=2:y<=65535?O+=3:O+=4}return O},i.jstrcpy=function(m,N,O=0,z=-1,y=!0){if((!N||!(N instanceof Int8Array)&&!(N instanceof Uint8Array))&&l("jstrcpy() target must be an Int8Array or Uint8Array."),z<0&&(z=N.length-O),!(z>0)||!(O>=0))return 0;let v=0,f=m.length;const p=O,_=O+z-(y?1:0);for(;v<f&&O<_;++v){let F=m.charCodeAt(v);if(F>=55296&&F<=57343&&(F=65536+((F&1023)<<10)|m.charCodeAt(++v)&1023),F<=127){if(O>=_)break;N[O++]=F}else if(F<=2047){if(O+1>=_)break;N[O++]=192|F>>6,N[O++]=128|F&63}else if(F<=65535){if(O+2>=_)break;N[O++]=224|F>>12,N[O++]=128|F>>6&63,N[O++]=128|F&63}else{if(O+3>=_)break;N[O++]=240|F>>18,N[O++]=128|F>>12&63,N[O++]=128|F>>6&63,N[O++]=128|F&63}}return y&&(N[O++]=0),O-p},i.cstrncpy=function(m,N,O){if((!m||!N)&&l("cstrncpy() does not accept NULL strings."),O<0)O=i.cstrlen(strPtr)+1;else if(!(O>0))return 0;const z=i.heap8u();let y=0,v;for(;y<O&&(v=z[N+y]);++y)z[m+y]=v;return y<O&&(z[m+y++]=0),y},i.jstrToUintArray=(m,N=!1)=>d.utf8Encoder.encode(N?m+"\0":m);const ee=(m,N)=>{(!(m.alloc instanceof Function)||!(m.dealloc instanceof Function))&&l("Object is missing alloc() and/or dealloc() function(s)","required by",N+"().")},oe=function(m,N,O,z){if(ee(i,z),typeof m!="string")return null;{const y=d.utf8Encoder.encode(m),v=O(y.length+1),f=b().HEAP8U;return f.set(y,v),f[v+y.length]=0,N?[v,y.length]:v}};i.allocCString=(m,N=!1)=>oe(m,N,i.alloc,"allocCString()"),i.scopedAllocPush=function(){ee(i,"scopedAllocPush");const m=[];return d.scopedAlloc.push(m),m},i.scopedAllocPop=function(m){ee(i,"scopedAllocPop");const N=arguments.length?d.scopedAlloc.indexOf(m):d.scopedAlloc.length-1;N<0&&l("Invalid state object for scopedAllocPop()."),arguments.length===0&&(m=d.scopedAlloc[N]),d.scopedAlloc.splice(N,1);for(let O;O=m.pop();)i.functionEntry(O)?i.uninstallFunction(O):i.dealloc(O)},i.scopedAlloc=function(m){d.scopedAlloc.length||l("No scopedAllocPush() scope is active.");const N=i.alloc(m);return d.scopedAlloc[d.scopedAlloc.length-1].push(N),N},Object.defineProperty(i.scopedAlloc,"level",{configurable:!1,enumerable:!1,get:()=>d.scopedAlloc.length,set:()=>l("The 'active' property is read-only.")}),i.scopedAllocCString=(m,N=!1)=>oe(m,N,i.scopedAlloc,"scopedAllocCString()");const T=function(m,N){const O=i[m?"scopedAlloc":"alloc"]((N.length+1)*i.ptrSizeof);let z=0;return N.forEach(y=>{i.pokePtr(O+i.ptrSizeof*z++,i[m?"scopedAllocCString":"allocCString"](""+y))}),i.pokePtr(O+i.ptrSizeof*z,0),O};i.scopedAllocMainArgv=m=>T(!0,m),i.allocMainArgv=m=>T(!1,m),i.cArgvToJs=(m,N)=>{const O=[];for(let z=0;z<m;++z){const y=i.peekPtr(N+i.ptrSizeof*z);O.push(y?i.cstrToJs(y):null)}return O},i.scopedAllocCall=function(m){i.scopedAllocPush();try{return m()}finally{i.scopedAllocPop()}};const g=function(m,N,O){ee(i,O);const z=N?"i64":a;let y=i[O](m*(N?8:c));if(i.poke(y,0,z),m===1)return y;const v=[y];for(let f=1;f<m;++f)y+=N?8:c,v[f]=y,i.poke(y,0,z);return v};i.allocPtr=(m=1,N=!0)=>g(m,N,"alloc"),i.scopedAllocPtr=(m=1,N=!0)=>g(m,N,"scopedAlloc"),i.xGet=function(m){return i.exports[m]||l("Cannot find exported symbol:",m)};const w=(m,N)=>l(m+"() requires",N,"argument(s).");i.xCall=function(m,...N){const O=i.xGet(m);return O instanceof Function||l("Exported symbol",m,"is not a function."),O.length!==N.length&&w(m,O.length),arguments.length===2&&Array.isArray(arguments[1])?O.apply(null,arguments[1]):O.apply(null,N)},d.xWrap=Object.create(null),d.xWrap.convert=Object.create(null),d.xWrap.convert.arg=new Map,d.xWrap.convert.result=new Map;const E=d.xWrap.convert.arg,A=d.xWrap.convert.result;i.bigIntEnabled&&E.set("i64",m=>BigInt(m));const q=a==="i32"?m=>m|0:m=>BigInt(m)|BigInt(0);E.set("i32",q).set("i16",m=>(m|0)&65535).set("i8",m=>(m|0)&255).set("f32",m=>Number(m).valueOf()).set("float",E.get("f32")).set("f64",E.get("f32")).set("double",E.get("f64")).set("int",E.get("i32")).set("null",m=>m).set(null,E.get("null")).set("**",q).set("*",q),A.set("*",q).set("pointer",q).set("number",m=>Number(m)).set("void",m=>{}).set("null",m=>m).set(null,A.get("null"));{const m=["i8","i16","i32","int","f32","float","f64","double"];i.bigIntEnabled&&m.push("i64");const N=E.get(a);for(const O of m)E.set(O+"*",N),A.set(O+"*",N),A.set(O,E.get(O)||l("Missing arg converter:",O))}const B=function(m){return typeof m=="string"?i.scopedAllocCString(m):m?q(m):null};E.set("string",B).set("utf8",B).set("pointer",B),A.set("string",m=>i.cstrToJs(m)).set("utf8",A.get("string")).set("string:dealloc",m=>{try{return m?i.cstrToJs(m):null}finally{i.dealloc(m)}}).set("utf8:dealloc",A.get("string:dealloc")).set("json",m=>JSON.parse(i.cstrToJs(m))).set("json:dealloc",m=>{try{return m?JSON.parse(i.cstrToJs(m)):null}finally{i.dealloc(m)}});const J=class{constructor(m){this.name=m.name||"unnamed adapter"}convertArg(m,N,O){l("AbstractArgAdapter must be subclassed.")}};E.FuncPtrAdapter=class gn extends J{constructor(N){super(N),E.FuncPtrAdapter.warnOnUse&&console.warn("xArg.FuncPtrAdapter is an internal-only API","and is not intended to be invoked from","client-level code. Invoked with:",N),this.name=N.name||"unnamed",this.signature=N.signature,N.contextKey instanceof Function&&(this.contextKey=N.contextKey,N.bindScope||(N.bindScope="context")),this.bindScope=N.bindScope||l("FuncPtrAdapter options requires a bindScope (explicit or implied)."),gn.bindScopes.indexOf(N.bindScope)<0&&l("Invalid options.bindScope ("+N.bindMod+") for FuncPtrAdapter. Expecting one of: ("+gn.bindScopes.join(", ")+")"),this.isTransient=this.bindScope==="transient",this.isContext=this.bindScope==="context",this.isPermanent=this.bindScope==="permanent",this.singleton=this.bindScope==="singleton"?[]:void 0,this.callProxy=N.callProxy instanceof Function?N.callProxy:void 0}contextKey(N,O){return this}contextMap(N){const O=this.__cmap||(this.__cmap=new Map);let z=O.get(N);return z===void 0&&O.set(N,z=[]),z}convertArg(N,O,z){let y=this.singleton;if(!y&&this.isContext&&(y=this.contextMap(this.contextKey(O,z))),y&&y[0]===N)return y[1];if(N instanceof Function){this.callProxy&&(N=this.callProxy(N));const v=k(N,this.signature,this.isTransient);if(gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter installed",this,this.contextKey(O,z),"@"+v,N),y){if(y[1]){gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(O,z),"@"+y[1],N);try{d.scopedAlloc[d.scopedAlloc.length-1].push(y[1])}catch{}}y[0]=N,y[1]=v}return v}else if(i.isPtr(N)||N===null||N===void 0){if(y&&y[1]&&y[1]!==N){gn.debugFuncInstall&&gn.debugOut("FuncPtrAdapter uninstalling",this,this.contextKey(O,z),"@"+y[1],N);try{d.scopedAlloc[d.scopedAlloc.length-1].push(y[1])}catch{}y[0]=y[1]=N|0}return N||0}else throw new TypeError("Invalid FuncPtrAdapter argument type. Expecting a function pointer or a "+(this.name?this.name+" ":"")+"function matching signature "+this.signature+".")}},E.FuncPtrAdapter.warnOnUse=!1,E.FuncPtrAdapter.debugFuncInstall=!1,E.FuncPtrAdapter.debugOut=console.debug.bind(console),E.FuncPtrAdapter.bindScopes=["transient","context","singleton","permanent"];const H=m=>E.get(m)||l("Argument adapter not found:",m),U=m=>A.get(m)||l("Result adapter not found:",m);d.xWrap.convertArg=(m,...N)=>H(m)(...N),d.xWrap.convertArgNoCheck=(m,...N)=>E.get(m)(...N),d.xWrap.convertResult=(m,N)=>m===null?N:m?U(m)(N):void 0,d.xWrap.convertResultNoCheck=(m,N)=>m===null?N:m?A.get(m)(N):void 0,i.xWrap=function(m,N,...O){arguments.length===3&&Array.isArray(arguments[2])&&(O=arguments[2]),i.isPtr(m)&&(m=i.functionEntry(m)||l("Function pointer not found in WASM function table."));const z=m instanceof Function,y=z?m:i.xGet(m);if(z&&(m=y.name||"unnamed function"),O.length!==y.length&&w(m,y.length),N===null&&y.length===0)return y;N!=null&&U(N);for(const f of O)f instanceof J?E.set(f,(...p)=>f.convertArg(...p)):H(f);const v=d.xWrap;return y.length===0?(...f)=>f.length?w(m,y.length):v.convertResult(N,y.call(null)):function(...f){f.length!==y.length&&w(m,y.length);const p=i.scopedAllocPush();try{for(const _ in f)f[_]=v.convertArgNoCheck(O[_],f[_],f,_);return v.convertResultNoCheck(N,y.apply(null,f))}finally{i.scopedAllocPop(p)}}};const le=function(m,N,O,z,y,v){if(typeof O=="string"){if(N===1)return v.get(O);if(N===2){if(z)z instanceof Function||l(y,"requires a function argument.");else return delete v.get(O),m;return v.set(O,z),m}}l("Invalid arguments to",y)};return i.xWrap.resultAdapter=function m(N,O){return le(m,arguments.length,N,O,"resultAdapter()",A)},i.xWrap.argAdapter=function m(N,O){return le(m,arguments.length,N,O,"argAdapter()",E)},i.xWrap.FuncPtrAdapter=E.FuncPtrAdapter,i.xCallWrapped=function(m,N,O,...z){return Array.isArray(arguments[3])&&(z=arguments[3]),i.xWrap(m,N,O||[]).apply(null,z||[])},i.xWrap.testConvertArg=d.xWrap.convertArg,i.xWrap.testConvertResult=d.xWrap.convertResult,i},globalThis.WhWasmUtilInstaller.yawl=(function(i){const l=()=>fetch(i.uri,{credentials:"same-origin"}),a=this,c=function(b){if(i.wasmUtilTarget){const k=(...X)=>{throw new Error(X.join(" "))},L=i.wasmUtilTarget;if(L.module=b.module,L.instance=b.instance,L.instance.exports.memory||(L.memory=i.imports&&i.imports.env&&i.imports.env.memory||k("Missing 'memory' object!")),!L.alloc&&b.instance.exports.malloc){const X=b.instance.exports;L.alloc=function(ee){return X.malloc(ee)||k("Allocation of",ee,"bytes failed.")},L.dealloc=function(ee){X.free(ee)}}a(L)}return i.onload&&i.onload(b,i),b};return WebAssembly.instantiateStreaming?function(){return WebAssembly.instantiateStreaming(l(),i.imports||{}).then(c)}:function(){return l().then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,i.imports||{})).then(c)}}).bind(globalThis.WhWasmUtilInstaller),globalThis.Jaccwabyt=function i(l){const a=(...x)=>{throw new Error(x.join(" "))};!(l.heap instanceof WebAssembly.Memory)&&!(l.heap instanceof Function)&&a("config.heap must be WebAssembly.Memory instance or a function."),["alloc","dealloc"].forEach(function(x){l[x]instanceof Function||a("Config option '"+x+"' must be a function.")});const c=i,d=l.heap instanceof Function?l.heap:()=>new Uint8Array(l.heap.buffer),b=l.alloc,k=l.dealloc,L=l.log||console.log.bind(console),X=l.memberPrefix||"",ee=l.memberSuffix||"",oe=l.bigIntEnabled===void 0?!!globalThis.BigInt64Array:!!l.bigIntEnabled,T=globalThis.BigInt,g=globalThis.BigInt64Array,w=l.ptrSizeof||4,E=l.ptrIR||"i32";c.debugFlags||(c.__makeDebugFlags=function(x=null){x&&x.__flags&&(x=x.__flags);const P=function W($){return arguments.length===0?W.__flags:($<0?(delete W.__flags.getter,delete W.__flags.setter,delete W.__flags.alloc,delete W.__flags.dealloc):(W.__flags.getter=(1&$)!==0,W.__flags.setter=(2&$)!==0,W.__flags.alloc=(4&$)!==0,W.__flags.dealloc=(8&$)!==0),W._flags)};return Object.defineProperty(P,"__flags",{iterable:!1,writable:!1,value:Object.create(x)}),x||P(0),P},c.debugFlags=c.__makeDebugFlags());const A=function(){const x=new ArrayBuffer(2);return new DataView(x).setInt16(0,256,!0),new Int16Array(x)[0]===256}(),q=x=>x[1]==="(",B=x=>x==="P",J=x=>q(x)?"p":x[0],H=function(x){switch(J(x)){case"c":case"C":return"i8";case"i":return"i32";case"p":case"P":case"s":return E;case"j":return"i64";case"f":return"float";case"d":return"double"}a("Unhandled signature IR:",x)},U=g?()=>!0:()=>a("BigInt64Array is not available."),le=function(x){switch(J(x)){case"p":case"P":case"s":{switch(w){case 4:return"getInt32";case 8:return U()&&"getBigInt64"}break}case"i":return"getInt32";case"c":return"getInt8";case"C":return"getUint8";case"j":return U()&&"getBigInt64";case"f":return"getFloat32";case"d":return"getFloat64"}a("Unhandled DataView getter for signature:",x)},m=function(x){switch(J(x)){case"p":case"P":case"s":{switch(w){case 4:return"setInt32";case 8:return U()&&"setBigInt64"}break}case"i":return"setInt32";case"c":return"setInt8";case"C":return"setUint8";case"j":return U()&&"setBigInt64";case"f":return"setFloat32";case"d":return"setFloat64"}a("Unhandled DataView setter for signature:",x)},N=function(x){switch(J(x)){case"i":case"f":case"c":case"C":case"d":return Number;case"j":return U()&&T;case"p":case"P":case"s":switch(w){case 4:return Number;case 8:return U()&&T}break}a("Unhandled DataView set wrapper for signature:",x)},O=(x,P)=>x+"::"+P,z=function(x,P){return()=>a(O(x,P),"is read-only.")},y=new WeakMap,v="(pointer-is-external)",f=function(x,P,W){if(W||(W=y.get(P)),W){if(y.delete(P),Array.isArray(P.ondispose)){let $;for(;$=P.ondispose.shift();)try{$ instanceof Function?$.call(P):$ instanceof se?$.dispose():typeof $=="number"&&k($)}catch(de){console.warn("ondispose() for",x.structName,"@",W,"threw. NOT propagating it.",de)}}else if(P.ondispose instanceof Function)try{P.ondispose()}catch($){console.warn("ondispose() for",x.structName,"@",W,"threw. NOT propagating it.",$)}delete P.ondispose,x.debugFlags.__flags.dealloc&&L("debug.dealloc:",P[v]?"EXTERNAL":"",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+W),P[v]||k(W)}},p=x=>({configurable:!1,writable:!1,iterable:!1,value:x}),_=function(x,P,W){let $=!W;W?Object.defineProperty(P,v,p(W)):(W=b(x.structInfo.sizeof),W||a("Allocation of",x.structName,"structure failed."));try{x.debugFlags.__flags.alloc&&L("debug.alloc:",$?"":"EXTERNAL",x.structName,"instance:",x.structInfo.sizeof,"bytes @"+W),$&&d().fill(0,W,W+x.structInfo.sizeof),y.set(P,W)}catch(de){throw f(x,P,W),de}},F=function(){const x=this.pointer;return x?new Uint8Array(d().slice(x,x+this.structInfo.sizeof)):null},re=p(x=>X+x+ee),ae=function(x,P,W=!0){let $=x.members[P];if(!$&&(X||ee)){for(const de of Object.values(x.members))if(de.key===P){$=de;break}!$&&W&&a(O(x.name,P),"is not a mapped struct member.")}return $},ie=function x(P,W,$=!1){x._||(x._=we=>we.replace(/[^vipPsjrdcC]/g,"").replace(/[pPscC]/g,"i"));const de=ae(P.structInfo,W,!0);return $?x._(de.signature):de.signature},ce={configurable:!1,enumerable:!1,get:function(){return y.get(this)},set:()=>a("Cannot assign the 'pointer' property of a struct.")},ue=p(function(){const x=[];for(const P of Object.keys(this.structInfo.members))x.push(this.memberKey(P));return x}),me=new TextDecoder("utf-8"),ve=new TextEncoder,Qe=typeof SharedArrayBuffer>"u"?function(){}:SharedArrayBuffer,_t=function(x,P,W){return me.decode(x.buffer instanceof Qe?x.slice(P,W):x.subarray(P,W))},C=function(x,P,W=!1){const $=ae(x.structInfo,P,W);return $&&$.signature.length===1&&$.signature[0]==="s"?$:!1},j=function(x){x.signature!=="s"&&a("Invalid member type signature for C-string value:",JSON.stringify(x))},V=function(P,W){const $=ae(P.structInfo,W,!0);j($);const de=P[$.key];if(!de)return null;let we=de;const Se=d();for(;Se[we]!==0;++we);return de===we?"":_t(Se,de,we)},ne=function(x,...P){x.ondispose?Array.isArray(x.ondispose)||(x.ondispose=[x.ondispose]):x.ondispose=[],x.ondispose.push(...P)},Z=function(x){const P=ve.encode(x),W=b(P.length+1);W||a("Allocation error while duplicating string:",x);const $=d();return $.set(P,W),$[W+P.length]=0,W},xe=function(x,P,W){const $=ae(x.structInfo,P,!0);j($);const de=Z(W);return x[$.key]=de,ne(x,de),x},se=function(P,W){arguments[2]!==p&&a("Do not call the StructType constructor","from client-level code."),Object.defineProperties(this,{structName:p(P),structInfo:p(W)})};se.prototype=Object.create(null,{dispose:p(function(){f(this.constructor,this)}),lookupMember:p(function(x,P=!0){return ae(this.structInfo,x,P)}),memberToJsString:p(function(x){return V(this,x)}),memberIsString:p(function(x,P=!0){return C(this,x,P)}),memberKey:re,memberKeys:ue,memberSignature:p(function(x,P=!1){return ie(this,x,P)}),memoryDump:p(F),pointer:ce,setMemberCString:p(function(x,P){return xe(this,x,P)})}),Object.assign(se.prototype,{addOnDispose:function(...x){return ne(this,...x),this}}),Object.defineProperties(se,{allocCString:p(Z),isA:p(x=>x instanceof se),hasExternalPointer:p(x=>x instanceof se&&!!x[v]),memberKey:re});const M=x=>Number.isFinite(x)||x instanceof(T||Number),I=function x(P,W,$){if(!x._){x._={getters:{},setters:{},sw:{}};const xt=["i","c","C","p","P","s","f","d","v()"];oe&&xt.push("j"),xt.forEach(function(sn){x._.getters[sn]=le(sn),x._.setters[sn]=m(sn),x._.sw[sn]=N(sn)});const tf=/^[ipPsjfdcC]$/,nf=/^[vipPsjfdcC]\([ipPsjfdcC]*\)$/;x.sigCheck=function(sn,rf,Ol,Bo){Object.prototype.hasOwnProperty.call(sn,Ol)&&a(sn.structName,"already has a property named",Ol+"."),tf.test(Bo)||nf.test(Bo)||a("Malformed signature for",O(sn.structName,rf)+":",Bo)}}const de=P.memberKey(W);x.sigCheck(P.prototype,W,de,$.signature),$.key=de,$.name=W;const we=J($.signature),Se=O(P.prototype.structName,de),Je=P.prototype.debugFlags.__flags,Vr=Object.create(null);Vr.configurable=!1,Vr.enumerable=!1,Vr.get=function(){Je.getter&&L("debug.getter:",x._.getters[we],"for",H(we),Se,"@",this.pointer,"+",$.offset,"sz",$.sizeof);let xt=new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.getters[we]](0,A);return Je.getter&&L("debug.getter:",Se,"result =",xt),xt},$.readOnly?Vr.set=z(P.prototype.structName,de):Vr.set=function(xt){if(Je.setter&&L("debug.setter:",x._.setters[we],"for",H(we),Se,"@",this.pointer,"+",$.offset,"sz",$.sizeof,xt),this.pointer||a("Cannot set struct property on disposed instance."),xt===null)xt=0;else for(;!M(xt);){if(B($.signature)&&xt instanceof se){xt=xt.pointer||0,Je.setter&&L("debug.setter:",Se,"resolved to",xt);break}a("Invalid value for pointer-type",Se+".")}new DataView(d().buffer,this.pointer+$.offset,$.sizeof)[x._.setters[we]](0,x._.sw[we](xt),A)},Object.defineProperty(P.prototype,de,Vr)},D=function x(P,W){arguments.length===1?(W=P,P=W.name):W.name||(W.name=P),P||a("Struct name is required.");let $=!1;Object.keys(W.members).forEach(Se=>{const Je=W.members[Se];Je.sizeof?Je.sizeof===1?Je.signature==="c"||Je.signature==="C"||a("Unexpected sizeof==1 member",O(W.name,Se),"with signature",Je.signature):(Je.sizeof%4!==0&&(console.warn("Invalid struct member description =",Je,"from",W),a(P,"member",Se,"sizeof is not aligned. sizeof="+Je.sizeof)),Je.offset%4!==0&&(console.warn("Invalid struct member description =",Je,"from",W),a(P,"member",Se,"offset is not aligned. offset="+Je.offset))):a(P,"member",Se,"is missing sizeof."),(!$||$.offset<Je.offset)&&($=Je)}),$?W.sizeof<$.offset+$.sizeof&&a("Invalid struct config:",P,"max member offset ("+$.offset+") ","extends past end of struct (sizeof="+W.sizeof+")."):a("No member property descriptions found.");const de=p(c.__makeDebugFlags(x.debugFlags)),we=function Se(Je){this instanceof Se?arguments.length?((Je!==(Je|0)||Je<=0)&&a("Invalid pointer value for",P,"constructor."),_(Se,this,Je)):_(Se,this):a("The",P,"constructor may only be called via 'new'.")};return Object.defineProperties(we,{debugFlags:de,isA:p(Se=>Se instanceof we),memberKey:re,memberKeys:ue,methodInfoForKey:p(function(Se){}),structInfo:p(W),structName:p(P)}),we.prototype=new se(P,W,p),Object.defineProperties(we.prototype,{debugFlags:de,constructor:p(we)}),Object.keys(W.members).forEach(Se=>I(we,Se,W.members[Se])),we};return D.StructType=se,D.config=l,D.allocCString=Z,D.debugFlags||(D.debugFlags=c.__makeDebugFlags(c.debugFlags)),D},globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...T)=>{throw new Error(T.join(" "))};i.SQLite3Error.toss;const a=i.capi,c=i.wasm,d=i.util;if(globalThis.WhWasmUtilInstaller(c),delete globalThis.WhWasmUtilInstaller,c.bindingSignatures=[["sqlite3_aggregate_context","void*","sqlite3_context*","int"],["sqlite3_bind_double","int","sqlite3_stmt*","int","f64"],["sqlite3_bind_int","int","sqlite3_stmt*","int","int"],["sqlite3_bind_null",void 0,"sqlite3_stmt*","int"],["sqlite3_bind_parameter_count","int","sqlite3_stmt*"],["sqlite3_bind_parameter_index","int","sqlite3_stmt*","string"],["sqlite3_bind_pointer","int","sqlite3_stmt*","int","*","string:static","*"],["sqlite3_busy_handler","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({signature:"i(pi)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_busy_timeout","int","sqlite3*","int"],["sqlite3_changes","int","sqlite3*"],["sqlite3_clear_bindings","int","sqlite3_stmt*"],["sqlite3_collation_needed","int","sqlite3*","*","*"],["sqlite3_column_blob","*","sqlite3_stmt*","int"],["sqlite3_column_bytes","int","sqlite3_stmt*","int"],["sqlite3_column_count","int","sqlite3_stmt*"],["sqlite3_column_double","f64","sqlite3_stmt*","int"],["sqlite3_column_int","int","sqlite3_stmt*","int"],["sqlite3_column_name","string","sqlite3_stmt*","int"],["sqlite3_column_text","string","sqlite3_stmt*","int"],["sqlite3_column_type","int","sqlite3_stmt*","int"],["sqlite3_column_value","sqlite3_value*","sqlite3_stmt*","int"],["sqlite3_commit_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_commit_hook",signature:"i(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_compileoption_get","string","int"],["sqlite3_compileoption_used","int","string"],["sqlite3_complete","int","string:flexible"],["sqlite3_context_db_handle","sqlite3*","sqlite3_context*"],["sqlite3_data_count","int","sqlite3_stmt*"],["sqlite3_db_filename","string","sqlite3*","string"],["sqlite3_db_handle","sqlite3*","sqlite3_stmt*"],["sqlite3_db_name","string","sqlite3*","int"],["sqlite3_db_status","int","sqlite3*","int","*","*","int"],["sqlite3_errcode","int","sqlite3*"],["sqlite3_errmsg","string","sqlite3*"],["sqlite3_error_offset","int","sqlite3*"],["sqlite3_errstr","string","int"],["sqlite3_exec","int",["sqlite3*","string:flexible",new c.xWrap.FuncPtrAdapter({signature:"i(pipp)",bindScope:"transient",callProxy:T=>{let g;return(w,E,A,q)=>{try{const B=c.cArgvToJs(E,A);return g||(g=c.cArgvToJs(E,q)),T(B,g)|0}catch(B){return B.resultCode||a.SQLITE_ERROR}}}}),"*","**"]],["sqlite3_expanded_sql","string","sqlite3_stmt*"],["sqlite3_extended_errcode","int","sqlite3*"],["sqlite3_extended_result_codes","int","sqlite3*","int"],["sqlite3_file_control","int","sqlite3*","string","int","*"],["sqlite3_finalize","int","sqlite3_stmt*"],["sqlite3_free",void 0,"*"],["sqlite3_get_auxdata","*","sqlite3_context*","int"],["sqlite3_initialize",void 0],["sqlite3_keyword_count","int"],["sqlite3_keyword_name","int",["int","**","*"]],["sqlite3_keyword_check","int",["string","int"]],["sqlite3_libversion","string"],["sqlite3_libversion_number","int"],["sqlite3_limit","int",["sqlite3*","int","int"]],["sqlite3_malloc","*","int"],["sqlite3_open","int","string","*"],["sqlite3_open_v2","int","string","*","int","string"],["sqlite3_progress_handler",void 0,["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"xProgressHandler",signature:"i(p)",bindScope:"context",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_realloc","*","*","int"],["sqlite3_reset","int","sqlite3_stmt*"],["sqlite3_result_blob",void 0,"sqlite3_context*","*","int","*"],["sqlite3_result_double",void 0,"sqlite3_context*","f64"],["sqlite3_result_error",void 0,"sqlite3_context*","string","int"],["sqlite3_result_error_code",void 0,"sqlite3_context*","int"],["sqlite3_result_error_nomem",void 0,"sqlite3_context*"],["sqlite3_result_error_toobig",void 0,"sqlite3_context*"],["sqlite3_result_int",void 0,"sqlite3_context*","int"],["sqlite3_result_null",void 0,"sqlite3_context*"],["sqlite3_result_pointer",void 0,"sqlite3_context*","*","string:static","*"],["sqlite3_result_subtype",void 0,"sqlite3_value*","int"],["sqlite3_result_text",void 0,"sqlite3_context*","string","int","*"],["sqlite3_result_zeroblob",void 0,"sqlite3_context*","int"],["sqlite3_rollback_hook","void*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_rollback_hook",signature:"v(p)",contextKey:T=>T[0]}),"*"]],["sqlite3_set_authorizer","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_set_authorizer::xAuth",signature:"i(pissss)",contextKey:(T,g)=>T[0],callProxy:T=>(g,w,E,A,q,B)=>{try{return E=E&&c.cstrToJs(E),A=A&&c.cstrToJs(A),q=q&&c.cstrToJs(q),B=B&&c.cstrToJs(B),T(g,w,E,A,q,B)||0}catch(J){return J.resultCode||a.SQLITE_ERROR}}}),"*"]],["sqlite3_set_auxdata",void 0,["sqlite3_context*","int","*",new c.xWrap.FuncPtrAdapter({name:"xDestroyAuxData",signature:"v(*)",contextKey:(T,g)=>T[0]})]],["sqlite3_shutdown",void 0],["sqlite3_sourceid","string"],["sqlite3_sql","string","sqlite3_stmt*"],["sqlite3_status","int","int","*","*","int"],["sqlite3_step","int","sqlite3_stmt*"],["sqlite3_stmt_isexplain","int",["sqlite3_stmt*"]],["sqlite3_stmt_readonly","int",["sqlite3_stmt*"]],["sqlite3_stmt_status","int","sqlite3_stmt*","int","int"],["sqlite3_strglob","int","string","string"],["sqlite3_stricmp","int","string","string"],["sqlite3_strlike","int","string","string","int"],["sqlite3_strnicmp","int","string","string","int"],["sqlite3_table_column_metadata","int","sqlite3*","string","string","string","**","**","*","*","*"],["sqlite3_total_changes","int","sqlite3*"],["sqlite3_trace_v2","int",["sqlite3*","int",new c.xWrap.FuncPtrAdapter({name:"sqlite3_trace_v2::callback",signature:"i(ippp)",contextKey:(T,g)=>T[0]}),"*"]],["sqlite3_txn_state","int",["sqlite3*","string"]],["sqlite3_uri_boolean","int","sqlite3_filename","string","int"],["sqlite3_uri_key","string","sqlite3_filename","int"],["sqlite3_uri_parameter","string","sqlite3_filename","string"],["sqlite3_user_data","void*","sqlite3_context*"],["sqlite3_value_blob","*","sqlite3_value*"],["sqlite3_value_bytes","int","sqlite3_value*"],["sqlite3_value_double","f64","sqlite3_value*"],["sqlite3_value_dup","sqlite3_value*","sqlite3_value*"],["sqlite3_value_free",void 0,"sqlite3_value*"],["sqlite3_value_frombind","int","sqlite3_value*"],["sqlite3_value_int","int","sqlite3_value*"],["sqlite3_value_nochange","int","sqlite3_value*"],["sqlite3_value_numeric_type","int","sqlite3_value*"],["sqlite3_value_pointer","*","sqlite3_value*","string:static"],["sqlite3_value_subtype","int","sqlite3_value*"],["sqlite3_value_text","string","sqlite3_value*"],["sqlite3_value_type","int","sqlite3_value*"],["sqlite3_vfs_find","*","string"],["sqlite3_vfs_register","int","sqlite3_vfs*","int"],["sqlite3_vfs_unregister","int","sqlite3_vfs*"]],c.exports.sqlite3_activate_see instanceof Function&&c.bindingSignatures.push(["sqlite3_key","int","sqlite3*","string","int"],["sqlite3_key_v2","int","sqlite3*","string","*","int"],["sqlite3_rekey","int","sqlite3*","string","int"],["sqlite3_rekey_v2","int","sqlite3*","string","*","int"],["sqlite3_activate_see",void 0,"string"]),c.bindingSignatures.int64=[["sqlite3_bind_int64","int",["sqlite3_stmt*","int","i64"]],["sqlite3_changes64","i64",["sqlite3*"]],["sqlite3_column_int64","i64",["sqlite3_stmt*","int"]],["sqlite3_create_module","int",["sqlite3*","string","sqlite3_module*","*"]],["sqlite3_create_module_v2","int",["sqlite3*","string","sqlite3_module*","*","*"]],["sqlite3_declare_vtab","int",["sqlite3*","string:flexible"]],["sqlite3_deserialize","int","sqlite3*","string","*","i64","i64","int"],["sqlite3_drop_modules","int",["sqlite3*","**"]],["sqlite3_last_insert_rowid","i64",["sqlite3*"]],["sqlite3_malloc64","*","i64"],["sqlite3_msize","i64","*"],["sqlite3_overload_function","int",["sqlite3*","string","int"]],["sqlite3_preupdate_blobwrite","int","sqlite3*"],["sqlite3_preupdate_count","int","sqlite3*"],["sqlite3_preupdate_depth","int","sqlite3*"],["sqlite3_preupdate_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_preupdate_hook",signature:"v(ppippjj)",contextKey:T=>T[0],callProxy:T=>(g,w,E,A,q,B,J)=>{T(g,w,E,c.cstrToJs(A),c.cstrToJs(q),B,J)}}),"*"]],["sqlite3_preupdate_new","int",["sqlite3*","int","**"]],["sqlite3_preupdate_old","int",["sqlite3*","int","**"]],["sqlite3_realloc64","*","*","i64"],["sqlite3_result_int64",void 0,"*","i64"],["sqlite3_result_zeroblob64","int","*","i64"],["sqlite3_serialize","*","sqlite3*","string","*","int"],["sqlite3_set_last_insert_rowid",void 0,["sqlite3*","i64"]],["sqlite3_status64","int","int","*","*","int"],["sqlite3_total_changes64","i64",["sqlite3*"]],["sqlite3_update_hook","*",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"sqlite3_update_hook",signature:"v(iippj)",contextKey:T=>T[0],callProxy:T=>(g,w,E,A,q)=>{T(g,w,c.cstrToJs(E),c.cstrToJs(A),q)}}),"*"]],["sqlite3_uri_int64","i64",["sqlite3_filename","string","i64"]],["sqlite3_value_int64","i64","sqlite3_value*"],["sqlite3_vtab_collation","string","sqlite3_index_info*","int"],["sqlite3_vtab_distinct","int","sqlite3_index_info*"],["sqlite3_vtab_in","int","sqlite3_index_info*","int","int"],["sqlite3_vtab_in_first","int","sqlite3_value*","**"],["sqlite3_vtab_in_next","int","sqlite3_value*","**"],["sqlite3_vtab_nochange","int","sqlite3_context*"],["sqlite3_vtab_on_conflict","int","sqlite3*"],["sqlite3_vtab_rhs_value","int","sqlite3_index_info*","int","**"]],c.bigIntEnabled&&c.exports.sqlite3changegroup_add){const T={signature:"i(ps)",callProxy:g=>(w,E)=>{try{return g(w,c.cstrToJs(E))|0}catch(A){return A.resultCode||a.SQLITE_ERROR}}};c.bindingSignatures.int64.push(["sqlite3changegroup_add","int",["sqlite3_changegroup*","int","void*"]],["sqlite3changegroup_add_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changegroup_delete",void 0,["sqlite3_changegroup*"]],["sqlite3changegroup_new","int",["**"]],["sqlite3changegroup_output","int",["sqlite3_changegroup*","int*","**"]],["sqlite3changegroup_output_strm","int",["sqlite3_changegroup*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*"]],["sqlite3changeset_apply_v2","int",["sqlite3*","int","void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_apply_v2_strm","int",["sqlite3*",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xFilter",bindScope:"transient",...T}),new c.xWrap.FuncPtrAdapter({name:"xConflict",signature:"i(pip)",bindScope:"transient"}),"void*","**","int*","int"]],["sqlite3changeset_concat","int",["int","void*","int","void*","int*","**"]],["sqlite3changeset_concat_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInputA",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xInputB",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_conflict","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_finalize","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_fk_conflicts","int",["sqlite3_changeset_iter*","int*"]],["sqlite3changeset_invert","int",["int","void*","int*","**"]],["sqlite3changeset_invert_strm","int",[new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppi)",bindScope:"transient"}),"void*"]],["sqlite3changeset_new","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_next","int",["sqlite3_changeset_iter*"]],["sqlite3changeset_old","int",["sqlite3_changeset_iter*","int","**"]],["sqlite3changeset_op","int",["sqlite3_changeset_iter*","**","int*","int*","int*"]],["sqlite3changeset_pk","int",["sqlite3_changeset_iter*","**","int*"]],["sqlite3changeset_start","int",["**","int","*"]],["sqlite3changeset_start_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3changeset_start_v2","int",["**","int","*","int"]],["sqlite3changeset_start_v2_strm","int",["**",new c.xWrap.FuncPtrAdapter({name:"xInput",signature:"i(ppp)",bindScope:"transient"}),"void*","int"]],["sqlite3session_attach","int",["sqlite3_session*","string"]],["sqlite3session_changeset","int",["sqlite3_session*","int*","**"]],["sqlite3session_changeset_size","i64",["sqlite3_session*"]],["sqlite3session_changeset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_config","int",["int","void*"]],["sqlite3session_create","int",["sqlite3*","string","**"]],["sqlite3session_diff","int",["sqlite3_session*","string","string","**"]],["sqlite3session_enable","int",["sqlite3_session*","int"]],["sqlite3session_indirect","int",["sqlite3_session*","int"]],["sqlite3session_isempty","int",["sqlite3_session*"]],["sqlite3session_memory_used","i64",["sqlite3_session*"]],["sqlite3session_object_config","int",["sqlite3_session*","int","void*"]],["sqlite3session_patchset","int",["sqlite3_session*","*","**"]],["sqlite3session_patchset_strm","int",["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xOutput",signature:"i(ppp)",bindScope:"transient"}),"void*"]],["sqlite3session_table_filter",void 0,["sqlite3_session*",new c.xWrap.FuncPtrAdapter({name:"xFilter",...T,contextKey:(g,w)=>g[0]}),"*"]])}c.bindingSignatures.wasm=[["sqlite3_wasm_db_reset","int","sqlite3*"],["sqlite3_wasm_db_vfs","sqlite3_vfs*","sqlite3*","string"],["sqlite3_wasm_vfs_create_file","int","sqlite3_vfs*","string","*","int"],["sqlite3_wasm_posix_create_file","int","string","*","int"],["sqlite3_wasm_vfs_unlink","int","sqlite3_vfs*","string"]],i.StructBinder=globalThis.Jaccwabyt({heap:c.heap8u,alloc:c.alloc,dealloc:c.dealloc,bigIntEnabled:c.bigIntEnabled,memberPrefix:"$"}),delete globalThis.Jaccwabyt;{const T=c.xWrap.argAdapter("string");c.xWrap.argAdapter("string:flexible",q=>T(d.flexibleString(q))),c.xWrap.argAdapter("string:static",(function(q){return c.isPtr(q)?q:(q=""+q,this[q]||(this[q]=c.allocCString(q)))}).bind(Object.create(null)));const g=c.xWrap.argAdapter("*"),w=function(){};c.xWrap.argAdapter("sqlite3_filename",g)("sqlite3_context*",g)("sqlite3_value*",g)("void*",g)("sqlite3_changegroup*",g)("sqlite3_changeset_iter*",g)("sqlite3_session*",g)("sqlite3_stmt*",q=>{var B;return g(q instanceof(((B=i==null?void 0:i.oo1)==null?void 0:B.Stmt)||w)?q.pointer:q)})("sqlite3*",q=>{var B;return g(q instanceof(((B=i==null?void 0:i.oo1)==null?void 0:B.DB)||w)?q.pointer:q)})("sqlite3_index_info*",q=>g(q instanceof(a.sqlite3_index_info||w)?q.pointer:q))("sqlite3_module*",q=>g(q instanceof(a.sqlite3_module||w)?q.pointer:q))("sqlite3_vfs*",q=>typeof q=="string"?a.sqlite3_vfs_find(q)||i.SQLite3Error.toss(a.SQLITE_NOTFOUND,"Unknown sqlite3_vfs name:",q):g(q instanceof(a.sqlite3_vfs||w)?q.pointer:q));const E=c.xWrap.resultAdapter("*");c.xWrap.resultAdapter("sqlite3*",E)("sqlite3_context*",E)("sqlite3_stmt*",E)("sqlite3_value*",E)("sqlite3_vfs*",E)("void*",E),c.exports.sqlite3_step.length===0&&(c.xWrap.doArgcCheck=!1,i.config.warn("Disabling sqlite3.wasm.xWrap.doArgcCheck due to environmental quirks."));for(const q of c.bindingSignatures)a[q[0]]=c.xWrap.apply(null,q);for(const q of c.bindingSignatures.wasm)c[q[0]]=c.xWrap.apply(null,q);const A=function(q){return()=>l(q+"() is unavailable due to lack","of BigInt support in this build.")};for(const q of c.bindingSignatures.int64)a[q[0]]=c.bigIntEnabled?c.xWrap.apply(null,q):A(q[0]);if(delete c.bindingSignatures,c.exports.sqlite3_wasm_db_error){const q=c.xWrap("sqlite3_wasm_db_error","int","sqlite3*","int","string");d.sqlite3_wasm_db_error=function(B,J,H){return J instanceof i.WasmAllocError?(J=a.SQLITE_NOMEM,H=0):J instanceof Error&&(H=H||""+J,J=J.resultCode||a.SQLITE_ERROR),B?q(B,J,H):J}}else d.sqlite3_wasm_db_error=function(q,B,J){return console.warn("sqlite3_wasm_db_error() is not exported.",arguments),B}}{const T=c.xCall("sqlite3_wasm_enum_json");T||l("Maintenance required: increase sqlite3_wasm_enum_json()'s","static buffer size!"),c.ctype=JSON.parse(c.cstrToJs(T));const g=["access","authorizer","blobFinalizers","changeset","config","dataTypes","dbConfig","dbStatus","encodings","fcntl","flock","ioCap","limits","openFlags","prepareFlags","resultCodes","sqlite3Status","stmtStatus","syncFlags","trace","txnState","udfFlags","version"];c.bigIntEnabled&&g.push("serialize","session","vtab");for(const A of g)for(const q of Object.entries(c.ctype[A]))a[q[0]]=q[1];c.functionEntry(a.SQLITE_WASM_DEALLOC)||l("Internal error: cannot resolve exported function","entry SQLITE_WASM_DEALLOC (=="+a.SQLITE_WASM_DEALLOC+").");const w=Object.create(null);for(const A of["resultCodes"])for(const q of Object.entries(c.ctype[A]))w[q[1]]=q[0];a.sqlite3_js_rc_str=A=>w[A];const E=Object.assign(Object.create(null),{WasmTestStruct:!0,sqlite3_kvvfs_methods:!d.isUIThread(),sqlite3_index_info:!c.bigIntEnabled,sqlite3_index_constraint:!c.bigIntEnabled,sqlite3_index_orderby:!c.bigIntEnabled,sqlite3_index_constraint_usage:!c.bigIntEnabled});for(const A of c.ctype.structs)E[A.name]||(a[A.name]=i.StructBinder(A));if(a.sqlite3_index_info){for(const A of["sqlite3_index_constraint","sqlite3_index_orderby","sqlite3_index_constraint_usage"])a.sqlite3_index_info[A]=a[A],delete a[A];a.sqlite3_vtab_config=c.xWrap("sqlite3_wasm_vtab_config","int",["sqlite3*","int","int"])}}const b=(T,g,w)=>d.sqlite3_wasm_db_error(T,a.SQLITE_MISUSE,g+"() requires "+w+" argument"+(w===1?"":"s")+"."),k=T=>d.sqlite3_wasm_db_error(T,a.SQLITE_FORMAT,"SQLITE_UTF8 is the only supported encoding."),L=T=>c.xWrap.argAdapter("sqlite3*")(T),X=T=>c.isPtr(T)?c.cstrToJs(T):T,ee=(function(T,g){T=L(T);let w=this.dbMap.get(T);if(g)!w&&g>0&&this.dbMap.set(T,w=Object.create(null));else return this.dbMap.delete(T),w;return w}).bind(Object.assign(Object.create(null),{dbMap:new Map}));ee.addCollation=function(T,g){const w=ee(T,1);w.collation||(w.collation=new Set),w.collation.add(X(g).toLowerCase())},ee._addUDF=function(T,g,w,E){g=X(g).toLowerCase();let A=E.get(g);A||E.set(g,A=new Set),A.add(w<0?-1:w)},ee.addFunction=function(T,g,w){const E=ee(T,1);E.udf||(E.udf=new Map),this._addUDF(T,g,w,E.udf)},ee.addWindowFunc=function(T,g,w){const E=ee(T,1);E.wudf||(E.wudf=new Map),this._addUDF(T,g,w,E.wudf)},ee.cleanup=function(T){T=L(T);const g=[T];for(const A of["sqlite3_busy_handler","sqlite3_commit_hook","sqlite3_preupdate_hook","sqlite3_progress_handler","sqlite3_rollback_hook","sqlite3_set_authorizer","sqlite3_trace_v2","sqlite3_update_hook"]){const q=c.exports[A];g.length=q.length;try{a[A](...g)}catch(B){console.warn("close-time call of",A+"(",g,") threw:",B)}}const w=ee(T,0);if(!w)return;if(w.collation){for(const A of w.collation)try{a.sqlite3_create_collation_v2(T,A,a.SQLITE_UTF8,0,0,0)}catch{}delete w.collation}let E;for(E=0;E<2;++E){const A=E?w.wudf:w.udf;if(!A)continue;const q=E?a.sqlite3_create_window_function:a.sqlite3_create_function_v2;for(const B of A){const J=B[0],H=B[1],U=[T,J,0,a.SQLITE_UTF8,0,0,0,0,0];E&&U.push(0);for(const le of H)try{U[2]=le,q.apply(null,U)}catch{}H.clear()}A.clear()}delete w.udf,delete w.wudf};{const T=c.xWrap("sqlite3_close_v2","int","sqlite3*");a.sqlite3_close_v2=function(g){if(arguments.length!==1)return b(g,"sqlite3_close_v2",1);if(g)try{ee.cleanup(g)}catch{}return T(g)}}if(a.sqlite3session_table_filter){const T=c.xWrap("sqlite3session_delete",void 0,["sqlite3_session*"]);a.sqlite3session_delete=function(g){if(arguments.length!==1)return b(pDb,"sqlite3session_delete",1);g&&a.sqlite3session_table_filter(g,0,0),T(g)}}{const T=(w,E)=>"argv["+E+"]:"+w[0]+":"+c.cstrToJs(w[1]).toLowerCase(),g=c.xWrap("sqlite3_create_collation_v2","int",["sqlite3*","string","int","*",new c.xWrap.FuncPtrAdapter({name:"xCompare",signature:"i(pipip)",contextKey:T}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",signature:"v(p)",contextKey:T})]);a.sqlite3_create_collation_v2=function(w,E,A,q,B,J){if(arguments.length!==6)return b(w,"sqlite3_create_collation_v2",6);if(!(A&15))A|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(A&15))return k(w);try{const H=g(w,E,A,q,B,J);return H===0&&B instanceof Function&&ee.addCollation(w,E),H}catch(H){return d.sqlite3_wasm_db_error(w,H)}},a.sqlite3_create_collation=(w,E,A,q,B)=>arguments.length===5?a.sqlite3_create_collation_v2(w,E,A,q,B,0):b(w,"sqlite3_create_collation",5)}{const T=function(A,q){return A[0]+":"+(A[2]<0?-1:A[2])+":"+q+":"+c.cstrToJs(A[1]).toLowerCase()},g=Object.assign(Object.create(null),{xInverseAndStep:{signature:"v(pip)",contextKey:T,callProxy:A=>(q,B,J)=>{try{A(q,...a.sqlite3_values_to_js(B,J))}catch(H){a.sqlite3_result_error_js(q,H)}}},xFinalAndValue:{signature:"v(p)",contextKey:T,callProxy:A=>q=>{try{a.sqlite3_result_js(q,A(q))}catch(B){a.sqlite3_result_error_js(q,B)}}},xFunc:{signature:"v(pip)",contextKey:T,callProxy:A=>(q,B,J)=>{try{a.sqlite3_result_js(q,A(q,...a.sqlite3_values_to_js(B,J)))}catch(H){a.sqlite3_result_error_js(q,H)}}},xDestroy:{signature:"v(p)",contextKey:T,callProxy:A=>q=>{try{A(q)}catch(B){console.error("UDF xDestroy method threw:",B)}}}}),w=c.xWrap("sqlite3_create_function_v2","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xFunc",...g.xFunc}),new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]),E=c.xWrap("sqlite3_create_window_function","int",["sqlite3*","string","int","int","*",new c.xWrap.FuncPtrAdapter({name:"xStep",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xFinal",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xValue",...g.xFinalAndValue}),new c.xWrap.FuncPtrAdapter({name:"xInverse",...g.xInverseAndStep}),new c.xWrap.FuncPtrAdapter({name:"xDestroy",...g.xDestroy})]);a.sqlite3_create_function_v2=function A(q,B,J,H,U,le,m,N,O){if(A.length!==arguments.length)return b(q,"sqlite3_create_function_v2",A.length);if(!(H&15))H|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(H&15))return k(q);try{const z=w(q,B,J,H,U,le,m,N,O);return z===0&&(le instanceof Function||m instanceof Function||N instanceof Function||O instanceof Function)&&ee.addFunction(q,B,J),z}catch(z){return console.error("sqlite3_create_function_v2() setup threw:",z),d.sqlite3_wasm_db_error(q,z,"Creation of UDF threw: "+z)}},a.sqlite3_create_function=function A(q,B,J,H,U,le,m,N){return A.length===arguments.length?a.sqlite3_create_function_v2(q,B,J,H,U,le,m,N,0):b(q,"sqlite3_create_function",A.length)},a.sqlite3_create_window_function=function A(q,B,J,H,U,le,m,N,O,z){if(A.length!==arguments.length)return b(q,"sqlite3_create_window_function",A.length);if(!(H&15))H|=a.SQLITE_UTF8;else if(a.SQLITE_UTF8!==(H&15))return k(q);try{const y=E(q,B,J,H,U,le,m,N,O,z);return y===0&&(le instanceof Function||m instanceof Function||N instanceof Function||O instanceof Function||z instanceof Function)&&ee.addWindowFunc(q,B,J),y}catch(y){return console.error("sqlite3_create_window_function() setup threw:",y),d.sqlite3_wasm_db_error(q,y,"Creation of UDF threw: "+y)}},a.sqlite3_create_function_v2.udfSetResult=a.sqlite3_create_function.udfSetResult=a.sqlite3_create_window_function.udfSetResult=a.sqlite3_result_js,a.sqlite3_create_function_v2.udfConvertArgs=a.sqlite3_create_function.udfConvertArgs=a.sqlite3_create_window_function.udfConvertArgs=a.sqlite3_values_to_js,a.sqlite3_create_function_v2.udfSetError=a.sqlite3_create_function.udfSetError=a.sqlite3_create_window_function.udfSetError=a.sqlite3_result_error_js}{const T=(w,E)=>(typeof w=="string"?E=-1:d.isSQLableTypedArray(w)?(E=w.byteLength,w=d.typedArrayToString(w instanceof ArrayBuffer?new Uint8Array(w):w)):Array.isArray(w)&&(w=w.join(""),E=-1),[w,E]),g={basic:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","string","int","int","**","**"]),full:c.xWrap("sqlite3_prepare_v3","int",["sqlite3*","*","int","int","**","**"])};a.sqlite3_prepare_v3=function w(E,A,q,B,J,H){if(w.length!==arguments.length)return b(E,"sqlite3_prepare_v3",w.length);const[U,le]=T(A,q);switch(typeof U){case"string":return g.basic(E,U,le,B,J,null);case"number":return g.full(E,U,le,B,J,H);default:return d.sqlite3_wasm_db_error(E,a.SQLITE_MISUSE,"Invalid SQL argument type for sqlite3_prepare_v2/v3().")}},a.sqlite3_prepare_v2=function w(E,A,q,B,J){return w.length===arguments.length?a.sqlite3_prepare_v3(E,A,q,0,B,J):b(E,"sqlite3_prepare_v2",w.length)}}{const T=c.xWrap("sqlite3_bind_text","int",["sqlite3_stmt*","int","string","int","*"]),g=c.xWrap("sqlite3_bind_blob","int",["sqlite3_stmt*","int","*","int","*"]);a.sqlite3_bind_text=function w(E,A,q,B,J){if(w.length!==arguments.length)return b(a.sqlite3_db_handle(E),"sqlite3_bind_text",w.length);if(c.isPtr(q)||q===null)return T(E,A,q,B,J);q instanceof ArrayBuffer?q=new Uint8Array(q):Array.isArray(pMem)&&(q=pMem.join(""));let H,U;try{if(d.isSQLableTypedArray(q))H=c.allocFromTypedArray(q),U=q.byteLength;else if(typeof q=="string")[H,U]=c.allocCString(q);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_text().");return T(E,A,H,U,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(H),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),le)}},a.sqlite3_bind_blob=function w(E,A,q,B,J){if(w.length!==arguments.length)return b(a.sqlite3_db_handle(E),"sqlite3_bind_blob",w.length);if(c.isPtr(q)||q===null)return g(E,A,q,B,J);q instanceof ArrayBuffer?q=new Uint8Array(q):Array.isArray(q)&&(q=q.join(""));let H,U;try{if(d.isBindableTypedArray(q))H=c.allocFromTypedArray(q),U=B>=0?B:q.byteLength;else if(typeof q=="string")[H,U]=c.allocCString(q);else return d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),a.SQLITE_MISUSE,"Invalid 3rd argument type for sqlite3_bind_blob().");return g(E,A,H,U,a.SQLITE_WASM_DEALLOC)}catch(le){return c.dealloc(H),d.sqlite3_wasm_db_error(a.sqlite3_db_handle(E),le)}}}a.sqlite3_config=function(T,...g){if(arguments.length<2)return a.SQLITE_MISUSE;switch(T){case a.SQLITE_CONFIG_COVERING_INDEX_SCAN:case a.SQLITE_CONFIG_MEMSTATUS:case a.SQLITE_CONFIG_SMALL_MALLOC:case a.SQLITE_CONFIG_SORTERREF_SIZE:case a.SQLITE_CONFIG_STMTJRNL_SPILL:case a.SQLITE_CONFIG_URI:return c.exports.sqlite3_wasm_config_i(T,g[0]);case a.SQLITE_CONFIG_LOOKASIDE:return c.exports.sqlite3_wasm_config_ii(T,g[0],g[1]);case a.SQLITE_CONFIG_MEMDB_MAXSIZE:return c.exports.sqlite3_wasm_config_j(T,g[0]);case a.SQLITE_CONFIG_GETMALLOC:case a.SQLITE_CONFIG_GETMUTEX:case a.SQLITE_CONFIG_GETPCACHE2:case a.SQLITE_CONFIG_GETPCACHE:case a.SQLITE_CONFIG_HEAP:case a.SQLITE_CONFIG_LOG:case a.SQLITE_CONFIG_MALLOC:case a.SQLITE_CONFIG_MMAP_SIZE:case a.SQLITE_CONFIG_MULTITHREAD:case a.SQLITE_CONFIG_MUTEX:case a.SQLITE_CONFIG_PAGECACHE:case a.SQLITE_CONFIG_PCACHE2:case a.SQLITE_CONFIG_PCACHE:case a.SQLITE_CONFIG_PCACHE_HDRSZ:case a.SQLITE_CONFIG_PMASZ:case a.SQLITE_CONFIG_SERIALIZED:case a.SQLITE_CONFIG_SINGLETHREAD:case a.SQLITE_CONFIG_SQLLOG:case a.SQLITE_CONFIG_WIN32_HEAPSIZE:default:return a.SQLITE_NOTFOUND}};{const T=new Set;a.sqlite3_auto_extension=function(g){if(g instanceof Function)g=c.installFunction("i(ppp)",g);else if(arguments.length!==1||!c.isPtr(g))return a.SQLITE_MISUSE;const w=c.exports.sqlite3_auto_extension(g);return g!==arguments[0]&&(w===0?T.add(g):c.uninstallFunction(g)),w},a.sqlite3_cancel_auto_extension=function(g){return!g||arguments.length!==1||!c.isPtr(g)?0:c.exports.sqlite3_cancel_auto_extension(g)},a.sqlite3_reset_auto_extension=function(){c.exports.sqlite3_reset_auto_extension();for(const g of T)c.uninstallFunction(g);T.clear()}}const oe=a.sqlite3_vfs_find("kvvfs");if(oe)if(d.isUIThread()){const T=new a.sqlite3_kvvfs_methods(c.exports.sqlite3_wasm_kvvfs_methods());delete a.sqlite3_kvvfs_methods;const g=c.exports.sqlite3_wasm_kvvfsMakeKeyOnPstack,w=c.pstack,E=q=>c.peek(q)===115?sessionStorage:localStorage,A={xRead:(q,B,J,H)=>{const U=w.pointer,le=c.scopedAllocPush();try{const m=g(q,B);if(!m)return-3;const N=c.cstrToJs(m),O=E(q).getItem(N);if(!O)return-1;const z=O.length;if(H<=0)return z;if(H===1)return c.poke(J,0),z;const y=c.scopedAllocCString(O);return H>z+1&&(H=z+1),c.heap8u().copyWithin(J,y,y+H-1),c.poke(J+H-1,0),H-1}catch(m){return console.error("kvstorageRead()",m),-2}finally{w.restore(U),c.scopedAllocPop(le)}},xWrite:(q,B,J)=>{const H=w.pointer;try{const U=g(q,B);if(!U)return 1;const le=c.cstrToJs(U);return E(q).setItem(le,c.cstrToJs(J)),0}catch(U){return console.error("kvstorageWrite()",U),a.SQLITE_IOERR}finally{w.restore(H)}},xDelete:(q,B)=>{const J=w.pointer;try{const H=g(q,B);return H?(E(q).removeItem(c.cstrToJs(H)),0):1}catch(H){return console.error("kvstorageDelete()",H),a.SQLITE_IOERR}finally{w.restore(J)}}};for(const q of Object.keys(A))T[T.memberKey(q)]=c.installFunction(T.memberSignature(q),A[q])}else a.sqlite3_vfs_unregister(oe);c.xWrap.FuncPtrAdapter.warnOnUse=!0}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.version={libVersion:"3.43.2",libVersionNumber:3043002,sourceId:"2023-10-10 12:14:04 4310099cce5a487035fa535dd3002c59ac7f1d1bec68d7cf317fd3e769484790",downloadVersion:3430200}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=(...y)=>{throw new i.SQLite3Error(...y)},a=i.capi,c=i.wasm,d=i.util,b=new WeakMap,k=new WeakMap,L=(y,v,f)=>{const p=Object.getOwnPropertyDescriptor(y,v);return p?p.value:f},X=function(y,v){return v&&(y instanceof g&&(y=y.pointer),l(v,"sqlite3 result code",v+":",y?a.sqlite3_errmsg(y):a.sqlite3_errstr(v))),arguments[0]},ee=c.installFunction("i(ippp)",(function(y,v,f,p){a.SQLITE_TRACE_STMT===y&&console.log("SQL TRACE #"+ ++this.counter+" via sqlite3@"+v+":",c.cstrToJs(p))}).bind({counter:0})),oe=Object.create(null),T=function y(...v){if(!y._name2vfs){y._name2vfs=Object.create(null);const ue=typeof importScripts=="function"?me=>l("The VFS for",me,"is only available in the main window thread."):!1;y._name2vfs[":localStorage:"]={vfs:"kvvfs",filename:ue||(()=>"local")},y._name2vfs[":sessionStorage:"]={vfs:"kvvfs",filename:ue||(()=>"session")}}const f=y.normalizeArgs(...v);let p=f.filename,_=f.vfs,F=f.flags;(typeof p!="string"&&typeof p!="number"||typeof F!="string"||_&&typeof _!="string"&&typeof _!="number")&&(i.config.error("Invalid DB ctor args",f,arguments),l("Invalid arguments for DB constructor."));let G=typeof p=="number"?c.cstrToJs(p):p;const re=y._name2vfs[G];re&&(_=re.vfs,p=G=re.filename(G));let ae,ie=0;F.indexOf("c")>=0&&(ie|=a.SQLITE_OPEN_CREATE|a.SQLITE_OPEN_READWRITE),F.indexOf("w")>=0&&(ie|=a.SQLITE_OPEN_READWRITE),ie===0&&(ie|=a.SQLITE_OPEN_READONLY),ie|=a.SQLITE_OPEN_EXRESCODE;const ce=c.pstack.pointer;try{const ue=c.pstack.allocPtr();let me=a.sqlite3_open_v2(p,ue,ie,_||0);ae=c.peekPtr(ue),X(ae,me),a.sqlite3_extended_result_codes(ae,1),F.indexOf("t")>=0&&a.sqlite3_trace_v2(ae,a.SQLITE_TRACE_STMT,ee,ae)}catch(ue){throw ae&&a.sqlite3_close_v2(ae),ue}finally{c.pstack.restore(ce)}this.filename=G,b.set(this,ae),k.set(this,Object.create(null));try{const ue=a.sqlite3_js_db_vfs(ae);ue||l("Internal error: cannot get VFS for new db handle.");const me=oe[ue];me instanceof Function?me(this,i):me&&X(ae,a.sqlite3_exec(ae,me,0,0,0))}catch(ue){throw this.close(),ue}};T.setVfsPostOpenSql=function(y,v){oe[y]=v},T.normalizeArgs=function(y=":memory:",v="c",f=null){const p={};return arguments.length===1&&arguments[0]&&typeof arguments[0]=="object"?(Object.assign(p,arguments[0]),p.flags===void 0&&(p.flags="c"),p.vfs===void 0&&(p.vfs=null),p.filename===void 0&&(p.filename=":memory:")):(p.filename=y,p.flags=v,p.vfs=f),p};const g=function(...y){T.apply(this,y)};g.dbCtorHelper=T;const w={null:1,number:2,string:3,boolean:4,blob:5};w.undefined==w.null,c.bigIntEnabled&&(w.bigint=w.number);const E=function(){w!==arguments[2]&&l(a.SQLITE_MISUSE,"Do not call the Stmt constructor directly. Use DB.prepare()."),this.db=arguments[0],b.set(this,arguments[1]),this.parameterCount=a.sqlite3_bind_parameter_count(this.pointer)},A=function(y){return y.pointer||l("DB has been closed."),y},q=function(y,v){return(v!==(v|0)||v<0||v>=y.columnCount)&&l("Column index",v,"is out of range."),y},B=function(y,v){const f=Object.create(null);switch(f.opt=Object.create(null),v.length){case 1:typeof v[0]=="string"||d.isSQLableTypedArray(v[0])||Array.isArray(v[0])?f.sql=v[0]:v[0]&&typeof v[0]=="object"&&(f.opt=v[0],f.sql=f.opt.sql);break;case 2:f.sql=v[0],f.opt=v[1];break;default:l("Invalid argument count for exec().")}f.sql=d.flexibleString(f.sql),typeof f.sql!="string"&&l("Missing SQL argument or unsupported SQL value type.");const p=f.opt;switch(p.returnValue){case"resultRows":p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows;break;case"saveSql":p.saveSql||(p.saveSql=[]),f.returnVal=()=>p.saveSql;break;case void 0:case"this":f.returnVal=()=>y;break;default:l("Invalid returnValue value:",p.returnValue)}if(!p.callback&&!p.returnValue&&p.rowMode!==void 0&&(p.resultRows||(p.resultRows=[]),f.returnVal=()=>p.resultRows),p.callback||p.resultRows)switch(p.rowMode===void 0?"array":p.rowMode){case"object":f.cbArg=_=>_.get(Object.create(null));break;case"array":f.cbArg=_=>_.get([]);break;case"stmt":Array.isArray(p.resultRows)&&l("exec(): invalid rowMode for a resultRows array: must","be one of 'array', 'object',","a result column number, or column name reference."),f.cbArg=_=>_;break;default:if(d.isInt32(p.rowMode)){f.cbArg=_=>_.get(p.rowMode);break}else if(typeof p.rowMode=="string"&&p.rowMode.length>1&&p.rowMode[0]==="$"){const _=p.rowMode.substr(1);f.cbArg=F=>{const G=F.get(Object.create(null))[_];return G===void 0?l(a.SQLITE_NOTFOUND,"exec(): unknown result column:",_):G};break}l("Invalid rowMode:",p.rowMode)}return f},J=(y,v,f,...p)=>{const _=y.prepare(v);try{const F=_.bind(f).step()?_.get(...p):void 0;return _.reset(),F}finally{_.finalize()}},H=(y,v,f,p)=>y.exec({sql:v,bind:f,rowMode:p,returnValue:"resultRows"});g.checkRc=(y,v)=>X(y,v),g.prototype={isOpen:function(){return!!this.pointer},affirmOpen:function(){return A(this)},close:function(){if(this.pointer){if(this.onclose&&this.onclose.before instanceof Function)try{this.onclose.before(this)}catch{}const y=this.pointer;if(Object.keys(k.get(this)).forEach((v,f)=>{if(f&&f.pointer)try{f.finalize()}catch{}}),b.delete(this),k.delete(this),a.sqlite3_close_v2(y),this.onclose&&this.onclose.after instanceof Function)try{this.onclose.after(this)}catch{}delete this.filename}},changes:function(y=!1,v=!1){const f=A(this).pointer;return y?v?a.sqlite3_total_changes64(f):a.sqlite3_total_changes(f):v?a.sqlite3_changes64(f):a.sqlite3_changes(f)},dbFilename:function(y="main"){return a.sqlite3_db_filename(A(this).pointer,y)},dbName:function(y=0){return a.sqlite3_db_name(A(this).pointer,y)},dbVfsName:function(y=0){let v;const f=a.sqlite3_js_db_vfs(A(this).pointer,y);if(f){const p=new a.sqlite3_vfs(f);try{v=c.cstrToJs(p.$zName)}finally{p.dispose()}}return v},prepare:function(y){A(this);const v=c.pstack.pointer;let f,p;try{f=c.pstack.alloc(8),g.checkRc(this,a.sqlite3_prepare_v2(this.pointer,y,-1,f,null)),p=c.peekPtr(f)}finally{c.pstack.restore(v)}p||l("Cannot prepare empty SQL.");const _=new E(this,p,w);return k.get(this)[p]=_,_},exec:function(){A(this);const y=B(this,arguments);if(!y.sql)return l("exec() requires an SQL string.");const v=y.opt,f=v.callback,p=Array.isArray(v.resultRows)?v.resultRows:void 0;let _,F=v.bind,G=!!(y.cbArg||v.columnNames||p);const re=c.scopedAllocPush(),ae=Array.isArray(v.saveSql)?v.saveSql:void 0;try{const ie=d.isSQLableTypedArray(y.sql);let ce=ie?y.sql.byteLength:c.jstrlen(y.sql);const ue=c.scopedAlloc(2*c.ptrSizeof+(ce+1)),me=ue+c.ptrSizeof;let ve=me+c.ptrSizeof;const Qe=ve+ce;for(ie?c.heap8().set(y.sql,ve):c.jstrcpy(y.sql,c.heap8(),ve,ce,!1),c.poke(ve+ce,0);ve&&c.peek(ve,"i8");){c.pokePtr([ue,me],0),g.checkRc(this,a.sqlite3_prepare_v3(this.pointer,ve,ce,0,ue,me));const _t=c.peekPtr(ue);if(ve=c.peekPtr(me),ce=Qe-ve,!!_t){if(ae&&ae.push(a.sqlite3_sql(_t).trim()),_=new E(this,_t,w),F&&_.parameterCount&&(_.bind(F),F=null),G&&_.columnCount){let C=Array.isArray(v.columnNames)?0:1;if(G=!1,y.cbArg||p){for(;_.step();_._lockedByExec=!1){C++===0&&_.getColumnNames(v.columnNames),_._lockedByExec=!0;const j=y.cbArg(_);if(p&&p.push(j),f&&f.call(v,j,_)===!1)break}_._lockedByExec=!1}C===0&&_.getColumnNames(v.columnNames)}else _.step();_.reset().finalize(),_=null}}}finally{c.scopedAllocPop(re),_&&(delete _._lockedByExec,_.finalize())}return y.returnVal()},createFunction:function(v,f,p){const _=j=>j instanceof Function;switch(arguments.length){case 1:p=v,v=p.name,f=p.xFunc||0;break;case 2:_(f)||(p=f,f=p.xFunc||0);break}p||(p={}),typeof v!="string"&&l("Invalid arguments: missing function name.");let F=p.xStep||0,G=p.xFinal||0;const re=p.xValue||0,ae=p.xInverse||0;let ie;_(f)?(ie=!1,(_(F)||_(G))&&l("Ambiguous arguments: scalar or aggregate?"),F=G=null):_(F)?(_(G)||l("Missing xFinal() callback for aggregate or window UDF."),f=null):_(G)?l("Missing xStep() callback for aggregate or window UDF."):l("Missing function-type properties."),ie===!1?(_(re)||_(ae))&&l("xValue and xInverse are not permitted for non-window UDFs."):_(re)?(_(ae)||l("xInverse must be provided if xValue is."),ie=!0):_(ae)&&l("xValue must be provided if xInverse is.");const ce=p.pApp;ce!=null&&(typeof ce!="number"||!d.isInt32(ce))&&l("Invalid value for pApp property. Must be a legal WASM pointer value.");const ue=p.xDestroy||0;ue&&!_(ue)&&l("xDestroy property must be a function.");let me=0;L(p,"deterministic")&&(me|=a.SQLITE_DETERMINISTIC),L(p,"directOnly")&&(me|=a.SQLITE_DIRECTONLY),L(p,"innocuous")&&(me|=a.SQLITE_INNOCUOUS),v=v.toLowerCase();const ve=f||F,Qe=L(p,"arity"),_t=typeof Qe=="number"?Qe:ve.length?ve.length-1:0;let C;return ie?C=a.sqlite3_create_window_function(this.pointer,v,_t,a.SQLITE_UTF8|me,ce||0,F,G,re,ae,ue):C=a.sqlite3_create_function_v2(this.pointer,v,_t,a.SQLITE_UTF8|me,ce||0,f,F,G,ue),g.checkRc(this,C),this},selectValue:function(y,v,f){return J(this,y,v,0,f)},selectValues:function(y,v,f){const p=this.prepare(y),_=[];try{for(p.bind(v);p.step();)_.push(p.get(0,f));p.reset()}finally{p.finalize()}return _},selectArray:function(y,v){return J(this,y,v,[])},selectObject:function(y,v){return J(this,y,v,{})},selectArrays:function(y,v){return H(this,y,v,"array")},selectObjects:function(y,v){return H(this,y,v,"object")},openStatementCount:function(){return this.pointer?Object.keys(k.get(this)).length:0},transaction:function(y){let v="BEGIN";arguments.length>1&&(/[^a-zA-Z]/.test(arguments[0])&&l(a.SQLITE_MISUSE,"Invalid argument for BEGIN qualifier."),v+=" "+arguments[0],y=arguments[1]),A(this).exec(v);try{const f=y(this);return this.exec("COMMIT"),f}catch(f){throw this.exec("ROLLBACK"),f}},savepoint:function(y){A(this).exec("SAVEPOINT oo1");try{const v=y(this);return this.exec("RELEASE oo1"),v}catch(v){throw this.exec("ROLLBACK to SAVEPOINT oo1; RELEASE SAVEPOINT oo1"),v}},checkRc:function(y){return X(this,y)}};const U=function(y){return y.pointer||l("Stmt has been closed."),y},le=function(y){let v=w[y==null?"null":typeof y];switch(v){case w.boolean:case w.null:case w.number:case w.string:return v;case w.bigint:if(c.bigIntEnabled)return v;default:return d.isBindableTypedArray(y)?w.blob:void 0}},m=function(y){return le(y)||l("Unsupported bind() argument type:",typeof y)},N=function(y,v){const f=typeof v=="number"?v:a.sqlite3_bind_parameter_index(y.pointer,v);return f===0||!d.isInt32(f)?l("Invalid bind() parameter name: "+v):(f<1||f>y.parameterCount)&&l("Bind index",v,"is out of range."),f},O=function(y,v){return y._lockedByExec&&l("Operation is illegal when statement is locked:",v),y},z=function y(v,f,p,_){O(U(v),"bind()"),y._||(y._tooBigInt=G=>l("BigInt value is too big to store without precision loss:",G),y._={string:function(G,re,ae,ie){const[ce,ue]=c.allocCString(ae,!0);return(ie?a.sqlite3_bind_blob:a.sqlite3_bind_text)(G.pointer,re,ce,ue,a.SQLITE_WASM_DEALLOC)}}),m(_),f=N(v,f);let F=0;switch(_==null?w.null:p){case w.null:F=a.sqlite3_bind_null(v.pointer,f);break;case w.string:F=y._.string(v,f,_,!1);break;case w.number:{let G;d.isInt32(_)?G=a.sqlite3_bind_int:typeof _=="bigint"?d.bigIntFits64(_)?c.bigIntEnabled?G=a.sqlite3_bind_int64:d.bigIntFitsDouble(_)?(_=Number(_),G=a.sqlite3_bind_double):y._tooBigInt(_):y._tooBigInt(_):(_=Number(_),c.bigIntEnabled&&Number.isInteger(_)?G=a.sqlite3_bind_int64:G=a.sqlite3_bind_double),F=G(v.pointer,f,_);break}case w.boolean:F=a.sqlite3_bind_int(v.pointer,f,_?1:0);break;case w.blob:{if(typeof _=="string"){F=y._.string(v,f,_,!0);break}else _ instanceof ArrayBuffer?_=new Uint8Array(_):d.isBindableTypedArray(_)||l("Binding a value as a blob requires","that it be a string, Uint8Array, Int8Array, or ArrayBuffer.");const G=c.alloc(_.byteLength||1);c.heap8().set(_.byteLength?_:[0],G),F=a.sqlite3_bind_blob(v.pointer,f,G,_.byteLength,a.SQLITE_WASM_DEALLOC);break}default:i.config.warn("Unsupported bind() argument type:",_),l("Unsupported bind() argument type: "+typeof _)}return F&&g.checkRc(v.db.pointer,F),v._mayGet=!1,v};E.prototype={finalize:function(){if(this.pointer){O(this,"finalize()");const y=a.sqlite3_finalize(this.pointer);return delete k.get(this.db)[this.pointer],b.delete(this),delete this._mayGet,delete this.parameterCount,delete this._lockedByExec,delete this.db,y}},clearBindings:function(){return O(U(this),"clearBindings()"),a.sqlite3_clear_bindings(this.pointer),this._mayGet=!1,this},reset:function(y){O(this,"reset()"),y&&this.clearBindings();const v=a.sqlite3_reset(U(this).pointer);return this._mayGet=!1,X(this.db,v),this},bind:function(){U(this);let y,v;switch(arguments.length){case 1:y=1,v=arguments[0];break;case 2:y=arguments[0],v=arguments[1];break;default:l("Invalid bind() arguments.")}return v===void 0?this:(this.parameterCount||l("This statement has no bindable parameters."),this._mayGet=!1,v===null?z(this,y,w.null,v):Array.isArray(v)?(arguments.length!==1&&l("When binding an array, an index argument is not permitted."),v.forEach((f,p)=>z(this,p+1,m(f),f)),this):(v instanceof ArrayBuffer&&(v=new Uint8Array(v)),typeof v=="object"&&!d.isBindableTypedArray(v)?(arguments.length!==1&&l("When binding an object, an index argument is not permitted."),Object.keys(v).forEach(f=>z(this,f,m(v[f]),v[f])),this):z(this,y,m(v),v)))},bindAsBlob:function(y,v){U(this),arguments.length===1&&(v=y,y=1);const f=m(v);return w.string!==f&&w.blob!==f&&w.null!==f&&l("Invalid value type for bindAsBlob()"),z(this,y,w.blob,v)},step:function(){O(this,"step()");const y=a.sqlite3_step(U(this).pointer);switch(y){case a.SQLITE_DONE:return this._mayGet=!1;case a.SQLITE_ROW:return this._mayGet=!0;default:this._mayGet=!1,i.config.warn("sqlite3_step() rc=",y,a.sqlite3_js_rc_str(y),"SQL =",a.sqlite3_sql(this.pointer)),g.checkRc(this.db.pointer,y)}},stepReset:function(){return this.step(),this.reset()},stepFinalize:function(){try{const y=this.step();return this.reset(),y}finally{try{this.finalize()}catch{}}},get:function(y,v){if(U(this)._mayGet||l("Stmt.step() has not (recently) returned true."),Array.isArray(y)){let f=0;const p=this.columnCount;for(;f<p;)y[f]=this.get(f++);return y}else if(y&&typeof y=="object"){let f=0;const p=this.columnCount;for(;f<p;)y[a.sqlite3_column_name(this.pointer,f)]=this.get(f++);return y}switch(q(this,y),v===void 0?a.sqlite3_column_type(this.pointer,y):v){case a.SQLITE_NULL:return null;case a.SQLITE_INTEGER:if(c.bigIntEnabled){const f=a.sqlite3_column_int64(this.pointer,y);return f>=Number.MIN_SAFE_INTEGER&&f<=Number.MAX_SAFE_INTEGER?Number(f).valueOf():f}else{const f=a.sqlite3_column_double(this.pointer,y);return(f>Number.MAX_SAFE_INTEGER||f<Number.MIN_SAFE_INTEGER)&&l("Integer is out of range for JS integer range: "+f),d.isInt32(f)?f|0:f}case a.SQLITE_FLOAT:return a.sqlite3_column_double(this.pointer,y);case a.SQLITE_TEXT:return a.sqlite3_column_text(this.pointer,y);case a.SQLITE_BLOB:{const f=a.sqlite3_column_bytes(this.pointer,y),p=a.sqlite3_column_blob(this.pointer,y),_=new Uint8Array(f);return f&&_.set(c.heap8u().slice(p,p+f),0),f&&this.db._blobXfer instanceof Array&&this.db._blobXfer.push(_.buffer),_}default:l("Don't know how to translate","type of result column #"+y+".")}l("Not reached.")},getInt:function(y){return this.get(y,a.SQLITE_INTEGER)},getFloat:function(y){return this.get(y,a.SQLITE_FLOAT)},getString:function(y){return this.get(y,a.SQLITE_TEXT)},getBlob:function(y){return this.get(y,a.SQLITE_BLOB)},getJSON:function(y){const v=this.get(y,a.SQLITE_STRING);return v===null?v:JSON.parse(v)},getColumnName:function(y){return a.sqlite3_column_name(q(U(this),y).pointer,y)},getColumnNames:function(y=[]){q(U(this),0);const v=this.columnCount;for(let f=0;f<v;++f)y.push(a.sqlite3_column_name(this.pointer,f));return y},getParamIndex:function(y){return U(this).parameterCount?a.sqlite3_bind_parameter_index(this.pointer,y):void 0}};{const y={enumerable:!0,get:function(){return b.get(this)},set:()=>l("The pointer property is read-only.")};Object.defineProperty(E.prototype,"pointer",y),Object.defineProperty(g.prototype,"pointer",y)}if(Object.defineProperty(E.prototype,"columnCount",{enumerable:!1,get:function(){return a.sqlite3_column_count(this.pointer)},set:()=>l("The columnCount property is read-only.")}),i.oo1={DB:g,Stmt:E},d.isUIThread()){i.oo1.JsStorageDb=function(v="session"){v!=="session"&&v!=="local"&&l("JsStorageDb db name must be one of 'session' or 'local'."),T.call(this,{filename:v,flags:"c",vfs:"kvvfs"})};const y=i.oo1.JsStorageDb;y.prototype=Object.create(g.prototype),y.clearStorage=a.sqlite3_js_kvvfs_clear,y.prototype.clearStorage=function(){return y.clearStorage(A(this).filename)},y.storageSize=a.sqlite3_js_kvvfs_size,y.prototype.storageSize=function(){return y.storageSize(A(this).filename)}}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){i.initWorker1API=(function(){const l=(...g)=>{throw new Error(g.join(" "))};globalThis.WorkerGlobalScope instanceof Function||l("initWorker1API() must be run from a Worker thread."),this.self;const a=this.sqlite3||l("Missing this.sqlite3 object."),c=a.oo1.DB,d=function(g){let w=b.idMap.get(g);return w||(w="db#"+ ++b.idSeq+"@"+g.pointer,b.idMap.set(g,w),w)},b={dbList:[],idSeq:0,idMap:new WeakMap,xfer:[],open:function(g){const w=new c(g);return this.dbs[d(w)]=w,this.dbList.indexOf(w)<0&&this.dbList.push(w),w},close:function(g,w){if(g){delete this.dbs[d(g)];const E=g.filename,A=a.wasm.sqlite3_wasm_db_vfs(g.pointer,0);g.close();const q=this.dbList.indexOf(g);q>=0&&this.dbList.splice(q,1),w&&E&&A&&a.wasm.sqlite3_wasm_vfs_unlink(A,E)}},post:function(g,w){w&&w.length?(globalThis.postMessage(g,Array.from(w)),w.length=0):globalThis.postMessage(g)},dbs:Object.create(null),getDb:function(g,w=!0){return this.dbs[g]||(w?l("Unknown (or closed) DB ID:",g):void 0)}},k=function(g=b.dbList[0]){return g&&g.pointer?g:l("DB is not opened.")},L=function(g,w=!0){const E=b.getDb(g.dbId,!1)||b.dbList[0];return w?k(E):E},X=function(){return b.dbList[0]&&d(b.dbList[0])},ee=function(g){const w=/^file:.+(vfs=(\w+))/.exec(g);return a.capi.sqlite3_vfs_find(w?w[2]:0)},oe=g=>g===""||g[0]===":",T={open:function(g){const w=Object.create(null),E=g.args||Object.create(null);E.simulateError&&l("Throwing because of simulateError flag.");const A=Object.create(null);let q,B;if(w.vfs=E.vfs,oe(E.filename)?w.filename=E.filename||"":(w.filename=E.filename,q=E.byteArray,q&&(B=ee(E.filename))),B){let H;try{H=a.wasm.allocFromTypedArray(q);const U=a.wasm.sqlite3_wasm_vfs_create_file(B,w.filename,H,q.byteLength);U&&a.SQLite3Error.toss(U)}catch(U){throw new a.SQLite3Error(U.name+" creating "+E.filename+": "+U.message,{cause:U})}finally{H&&a.wasm.dealloc(H)}}const J=b.open(w);return A.filename=J.filename,A.persistent=!!a.capi.sqlite3_js_db_uses_vfs(J.pointer,"opfs"),A.dbId=d(J),A.vfs=J.dbVfsName(),A},close:function(g){const w=L(g,!1),E={filename:w&&w.filename};if(w){const A=g.args&&typeof g.args=="object"?!!g.args.unlink:!1;b.close(w,A)}return E},exec:function(g){const w=typeof g.args=="string"?{sql:g.args}:g.args||Object.create(null);w.rowMode==="stmt"?l("Invalid rowMode for 'exec': stmt mode","does not work in the Worker API."):w.sql||l("'exec' requires input SQL.");const E=L(g);(w.callback||Array.isArray(w.resultRows))&&(E._blobXfer=b.xfer);const A=w.callback;let q=0;const B=!!w.columnNames;typeof A=="string"&&(B||(w.columnNames=[]),w.callback=function(J,H){b.post({type:A,columnNames:w.columnNames,rowNumber:++q,row:J},b.xfer)});try{const J=w.countChanges?E.changes(!0,w.countChanges===64):void 0;E.exec(w),J!==void 0&&(w.changeCount=E.changes(!0,w.countChanges===64)-J),w.callback instanceof Function&&(w.callback=A,b.post({type:A,columnNames:w.columnNames,rowNumber:null,row:void 0}))}finally{delete E._blobXfer,w.callback&&(w.callback=A)}return w},"config-get":function(){const g=Object.create(null),w=a.config;return["bigIntEnabled"].forEach(function(E){Object.getOwnPropertyDescriptor(w,E)&&(g[E]=w[E])}),g.version=a.version,g.vfsList=a.capi.sqlite3_js_vfs_list(),g.opfsEnabled=!!a.opfs,g},export:function(g){const w=L(g),E={byteArray:a.capi.sqlite3_js_db_export(w.pointer),filename:w.filename,mimetype:"application/x-sqlite3"};return b.xfer.push(E.byteArray.buffer),E},toss:function(g){l("Testing worker exception")},"opfs-tree":async function(g){return a.opfs||l("OPFS support is unavailable."),await a.opfs.treeList()}};globalThis.onmessage=async function(g){g=g.data;let w,E=g.dbId,A=g.type;const q=performance.now();try{T.hasOwnProperty(A)&&T[A]instanceof Function?w=await T[A](g):l("Unknown db worker message type:",g.type)}catch(B){A="error",w={operation:g.type,message:B.message,errorClass:B.name,input:g},B.stack&&(w.stack=typeof B.stack=="string"?B.stack.split(/\n\s*/):B.stack)}E||(E=w.dbId||X()),b.post({type:A,dbId:E,messageId:g.messageId,workerReceivedTime:q,workerRespondTime:performance.now(),departureTime:g.departureTime,result:w},b.xfer)},globalThis.postMessage({type:"sqlite3-api",result:"worker1-ready"})}).bind({self,sqlite3:i})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=i.wasm,a=i.capi,c=i.util.toss3,d=Object.create(null),b=Object.create(null),k=i.StructBinder;i.vfs=d,i.vtab=b;const L=a.sqlite3_index_info;L.prototype.nthConstraint=function(g,w=!1){if(g<0||g>=this.$nConstraint)return!1;const E=this.$aConstraint+L.sqlite3_index_constraint.structInfo.sizeof*g;return w?E:new L.sqlite3_index_constraint(E)},L.prototype.nthConstraintUsage=function(g,w=!1){if(g<0||g>=this.$nConstraint)return!1;const E=this.$aConstraintUsage+L.sqlite3_index_constraint_usage.structInfo.sizeof*g;return w?E:new L.sqlite3_index_constraint_usage(E)},L.prototype.nthOrderBy=function(g,w=!1){if(g<0||g>=this.$nOrderBy)return!1;const E=this.$aOrderBy+L.sqlite3_index_orderby.structInfo.sizeof*g;return w?E:new L.sqlite3_index_orderby(E)};const X=function g(w,E,A,q=g.installMethodArgcCheck){if(w instanceof k.StructType?!(A instanceof Function)&&!l.isPtr(A)&&c("Usage errror: expecting a Function or WASM pointer to one."):c("Usage error: target object is-not-a StructType."),arguments.length===1)return(U,le)=>g(w,U,le,q);g.argcProxy||(g.argcProxy=function(U,le,m,N){return function(...O){return m.length!==arguments.length&&c("Argument mismatch for",U.structInfo.name+"::"+le+": Native signature is:",N),m.apply(this,O)}},g.removeFuncList=function(){this.ondispose.__removeFuncList&&(this.ondispose.__removeFuncList.forEach((U,le)=>{if(typeof U=="number")try{l.uninstallFunction(U)}catch{}}),delete this.ondispose.__removeFuncList)});const B=w.memberSignature(E);B.length<2&&c("Member",E,"does not have a function pointer signature:",B);const J=w.memberKey(E),H=q&&!l.isPtr(A)?g.argcProxy(w,J,A,B):A;if(l.isPtr(H))H&&!l.functionEntry(H)&&c("Pointer",H,"is not a WASM function table entry."),w[J]=H;else{const U=l.installFunction(H,w.memberSignature(E,!0));w[J]=U,(!w.ondispose||!w.ondispose.__removeFuncList)&&(w.addOnDispose("ondispose.__removeFuncList handler",g.removeFuncList),w.ondispose.__removeFuncList=[]),w.ondispose.__removeFuncList.push(J,U)}return(U,le)=>g(w,U,le,q)};X.installMethodArgcCheck=!1;const ee=function(g,w,E=X.installMethodArgcCheck){const A=new Map;for(const q of Object.keys(w)){const B=w[q],J=A.get(B);if(J){const H=g.memberKey(q);g[H]=g[g.memberKey(J)]}else X(g,q,B,E),A.set(B,q)}return g};k.StructType.prototype.installMethod=function(w,E,A=X.installMethodArgcCheck){return arguments.length<3&&w&&typeof w=="object"?ee(this,...arguments):X(this,...arguments)},k.StructType.prototype.installMethods=function(g,w=X.installMethodArgcCheck){return ee(this,g,w)},a.sqlite3_vfs.prototype.registerVfs=function(g=!1){this instanceof i.capi.sqlite3_vfs||c("Expecting a sqlite3_vfs-type argument.");const w=a.sqlite3_vfs_register(this,g?1:0);return w&&c("sqlite3_vfs_register(",this,") failed with rc",w),this.pointer!==a.sqlite3_vfs_find(this.$zName)&&c("BUG: sqlite3_vfs_find(vfs.$zName) failed for just-installed VFS",this),this},d.installVfs=function(g){let w=0;const E=["io","vfs"];for(const A of E){const q=g[A];q&&(++w,ee(q.struct,q.methods,!!q.applyArgcCheck),A==="vfs"&&(!q.struct.$zName&&typeof q.name=="string"&&q.struct.addOnDispose(q.struct.$zName=l.allocCString(q.name)),q.struct.registerVfs(!!q.asDefault)))}return w||c("Misuse: installVfs() options object requires at least","one of:",E),this};const oe=function(g,w){return(function(E,A=!1){if(arguments.length===0&&(E=new w),E instanceof w)return this.set(E.pointer,E),E;l.isPtr(E)||i.SQLite3Error.toss("Invalid argument to",g+"()");let q=this.get(E);return A&&this.delete(E),q}).bind(new Map)},T=function(g,w){const E=oe(g,w);return Object.assign(Object.create(null),{StructType:w,create:A=>{const q=E();return l.pokePtr(A,q.pointer),q},get:A=>E(A),unget:A=>E(A,!0),dispose:A=>{const q=E(A,!0);q&&q.dispose()}})};b.xVtab=T("xVtab",a.sqlite3_vtab),b.xCursor=T("xCursor",a.sqlite3_vtab_cursor),b.xIndexInfo=g=>new a.sqlite3_index_info(g),b.xError=function g(w,E,A){if(g.errorReporter instanceof Function)try{g.errorReporter("sqlite3_module::"+w+"(): "+E.message)}catch{}let q;return E instanceof i.WasmAllocError?q=a.SQLITE_NOMEM:arguments.length>2?q=A:E instanceof i.SQLite3Error&&(q=E.resultCode),q||a.SQLITE_ERROR},b.xError.errorReporter=console.error.bind(console),b.xRowid=(g,w)=>l.poke(g,w,"i64"),b.setupModule=function(g){let w=!1;const E=this instanceof a.sqlite3_module?this:g.struct||(w=new a.sqlite3_module);try{const A=g.methods||c("Missing 'methods' object.");for(const q of Object.entries({xConnect:"xCreate",xDisconnect:"xDestroy"})){const B=q[0],J=q[1];A[B]===!0?A[B]=A[J]:A[J]===!0&&(A[J]=A[B])}if(g.catchExceptions){const q=function(H,U){return["xConnect","xCreate"].indexOf(H)>=0?function(le,m,N,O,z,y){try{return U(...arguments)||0}catch(v){return v instanceof i.WasmAllocError||(l.dealloc(l.peekPtr(y)),l.pokePtr(y,l.allocCString(v.message))),b.xError(H,v)}}:function(...le){try{return U(...le)||0}catch(m){return b.xError(H,m)}}},B=["xCreate","xConnect","xBestIndex","xDisconnect","xDestroy","xOpen","xClose","xFilter","xNext","xEof","xColumn","xRowid","xUpdate","xBegin","xSync","xCommit","xRollback","xFindFunction","xRename","xSavepoint","xRelease","xRollbackTo","xShadowName"],J=Object.create(null);for(const H of B){const U=A[H];if(U instanceof Function)H==="xConnect"&&A.xCreate===U?J[H]=A.xCreate:H==="xCreate"&&A.xConnect===U?J[H]=A.xConnect:J[H]=q(H,U);else continue}ee(E,J,!1)}else ee(E,A,!!g.applyArgcCheck);if(E.$iVersion===0){let q;typeof g.iVersion=="number"?q=g.iVersion:E.$xShadowName?q=3:E.$xSavePoint||E.$xRelease||E.$xRollbackTo?q=2:q=1,E.$iVersion=q}}catch(A){throw w&&w.dispose(),A}return E},a.sqlite3_module.prototype.setupModule=function(g){return b.setupModule.call(this,g)}}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){const l=function a(c){var k;if(!globalThis.SharedArrayBuffer||!globalThis.Atomics)return Promise.reject(new Error("Cannot install OPFS: Missing SharedArrayBuffer and/or Atomics. The server must emit the COOP/COEP response headers to enable those. See https://sqlite.org/wasm/doc/trunk/persistence.md#coop-coep"));if(typeof WorkerGlobalScope>"u")return Promise.reject(new Error("The OPFS sqlite3_vfs cannot run in the main thread because it requires Atomics.wait()."));if(!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((k=navigator==null?void 0:navigator.storage)!=null&&k.getDirectory))return Promise.reject(new Error("Missing required OPFS APIs."));(!c||typeof c!="object")&&(c=Object.create(null));const d=new URL(globalThis.location.href).searchParams;return d.has("opfs-disable")?Promise.resolve(i):(c.verbose===void 0&&(c.verbose=d.has("opfs-verbose")?+d.get("opfs-verbose")||2:1),c.sanityChecks===void 0&&(c.sanityChecks=d.has("opfs-sanity-check")),c.proxyUri===void 0&&(c.proxyUri=a.defaultProxyUri),typeof c.proxyUri=="function"&&(c.proxyUri=c.proxyUri()),new Promise(function(L,X){const ee=[i.config.error,i.config.warn,i.config.log],oe=(C,...j)=>{c.verbose>C&&ee[C]("OPFS syncer:",...j)},T=(...C)=>oe(2,...C),g=(...C)=>oe(1,...C),w=(...C)=>oe(0,...C),E=i.util.toss,A=i.capi,q=i.wasm,B=A.sqlite3_vfs,J=A.sqlite3_file,H=A.sqlite3_io_methods,U=Object.create(null),le=()=>{var C;return globalThis.FileSystemHandle&&globalThis.FileSystemDirectoryHandle&&globalThis.FileSystemFileHandle&&globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle&&((C=navigator==null?void 0:navigator.storage)==null?void 0:C.getDirectory)};U.metrics={dump:function(){let C,j=0,V=0,ne=0;for(C in _.opIds){const Z=F[C];j+=Z.count,V+=Z.time,ne+=Z.wait,Z.avgTime=Z.count&&Z.time?Z.time/Z.count:0,Z.avgWait=Z.count&&Z.wait?Z.wait/Z.count:0}i.config.log(globalThis.location.href,"metrics for",globalThis.location.href,":",F,`
Total of`,j,"op(s) for",V,"ms (incl. "+ne+" ms of waiting on the async side)"),i.config.log("Serialization metrics:",F.s11n),v.postMessage({type:"opfs-async-metrics"})},reset:function(){let C;const j=ne=>ne.count=ne.time=ne.wait=0;for(C in _.opIds)j(F[C]=Object.create(null));let V=F.s11n=Object.create(null);V=V.serialize=Object.create(null),V.count=V.time=0,V=F.s11n.deserialize=Object.create(null),V.count=V.time=0}};const m=new H,N=new B().addOnDispose(()=>m.dispose());let O;const z=C=>(O=!0,N.dispose(),X(C)),y=()=>(O=!1,L(i)),v=new Worker(new URL(""+new URL("sqlite3-opfs-async-proxy-5de694f2.js",self.location.href).href,self.location));setTimeout(()=>{O===void 0&&z(new Error("Timeout while waiting for OPFS async proxy worker."))},4e3),v._originalOnError=v.onerror,v.onerror=function(C){w("Error initializing OPFS asyncer:",C),z(new Error("Loading OPFS async Worker failed for unknown reasons."))};const f=A.sqlite3_vfs_find(null),p=f?new B(f):null;m.$iVersion=1,N.$iVersion=2,N.$szOsFile=A.sqlite3_file.structInfo.sizeof,N.$mxPathname=1024,N.$zName=q.allocCString("opfs"),N.$xDlOpen=N.$xDlError=N.$xDlSym=N.$xDlClose=null,N.addOnDispose("$zName",N.$zName,"cleanup default VFS wrapper",()=>p?p.dispose():null);const _=Object.create(null);_.verbose=c.verbose,_.littleEndian=(()=>{const C=new ArrayBuffer(2);return new DataView(C).setInt16(0,256,!0),new Int16Array(C)[0]===256})(),_.asyncIdleWaitTime=150,_.asyncS11nExceptions=1,_.fileBufferSize=1024*64,_.sabS11nOffset=_.fileBufferSize,_.sabS11nSize=N.$mxPathname*2,_.sabIO=new SharedArrayBuffer(_.fileBufferSize+_.sabS11nSize),_.opIds=Object.create(null);const F=Object.create(null);{let C=0;_.opIds.whichOp=C++,_.opIds.rc=C++,_.opIds.xAccess=C++,_.opIds.xClose=C++,_.opIds.xDelete=C++,_.opIds.xDeleteNoWait=C++,_.opIds.xFileSize=C++,_.opIds.xLock=C++,_.opIds.xOpen=C++,_.opIds.xRead=C++,_.opIds.xSleep=C++,_.opIds.xSync=C++,_.opIds.xTruncate=C++,_.opIds.xUnlock=C++,_.opIds.xWrite=C++,_.opIds.mkdir=C++,_.opIds["opfs-async-metrics"]=C++,_.opIds["opfs-async-shutdown"]=C++,_.opIds.retry=C++,_.sabOP=new SharedArrayBuffer(C*4),U.metrics.reset()}_.sq3Codes=Object.create(null),["SQLITE_ACCESS_EXISTS","SQLITE_ACCESS_READWRITE","SQLITE_BUSY","SQLITE_ERROR","SQLITE_IOERR","SQLITE_IOERR_ACCESS","SQLITE_IOERR_CLOSE","SQLITE_IOERR_DELETE","SQLITE_IOERR_FSYNC","SQLITE_IOERR_LOCK","SQLITE_IOERR_READ","SQLITE_IOERR_SHORT_READ","SQLITE_IOERR_TRUNCATE","SQLITE_IOERR_UNLOCK","SQLITE_IOERR_WRITE","SQLITE_LOCK_EXCLUSIVE","SQLITE_LOCK_NONE","SQLITE_LOCK_PENDING","SQLITE_LOCK_RESERVED","SQLITE_LOCK_SHARED","SQLITE_LOCKED","SQLITE_MISUSE","SQLITE_NOTFOUND","SQLITE_OPEN_CREATE","SQLITE_OPEN_DELETEONCLOSE","SQLITE_OPEN_MAIN_DB","SQLITE_OPEN_READONLY"].forEach(C=>{(_.sq3Codes[C]=A[C])===void 0&&E("Maintenance required: not found:",C)}),_.opfsFlags=Object.assign(Object.create(null),{OPFS_UNLOCK_ASAP:1,defaultUnlockAsap:!1});const G=(C,...j)=>{const V=_.opIds[C]||E("Invalid op ID:",C);_.s11n.serialize(...j),Atomics.store(_.sabOPView,_.opIds.rc,-1),Atomics.store(_.sabOPView,_.opIds.whichOp,V),Atomics.notify(_.sabOPView,_.opIds.whichOp);const ne=performance.now();Atomics.wait(_.sabOPView,_.opIds.rc,-1);const Z=Atomics.load(_.sabOPView,_.opIds.rc);if(F[C].wait+=performance.now()-ne,Z&&_.asyncS11nExceptions){const xe=_.s11n.deserialize();xe&&w(C+"() async error:",...xe)}return Z};U.debug={asyncShutdown:()=>{g("Shutting down OPFS async listener. The OPFS VFS will no longer work."),G("opfs-async-shutdown")},asyncRestart:()=>{g("Attempting to restart OPFS VFS async listener. Might work, might not."),v.postMessage({type:"opfs-async-restart"})}};const re=()=>{if(_.s11n)return _.s11n;const C=new TextDecoder,j=new TextEncoder("utf-8"),V=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),ne=new DataView(_.sabIO,_.sabS11nOffset,_.sabS11nSize);_.s11n=Object.create(null);const Z=Object.create(null);Z.number={id:1,size:8,getter:"getFloat64",setter:"setFloat64"},Z.bigint={id:2,size:8,getter:"getBigInt64",setter:"setBigInt64"},Z.boolean={id:3,size:4,getter:"getInt32",setter:"setInt32"},Z.string={id:4};const xe=M=>Z[typeof M]||E("Maintenance required: this value type cannot be serialized.",M),se=M=>{switch(M){case Z.number.id:return Z.number;case Z.bigint.id:return Z.bigint;case Z.boolean.id:return Z.boolean;case Z.string.id:return Z.string;default:E("Invalid type ID:",M)}};return _.s11n.deserialize=function(M=!1){++F.s11n.deserialize.count;const I=performance.now(),D=V[0],x=D?[]:null;if(D){const P=[];let W=1,$,de,we;for($=0;$<D;++$,++W)P.push(se(V[W]));for($=0;$<D;++$){const Se=P[$];Se.getter?(we=ne[Se.getter](W,_.littleEndian),W+=Se.size):(de=ne.getInt32(W,_.littleEndian),W+=4,we=C.decode(V.slice(W,W+de)),W+=de),x.push(we)}}return M&&(V[0]=0),F.s11n.deserialize.time+=performance.now()-I,x},_.s11n.serialize=function(...M){const I=performance.now();if(++F.s11n.serialize.count,M.length){const D=[];let x=0,P=1;for(V[0]=M.length&255;x<M.length;++x,++P)D.push(xe(M[x])),V[P]=D[x].id;for(x=0;x<M.length;++x){const W=D[x];if(W.setter)ne[W.setter](P,M[x],_.littleEndian),P+=W.size;else{const $=j.encode(M[x]);ne.setInt32(P,$.byteLength,_.littleEndian),P+=4,V.set($,P),P+=$.byteLength}}}else V[0]=0;F.s11n.serialize.time+=performance.now()-I},_.s11n},ae=function C(j=16){C._chars||(C._chars="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ012346789",C._n=C._chars.length);const V=[];let ne=0;for(;ne<j;++ne){const Z=Math.random()*(C._n*64)%C._n|0;V[ne]=C._chars[Z]}return V.join("")},ie=Object.create(null),ce=Object.create(null);ce.op=void 0,ce.start=void 0;const ue=C=>{ce.start=performance.now(),ce.op=C,++F[C].count},me=()=>F[ce.op].time+=performance.now()-ce.start,ve={xCheckReservedLock:function(C,j){const V=ie[C];return q.poke(j,V.lockType?1:0,"i32"),0},xClose:function(C){ue("xClose");let j=0;const V=ie[C];return V&&(delete ie[C],j=G("xClose",C),V.sq3File&&V.sq3File.dispose()),me(),j},xDeviceCharacteristics:function(C){return A.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(C,j,V){return A.SQLITE_NOTFOUND},xFileSize:function(C,j){ue("xFileSize");let V=G("xFileSize",C);if(V==0)try{const ne=_.s11n.deserialize()[0];q.poke(j,ne,"i64")}catch(ne){w("Unexpected error reading xFileSize() result:",ne),V=_.sq3Codes.SQLITE_IOERR}return me(),V},xLock:function(C,j){ue("xLock");const V=ie[C];let ne=0;return V.lockType?V.lockType=j:(ne=G("xLock",C,j),ne===0&&(V.lockType=j)),me(),ne},xRead:function(C,j,V,ne){ue("xRead");const Z=ie[C];let xe;try{xe=G("xRead",C,V,Number(ne)),(xe===0||A.SQLITE_IOERR_SHORT_READ===xe)&&q.heap8u().set(Z.sabView.subarray(0,V),j)}catch(se){w("xRead(",arguments,") failed:",se,Z),xe=A.SQLITE_IOERR_READ}return me(),xe},xSync:function(C,j){ue("xSync"),++F.xSync.count;const V=G("xSync",C,j);return me(),V},xTruncate:function(C,j){ue("xTruncate");const V=G("xTruncate",C,Number(j));return me(),V},xUnlock:function(C,j){ue("xUnlock");const V=ie[C];let ne=0;return A.SQLITE_LOCK_NONE===j&&V.lockType&&(ne=G("xUnlock",C,j)),ne===0&&(V.lockType=j),me(),ne},xWrite:function(C,j,V,ne){ue("xWrite");const Z=ie[C];let xe;try{Z.sabView.set(q.heap8u().subarray(j,j+V)),xe=G("xWrite",C,V,Number(ne))}catch(se){w("xWrite(",arguments,") failed:",se,Z),xe=A.SQLITE_IOERR_WRITE}return me(),xe}},Qe={xAccess:function(C,j,V,ne){ue("xAccess");const Z=G("xAccess",q.cstrToJs(j));return q.poke(ne,Z?0:1,"i32"),me(),0},xCurrentTime:function(C,j){return q.poke(j,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(C,j){return q.poke(j,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(C,j,V){ue("xDelete");const ne=G("xDelete",q.cstrToJs(j),V,!1);return me(),ne},xFullPathname:function(C,j,V,ne){return q.cstrncpy(ne,j,V)<V?0:A.SQLITE_CANTOPEN},xGetLastError:function(C,j,V){return g("OPFS xGetLastError() has nothing sensible to return."),0},xOpen:function(j,V,ne,Z,xe){ue("xOpen");let se=0;V===0?V=ae():typeof V=="number"&&(A.sqlite3_uri_boolean(V,"opfs-unlock-asap",0)&&(se|=_.opfsFlags.OPFS_UNLOCK_ASAP),V=q.cstrToJs(V));const M=Object.create(null);M.fid=ne,M.filename=V,M.sab=new SharedArrayBuffer(_.fileBufferSize),M.flags=Z;const I=G("xOpen",ne,V,Z,se);return I||(M.readOnly&&q.poke(xe,A.SQLITE_OPEN_READONLY,"i32"),ie[ne]=M,M.sabView=_.sabFileBufView,M.sq3File=new J(ne),M.sq3File.$pMethods=m.pointer,M.lockType=A.SQLITE_LOCK_NONE),me(),I}};if(p&&(N.$xRandomness=p.$xRandomness,N.$xSleep=p.$xSleep),N.$xRandomness||(Qe.xRandomness=function(C,j,V){const ne=q.heap8u();let Z=0;for(;Z<j;++Z)ne[V+Z]=Math.random()*255e3&255;return Z}),N.$xSleep||(Qe.xSleep=function(C,j){return Atomics.wait(_.sabOPView,_.opIds.xSleep,0,j),0}),U.getResolvedPath=function(C,j){const V=new URL(C,"file://irrelevant").pathname;return j?V.split("/").filter(ne=>!!ne):V},U.getDirForFilename=async function(j,V=!1){const ne=U.getResolvedPath(j,!0),Z=ne.pop();let xe=U.rootDirectory;for(const se of ne)se&&(xe=await xe.getDirectoryHandle(se,{create:!!V}));return[xe,Z]},U.mkdir=async function(C){try{return await U.getDirForFilename(C+"/filepart",!0),!0}catch{return!1}},U.entryExists=async function(C){try{const[j,V]=await U.getDirForFilename(C);return await j.getFileHandle(V),!0}catch{return!1}},U.randomFilename=ae,U.registerVfs=(C=!1)=>q.exports.sqlite3_vfs_register(N.pointer,C?1:0),U.treeList=async function(){const C=async function V(ne,Z){Z.name=ne.name,Z.dirs=[],Z.files=[];for await(const xe of ne.values())if(xe.kind==="directory"){const se=Object.create(null);Z.dirs.push(se),await V(xe,se)}else Z.files.push(xe.name)},j=Object.create(null);return await C(U.rootDirectory,j),j},U.rmfr=async function(){const C=U.rootDirectory,j={recurse:!0};for await(const V of C.values())C.removeEntry(V.name,j)},U.unlink=async function(C,j=!1,V=!1){try{const[ne,Z]=await U.getDirForFilename(C,!1);return await ne.removeEntry(Z,{recursive:j}),!0}catch(ne){if(V)throw new Error("unlink(",arguments[0],") failed: "+ne.message,{cause:ne});return!1}},U.traverse=async function(C){const j={recursive:!0,directory:U.rootDirectory};typeof C=="function"&&(C={callback:C}),C=Object.assign(j,C||{}),async function ne(Z,xe){for await(const se of Z.values()){if(C.callback(se,Z,xe)===!1)return!1;if(C.recursive&&se.kind==="directory"&&await ne(se,xe+1)===!1)break}}(C.directory,0)},U.importDb=async function(C,j){j instanceof ArrayBuffer&&(j=new Uint8Array(j));const V=j.byteLength;(V<512||V%512!=0)&&E("Byte array size is invalid for an SQLite db.");const ne="SQLite format 3";for(let M=0;M<ne.length;++M)ne.charCodeAt(M)!==j[M]&&E("Input does not contain an SQLite database header.");let Z;const[xe,se]=await U.getDirForFilename(C,!0);try{Z=await(await xe.getFileHandle(se,{create:!0})).createSyncAccessHandle(),Z.truncate(0);const I=Z.write(j,{at:0});return I!=V&&E("Expected to write "+V+" bytes but wrote "+I+"."),Z.write(new Uint8Array([1,1]),{at:18}),I}catch(M){throw Z&&(await Z.close(),Z=void 0),await xe.removeEntry(se).catch(()=>{}),M}finally{Z&&await Z.close()}},i.oo1){const C=function(...j){const V=i.oo1.DB.dbCtorHelper.normalizeArgs(...j);V.vfs=N.$zName,i.oo1.DB.dbCtorHelper.call(this,V)};C.prototype=Object.create(i.oo1.DB.prototype),i.oo1.OpfsDb=C,C.importDb=U.importDb,i.oo1.DB.dbCtorHelper.setVfsPostOpenSql(N.pointer,function(j,V){V.capi.sqlite3_busy_timeout(j,1e4),V.capi.sqlite3_exec(j,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}const _t=function(){const C=q.scopedAllocPush(),j=new J;try{const V=j.pointer,ne=A.SQLITE_OPEN_CREATE|A.SQLITE_OPEN_READWRITE|A.SQLITE_OPEN_MAIN_DB,Z=q.scopedAlloc(8),xe="/sanity/check/file"+ae(8),se=q.scopedAllocCString(xe);let M;if(_.s11n.serialize("This is  string."),M=_.s11n.deserialize(),T("deserialize() says:",M),M[0]!=="This is  string."&&E("String d13n error."),Qe.xAccess(N.pointer,se,0,Z),M=q.peek(Z,"i32"),T("xAccess(",xe,") exists ?=",M),M=Qe.xOpen(N.pointer,se,V,ne,Z),T("open rc =",M,"state.sabOPView[xOpen] =",_.sabOPView[_.opIds.xOpen]),M!==0){w("open failed with code",M);return}Qe.xAccess(N.pointer,se,0,Z),M=q.peek(Z,"i32"),M||E("xAccess() failed to detect file."),M=ve.xSync(j.pointer,0),M&&E("sync failed w/ rc",M),M=ve.xTruncate(j.pointer,1024),M&&E("truncate failed w/ rc",M),q.poke(Z,0,"i64"),M=ve.xFileSize(j.pointer,Z),M&&E("xFileSize failed w/ rc",M),T("xFileSize says:",q.peek(Z,"i64")),M=ve.xWrite(j.pointer,se,10,1),M&&E("xWrite() failed!");const I=q.scopedAlloc(16);M=ve.xRead(j.pointer,I,6,2),q.poke(I+6,0);let D=q.cstrToJs(I);T("xRead() got:",D),D!=="sanity"&&E("Unexpected xRead() value."),Qe.xSleep&&(T("xSleep()ing before close()ing..."),Qe.xSleep(N.pointer,2e3),T("waking up from xSleep()")),M=ve.xClose(V),T("xClose rc =",M,"sabOPView =",_.sabOPView),T("Deleting file:",xe),Qe.xDelete(N.pointer,se,4660),Qe.xAccess(N.pointer,se,0,Z),M=q.peek(Z,"i32"),M&&E("Expecting 0 from xAccess(",xe,") after xDelete()."),g("End of OPFS sanity checks.")}finally{j.dispose(),q.scopedAllocPop(C)}};v.onmessage=function({data:C}){switch(C.type){case"opfs-unavailable":z(new Error(C.payload.join(" ")));break;case"opfs-async-loaded":v.postMessage({type:"opfs-async-init",args:_});break;case"opfs-async-inited":{if(O===!0)break;try{i.vfs.installVfs({io:{struct:m,methods:ve},vfs:{struct:N,methods:Qe}}),_.sabOPView=new Int32Array(_.sabOP),_.sabFileBufView=new Uint8Array(_.sabIO,0,_.fileBufferSize),_.sabS11nView=new Uint8Array(_.sabIO,_.sabS11nOffset,_.sabS11nSize),re(),c.sanityChecks&&(g("Running sanity checks because of opfs-sanity-check URL arg..."),_t()),le()?navigator.storage.getDirectory().then(j=>{v.onerror=v._originalOnError,delete v._originalOnError,i.opfs=U,U.rootDirectory=j,T("End of OPFS sqlite3_vfs setup.",N),y()}).catch(z):y()}catch(j){w(j),z(j)}break}default:{const j="Unexpected message from the OPFS async worker: "+JSON.stringify(C);w(j),z(new Error(j));break}}}}))};l.defaultProxyUri="sqlite3-opfs-async-proxy.js",globalThis.sqlite3ApiBootstrap.initializersAsync.push(async a=>{try{let c=l.defaultProxyUri;return a.scriptInfo.sqlite3Dir&&(l.defaultProxyUri=a.scriptInfo.sqlite3Dir+c),l().catch(d=>{a.config.warn("Ignoring inability to install OPFS sqlite3_vfs:",d.message)})}catch(c){return a.config.error("installOpfsVfs() exception:",c),Promise.reject(c)}})}),globalThis.sqlite3ApiBootstrap.initializers.push(function(i){var ie,ce,ue,me,ve,Qe,_t,C,j,V,ne,Z,Gs,se;const l=i.util.toss,a=i.util.toss3,c=Object.create(null),d=i.capi,b=i.wasm,k=4096,L=512,X=4,ee=8,oe=L+X,T=L,g=oe,w=k,E=d.SQLITE_OPEN_MAIN_DB|d.SQLITE_OPEN_MAIN_JOURNAL|d.SQLITE_OPEN_SUPER_JOURNAL|d.SQLITE_OPEN_WAL,A=".opaque",q=()=>Math.random().toString(36).slice(2),B=new TextDecoder,J=new TextEncoder,H=Object.assign(Object.create(null),{name:"opfs-sahpool",directory:void 0,initialCapacity:6,clearOnInit:!1,verbosity:2}),U=[i.config.error,i.config.warn,i.config.log];i.config.log;const le=i.config.warn;i.config.error;const m=new Map,N=M=>m.get(M),O=(M,I)=>{I?m.set(M,I):m.delete(M)},z=new Map,y=M=>z.get(M),v=(M,I)=>{I?z.set(M,I):z.delete(M)},f={xCheckReservedLock:function(M,I){const D=y(M);return D.log("xCheckReservedLock"),D.storeErr(),b.poke32(I,1),0},xClose:function(M){const I=y(M);I.storeErr();const D=I.getOFileForS3File(M);if(D)try{I.log(`xClose ${D.path}`),I.mapS3FileToOFile(M,!1),D.sah.flush(),D.flags&d.SQLITE_OPEN_DELETEONCLOSE&&I.deletePath(D.path)}catch(x){return I.storeErr(x),d.SQLITE_IOERR}return 0},xDeviceCharacteristics:function(M){return d.SQLITE_IOCAP_UNDELETABLE_WHEN_OPEN},xFileControl:function(M,I,D){return d.SQLITE_NOTFOUND},xFileSize:function(M,I){const D=y(M);D.log("xFileSize");const P=D.getOFileForS3File(M).sah.getSize()-w;return b.poke64(I,BigInt(P)),0},xLock:function(M,I){const D=y(M);D.log(`xLock ${I}`),D.storeErr();const x=D.getOFileForS3File(M);return x.lockType=I,0},xRead:function(M,I,D,x){const P=y(M);P.storeErr();const W=P.getOFileForS3File(M);P.log(`xRead ${W.path} ${D} @ ${x}`);try{const $=W.sah.read(b.heap8u().subarray(I,I+D),{at:w+Number(x)});return $<D?(b.heap8u().fill(0,I+$,I+D),d.SQLITE_IOERR_SHORT_READ):0}catch($){return P.storeErr($),d.SQLITE_IOERR}},xSectorSize:function(M){return k},xSync:function(M,I){const D=y(M);D.log(`xSync ${I}`),D.storeErr();const x=D.getOFileForS3File(M);try{return x.sah.flush(),0}catch(P){return D.storeErr(P),d.SQLITE_IOERR}},xTruncate:function(M,I){const D=y(M);D.log(`xTruncate ${I}`),D.storeErr();const x=D.getOFileForS3File(M);try{return x.sah.truncate(w+Number(I)),0}catch(P){return D.storeErr(P),d.SQLITE_IOERR}},xUnlock:function(M,I){const D=y(M);D.log("xUnlock");const x=D.getOFileForS3File(M);return x.lockType=I,0},xWrite:function(M,I,D,x){const P=y(M);P.storeErr();const W=P.getOFileForS3File(M);P.log(`xWrite ${W.path} ${D} ${x}`);try{return W.sah.write(b.heap8u().subarray(I,I+D),{at:w+Number(x)})===D?0:d.SQLITE_IOERR}catch($){return P.storeErr($),d.SQLITE_IOERR}}},p=new d.sqlite3_io_methods;p.$iVersion=1,i.vfs.installVfs({io:{struct:p,methods:f}});const _={xAccess:function(M,I,D,x){const P=N(M);P.storeErr();try{const W=P.getPath(I);b.poke32(x,P.hasFilename(W)?1:0)}catch{b.poke32(x,0)}return 0},xCurrentTime:function(M,I){return b.poke(I,24405875e-1+new Date().getTime()/864e5,"double"),0},xCurrentTimeInt64:function(M,I){return b.poke(I,24405875e-1*864e5+new Date().getTime(),"i64"),0},xDelete:function(M,I,D){const x=N(M);x.log(`xDelete ${b.cstrToJs(I)}`),x.storeErr();try{return x.deletePath(x.getPath(I)),0}catch(P){return x.storeErr(P),d.SQLITE_IOERR_DELETE}},xFullPathname:function(M,I,D,x){return b.cstrncpy(x,I,D)<D?0:d.SQLITE_CANTOPEN},xGetLastError:function(M,I,D){const x=N(M);x.log(`xGetLastError ${I}`);const P=x.popErr();if(P){const W=b.scopedAllocPush();try{const[$,de]=b.scopedAllocCString(P.message,!0);b.cstrncpy(D,$,I),de>I&&b.poke8(D+I-1,0)}catch{return d.SQLITE_NOMEM}finally{b.scopedAllocPop(W)}}return 0},xOpen:function(I,D,x,P,W){const $=N(I);try{$.log(`xOpen ${b.cstrToJs(D)} ${P}`);const de=D&&b.peek8(D)?$.getPath(D):q();let we=$.getSAHForPath(de);!we&&P&d.SQLITE_OPEN_CREATE&&($.getFileCount()<$.getCapacity()?(we=$.nextAvailableSAH(),$.setAssociatedPath(we,de,P)):l("SAH pool is full. Cannot create file",de)),we||l("file not found:",de);const Se={path:de,flags:P,sah:we};$.mapS3FileToOFile(x,Se),Se.lockType=d.SQLITE_LOCK_NONE;const Je=new d.sqlite3_file(x);return Je.$pMethods=p.pointer,Je.dispose(),b.poke32(W,P),0}catch(de){return $.storeErr(de),d.SQLITE_CANTOPEN}}},F=function(M){i.capi.sqlite3_vfs_find(M)&&a("VFS name is already registered:",M);const I=new d.sqlite3_vfs,D=d.sqlite3_vfs_find(null),x=D?new d.sqlite3_vfs(D):null;return I.$iVersion=2,I.$szOsFile=d.sqlite3_file.structInfo.sizeof,I.$mxPathname=L,I.addOnDispose(I.$zName=b.allocCString(M),()=>O(I.pointer,0)),x&&(I.$xRandomness=x.$xRandomness,I.$xSleep=x.$xSleep,x.dispose()),!I.$xRandomness&&!_.xRandomness&&(_.xRandomness=function(P,W,$){const de=b.heap8u();let we=0;for(;we<W;++we)de[$+we]=Math.random()*255e3&255;return we}),!I.$xSleep&&!_.xSleep&&(_.xSleep=(P,W)=>0),i.vfs.installVfs({vfs:{struct:I,methods:_}}),I};class G{constructor(I=Object.create(null)){Q(this,Z);Re(this,"vfsDir");Q(this,ie,void 0);Q(this,ce,void 0);Q(this,ue,void 0);Q(this,me,new Map);Q(this,ve,new Map);Q(this,Qe,new Set);Q(this,_t,new Map);Q(this,C,new Uint8Array(oe));Q(this,j,void 0);Q(this,V,void 0);Q(this,ne,void 0);K(this,ne,I.verbosity??H.verbosity),this.vfsName=I.name||H.name,K(this,V,F(this.vfsName)),O(s(this,V).pointer,this),this.vfsDir=I.directory||"."+this.vfsName,K(this,j,new DataView(s(this,C).buffer,s(this,C).byteOffset)),this.isReady=this.reset(!!(I.clearOnInit??H.clearOnInit)).then(()=>{if(this.$error)throw this.$error;return this.getCapacity()?Promise.resolve(void 0):this.addCapacity(I.initialCapacity||H.initialCapacity)})}log(...I){Ce(this,Z,Gs).call(this,2,...I)}warn(...I){Ce(this,Z,Gs).call(this,1,...I)}error(...I){Ce(this,Z,Gs).call(this,0,...I)}getVfs(){return s(this,V)}getCapacity(){return s(this,me).size}getFileCount(){return s(this,ve).size}getFileNames(){const I=[],D=s(this,ve).keys();for(const x of D)I.push(x);return I}async addCapacity(I){for(let D=0;D<I;++D){const x=q(),W=await(await s(this,ce).getFileHandle(x,{create:!0})).createSyncAccessHandle();s(this,me).set(W,x),this.setAssociatedPath(W,"",0)}return this.getCapacity()}async reduceCapacity(I){let D=0;for(const x of Array.from(s(this,Qe))){if(D===I||this.getFileCount()===this.getCapacity())break;const P=s(this,me).get(x);x.close(),await s(this,ce).removeEntry(P),s(this,me).delete(x),s(this,Qe).delete(x),++D}return D}releaseAccessHandles(){for(const I of s(this,me).keys())I.close();s(this,me).clear(),s(this,ve).clear(),s(this,Qe).clear()}async acquireAccessHandles(I){const D=[];for await(const[x,P]of s(this,ce))P.kind==="file"&&D.push([x,P]);return Promise.all(D.map(async([x,P])=>{try{const W=await P.createSyncAccessHandle();if(s(this,me).set(W,x),I)W.truncate(w),this.setAssociatedPath(W,"",0);else{const $=this.getAssociatedPath(W);$?s(this,ve).set($,W):s(this,Qe).add(W)}}catch(W){throw this.storeErr(W),this.releaseAccessHandles(),W}}))}getAssociatedPath(I){I.read(s(this,C),{at:0});const D=s(this,j).getUint32(T);if(s(this,C)[0]&&(D&d.SQLITE_OPEN_DELETEONCLOSE||!(D&E)))return le(`Removing file with unexpected flags ${D.toString(16)}`,s(this,C)),this.setAssociatedPath(I,"",0),"";const x=new Uint32Array(ee/4);I.read(x,{at:g});const P=this.computeDigest(s(this,C));if(x.every((W,$)=>W===P[$])){const W=s(this,C).findIndex($=>$===0);return W===0&&I.truncate(w),W?B.decode(s(this,C).subarray(0,W)):""}else return le("Disassociating file with bad digest."),this.setAssociatedPath(I,"",0),""}setAssociatedPath(I,D,x){const P=J.encodeInto(D,s(this,C));L<=P.written+1&&l("Path too long:",D),s(this,C).fill(0,P.written,L),s(this,j).setUint32(T,x);const W=this.computeDigest(s(this,C));I.write(s(this,C),{at:0}),I.write(W,{at:g}),I.flush(),D?(s(this,ve).set(D,I),s(this,Qe).delete(I)):(I.truncate(w),s(this,Qe).add(I))}computeDigest(I){let D=3735928559,x=1103547991;for(const P of I)D=31*D+P*307,x=31*x+P*307;return new Uint32Array([D>>>0,x>>>0])}async reset(I){await this.isReady;let D=await navigator.storage.getDirectory(),x;for(const P of this.vfsDir.split("/"))P&&(x=D,D=await D.getDirectoryHandle(P,{create:!0}));return K(this,ie,D),K(this,ue,x),K(this,ce,await s(this,ie).getDirectoryHandle(A,{create:!0})),this.releaseAccessHandles(),this.acquireAccessHandles(I)}getPath(I){return b.isPtr(I)&&(I=b.cstrToJs(I)),(I instanceof URL?I:new URL(I,"file://localhost/")).pathname}deletePath(I){const D=s(this,ve).get(I);return D&&(s(this,ve).delete(I),this.setAssociatedPath(D,"",0)),!!D}storeErr(I){return I&&this.error(I),this.$error=I}popErr(){const I=this.$error;return this.$error=void 0,I}nextAvailableSAH(){const[I]=s(this,Qe).keys();return I}getOFileForS3File(I){return s(this,_t).get(I)}mapS3FileToOFile(I,D){D?(s(this,_t).set(I,D),v(I,this)):(s(this,_t).delete(I),v(I,!1))}hasFilename(I){return s(this,ve).has(I)}getSAHForPath(I){return s(this,ve).get(I)}async removeVfs(){if(!s(this,V).pointer||!s(this,ce))return!1;d.sqlite3_vfs_unregister(s(this,V).pointer),s(this,V).dispose();try{this.releaseAccessHandles(),await s(this,ie).removeEntry(A,{recursive:!0}),K(this,ce,void 0),await s(this,ue).removeEntry(s(this,ie).name,{recursive:!0}),K(this,ie,K(this,ue,void 0))}catch(I){i.config.error(this.vfsName,"removeVfs() failed:",I)}return!0}exportFile(I){const D=s(this,ve).get(I)||l("File not found:",I),x=D.getSize()-w,P=new Uint8Array(x>0?x:0);if(x>0){const W=D.read(P,{at:w});W!=x&&l("Expected to read "+x+" bytes but read "+W+".")}return P}importDb(I,D){D instanceof ArrayBuffer&&(D=new Uint8Array(D));const x=D.byteLength;(x<512||x%512!=0)&&l("Byte array size is invalid for an SQLite db.");const P="SQLite format 3";for(let de=0;de<P.length;++de)P.charCodeAt(de)!==D[de]&&l("Input does not contain an SQLite database header.");const W=s(this,ve).get(I)||this.nextAvailableSAH()||l("No available handles to import to."),$=W.write(D,{at:w});$!=x?(this.setAssociatedPath(W,"",0),l("Expected to write "+x+" bytes but wrote "+$+".")):(W.write(new Uint8Array([1,1]),{at:w+18}),this.setAssociatedPath(W,I,d.SQLITE_OPEN_MAIN_DB))}}ie=new WeakMap,ce=new WeakMap,ue=new WeakMap,me=new WeakMap,ve=new WeakMap,Qe=new WeakMap,_t=new WeakMap,C=new WeakMap,j=new WeakMap,V=new WeakMap,ne=new WeakMap,Z=new WeakSet,Gs=function(I,...D){s(this,ne)>I&&U[I](this.vfsName+":",...D)};class re{constructor(I){Q(this,se,void 0);K(this,se,I),this.vfsName=I.vfsName}async addCapacity(I){return s(this,se).addCapacity(I)}async reduceCapacity(I){return s(this,se).reduceCapacity(I)}getCapacity(){return s(this,se).getCapacity(s(this,se))}getFileCount(){return s(this,se).getFileCount()}getFileNames(){return s(this,se).getFileNames()}async reserveMinimumCapacity(I){const D=s(this,se).getCapacity();return D<I?s(this,se).addCapacity(I-D):D}exportFile(I){return s(this,se).exportFile(I)}importDb(I,D){return s(this,se).importDb(I,D)}async wipeFiles(){return s(this,se).reset(!0)}unlink(I){return s(this,se).deletePath(I)}async removeVfs(){return s(this,se).removeVfs()}}se=new WeakMap;const ae=async()=>{const M=await navigator.storage.getDirectory(),I=".opfs-sahpool-sync-check-"+q(),P=(await(await M.getFileHandle(I,{create:!0})).createSyncAccessHandle()).close();return await P,await M.removeEntry(I),P!=null&&P.then&&l("The local OPFS API is too old for opfs-sahpool:","it has an async FileSystemSyncAccessHandle.close() method."),!0};i.installOpfsSAHPoolVfs=async function(M=Object.create(null)){var D;const I=M.name||H.name;return c[I]?c[I]:!globalThis.FileSystemHandle||!globalThis.FileSystemDirectoryHandle||!globalThis.FileSystemFileHandle||!globalThis.FileSystemFileHandle.prototype.createSyncAccessHandle||!((D=navigator==null?void 0:navigator.storage)!=null&&D.getDirectory)?c[I]=Promise.reject(new Error("Missing required OPFS APIs.")):c[I]=ae().then(async function(){if(M.$testThrowInInit)throw M.$testThrowInInit;const x=new G(M);return x.isReady.then(async()=>{const P=new re(x);if(i.oo1){const W=i.oo1,$=x.getVfs(),de=function(...we){const Se=W.DB.dbCtorHelper.normalizeArgs(...we);Se.vfs=$.$zName,W.DB.dbCtorHelper.call(this,Se)};de.prototype=Object.create(W.DB.prototype),P.OpfsSAHPoolDb=de,W.DB.dbCtorHelper.setVfsPostOpenSql($.pointer,function(we,Se){Se.capi.sqlite3_exec(we,["pragma journal_mode=DELETE;","pragma cache_size=-16384;"],0,0,0)})}return x.log("VFS initialized."),P}).catch(async P=>(await x.removeVfs().catch(()=>{}),P))}).catch(x=>c[I]=Promise.reject(x))}}),typeof o<"u"){const i=Object.assign(Object.create(null),{exports:typeof wasmExports>"u"?o.asm:wasmExports,memory:o.wasmMemory},globalThis.sqlite3ApiConfig||{});globalThis.sqlite3ApiConfig=i;let l;try{l=globalThis.sqlite3ApiBootstrap()}catch(a){throw console.error("sqlite3ApiBootstrap() error:",a),a}finally{delete globalThis.sqlite3ApiBootstrap,delete globalThis.sqlite3ApiConfig}o.sqlite3=l}else console.warn("This is not running in an Emscripten module context, so","globalThis.sqlite3ApiBootstrap() is _not_ being called due to lack","of config info for the WASM environment.","It must be called manually.")}),r.ready}})();Ao=function(){var r,n;const t=Ao;if(!t)throw new Error("Expecting globalThis.sqlite3InitModule to be defined by the Emscripten build.");const e=globalThis.sqlite3InitModuleState=Object.assign(Object.create(null),{moduleScript:(r=globalThis==null?void 0:globalThis.document)==null?void 0:r.currentScript,isWorker:typeof WorkerGlobalScope<"u",location:globalThis.location,urlParams:(n=globalThis==null?void 0:globalThis.location)!=null&&n.href?new URL(globalThis.location.href).searchParams:new URLSearchParams});if(e.debugModule=e.urlParams.has("sqlite3.debugModule")?(...S)=>console.warn("sqlite3.debugModule:",...S):()=>{},e.urlParams.has("sqlite3.dir"))e.sqlite3Dir=e.urlParams.get("sqlite3.dir")+"/";else if(e.moduleScript){const S=e.moduleScript.src.split("/");S.pop(),e.sqlite3Dir=S.join("/")+"/"}if(globalThis.sqlite3InitModule=function S(...R){return t(...R).then(te=>{const fe=te.sqlite3;fe.scriptInfo=e,S.__isUnderTest&&(fe.__isUnderTest=!0);const Te=fe.asyncPostInit;return delete fe.asyncPostInit,Te()}).catch(te=>{throw console.error("Exception loading sqlite3 module:",te),te})},globalThis.sqlite3InitModule.ready=t.ready,globalThis.sqlite3InitModuleState.moduleScript){const S=globalThis.sqlite3InitModuleState;let R=S.moduleScript.src.split("/");R.pop(),S.scriptDir=R.join("/")+"/"}return e.debugModule("sqlite3InitModuleState =",e),globalThis.sqlite3InitModule}();var vu=Ao;/** @license Copyright 2019 Google LLC SPDX-License-Identifier: Apache-2.0 */function xu(t){return t.constructor.name==="MessagePort"}function Eu(t){xu(t)&&t.close()}function Su(t){return Au(t,{type:"RELEASE"}).then(()=>{Eu(t)})}const Ya=new WeakMap;"FinalizationRegistry"in globalThis&&new FinalizationRegistry(t=>{const e=(Ya.get(t)||0)-1;Ya.set(t,e),e===0&&Su(t)});function Au(t,e,r){return new Promise(n=>{const S=ku();t.addEventListener("message",function R(te){!te.data||!te.data.id||te.data.id!==S||(t.removeEventListener("message",R),n(te.data))}),t.start&&t.start(),t.postMessage(Object.assign({id:S},e),r)})}function ku(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var Za=t=>{if(tl(t)||typeof t=="string")return t;if(typeof t=="boolean")return`${t}`;if(t instanceof Date)return t.toISOString();try{return JSON.stringify(t)}catch{return t}},el=/^\d{4}-\d{2}-\d{2}[T ]\d{2}:\d{2}:\d{2}(?:\.\d+)?Z?$/,Iu=t=>{if(tl(t))return t;if(typeof t=="string"){if(/^(true|false)$/.test(t))return t==="true";if(el.test(t))return new Date(t);try{return JSON.parse(t,(e,r)=>typeof r=="string"&&el.exec(r)?new Date(r):r)}catch{return t}}};function tl(t){return t==null||typeof t=="bigint"||typeof t=="number"||typeof t=="object"&&"buffer"in t}var Ou=class extends po{constructor(e){super();Re(this,"serializer");this.serializer=e||Za}transformPrimitiveValueList(e){return{...e,values:e.values.map(this.serializer)}}transformColumnUpdate(e){const{value:r}=e;if(r.kind!=="ValueNode")return super.transformColumnUpdate(e);const{value:n,...S}=r,R=this.serializer(n);return n===R?super.transformColumnUpdate(e):super.transformColumnUpdate({...e,value:{...S,value:R}})}transformValue(e){return{...e,value:this.serializer(e.value)}}},Tu=class{constructor(t={}){Re(this,"serializeParametersTransformer");Re(this,"deserializer");Re(this,"only");Re(this,"ctx");const{deserializer:e=Iu,selectOrRawOnly:r=!1,serializer:n}=t;this.serializeParametersTransformer=new Ou(n),this.deserializer=e,this.only=r}transformQuery({node:t,queryId:e}){var r;return this.only&&(t.kind==="SelectQueryNode"||t.kind==="RawNode")&&((r=this.ctx)==null||r.add(e)),this.serializeParametersTransformer.transformNode(t)}async parseResult(t){return t.length?await Promise.all(t.map(async e=>{const r={...e};for(const n in r)r[n]=await this.deserializer(r[n]);return r})):[]}async transformResult({result:t,queryId:e}){var n,S;const r=async()=>({...t,rows:await this.parseResult(t.rows)});return this.only?(n=this.ctx)!=null&&n.has(e)?((S=this.ctx)==null||S.delete(e),await r()):t:await r()}};function Cu(t){return`__pre_${t}`}function Pu(t,e=r=>r){return{setParam:r=>{let n;return(S,R)=>{if(!n){const{parameters:te,sql:fe,query:Te}=r({qb:t,param:Cu}).compile();n={sql:fe,query:(R==null?void 0:R(Te))||{kind:Te.kind},parameters:te}}return{...n,parameters:n.parameters.map(te=>typeof te=="string"&&te.startsWith("__pre_")?e(S[te.slice(6)]):te)}}}}}async function Fu(t){return(await $e`PRAGMA integrity_check`.execute(t)).rows[0].integrity_check==="ok"}async function nl(t,e){return e?(await $e`PRAGMA user_version = ${$e.raw(`${e}`)}`.execute(t),e):(await $e`PRAGMA user_version`.execute(t)).rows[0].user_version}async function Lu(t,e){const r=e||`sp_${Date.now()%1e8}`;return await $e`savepoint ${$e.raw(r)}`.execute(t),{release:async()=>{await $e`release savepoint ${$e.raw(r)}`.execute(t)},rollback:async()=>{await $e`rollback to savepoint ${$e.raw(r)}`.execute(t)}}}function rl(t){const{logger:e,merge:r,queryNode:n}=t;return S=>{const{level:R,queryDurationMillis:te,query:{parameters:fe,sql:Te,query:Ye}}=S,Le=R==="error"?S.error:void 0;let Ve=Te.replace(/\r?\n/g," ").replace(/\s+/g," ");r&&fe.forEach(mn=>{Ve=Ve.replace("?",typeof mn=="string"?mn:JSON.stringify(mn))});const We={sql:Ve,params:fe,duration:te,error:Le};n&&(We.queryNode=Ye),e(We)}}var Wu=class extends Error{constructor(){super("db file maybe broken")}};function Du(t){return t.toOperationNode().kind==="SelectQueryNode"}var Ru=class{constructor(t){Re(this,"kysely");Re(this,"trxCount",0);Re(this,"trx");Re(this,"logger");Re(this,"serializer",Za);var fe;const{dialect:e,logger:r,onQuery:n,plugins:S=[],serializerPluginOptions:R}=t;this.logger=r,R!=null&&R.serializer&&(this.serializer=R.serializer),S.push(new Tu(R));let te;n===!0?te=rl({logger:((fe=this.logger)==null?void 0:fe.debug)||console.log,merge:!0}):n&&(te=rl(n)),this.kysely=new li({dialect:e,log:te,plugins:S})}async syncSchema(t,e){var r,n;try{if(e&&!await Fu(this.kysely))return(r=this.logger)==null||r.error("integrity check fail"),{ready:!1,error:new Wu};await t(this.kysely,this.logger)}catch(S){return this.logError(S,"sync table fail"),{ready:!1,error:S}}return(n=this.logger)==null||n.info("table updated"),{ready:!0}}getDB(){return this.trx||this.kysely}logError(t,e){var r;e&&((r=this.logger)==null||r.error(e,t instanceof Error?t:void 0))}async transaction(t,e){var S;if(!this.trx)try{return await this.kysely.transaction().execute(async R=>{var fe;return this.trx=R,(fe=this.logger)==null||fe.debug("run in transaction"),await t(R)})}catch(R){this.logError(R,e);return}finally{this.trx=void 0}this.trxCount++;const r=this.getDB(),n=await Lu(r,`sp_${this.trxCount}`);(S=this.logger)==null||S.debug(`run in savepoint:${this.trxCount}`);try{const R=await t(r);return await n.release(),this.trxCount--,R}catch(R){await n.rollback(),this.logError(R,e),this.trxCount--;return}}async execute(t,e){try{return await t(this.getDB()).execute()}catch(r){this.logError(r,e);return}}async executeTakeFirst(t,e){try{let r=t(this.getDB());return Du(r)&&(r=r.limit(1)),await r.executeTakeFirstOrThrow()}catch(r){this.logError(r,e);return}}precompile(t){var e,r;return(r=(e=this.logger)==null?void 0:e.debug)==null||r.call(e,"precompile"),Pu(t(this.kysely),this.serializer)}async executeCompiled(t,e){try{return await this.getDB().executeQuery(t)}catch(r){this.logError(r,e);return}}async executeCompiledTakeList(t,e){const r=await this.executeCompiled(t,e);return r==null?void 0:r.rows}async raw(t,e){try{return typeof t=="string"?await this.getDB().executeQuery(cn.raw(t)):await t.execute(this.getDB())}catch(r){this.logError(r,e);return}}async destroy(){var t;(t=this.logger)==null||t.info("destroyed"),await this.kysely.destroy(),this.trx=void 0}},il="__TIME_TRIGGER__";function Mu(t,e){const{create:r,update:n}=(e==null?void 0:e.timeTrigger)||{},S={type:"date",defaultTo:il};return r===!0?t.createAt=S:r&&(t[r]=S),n===!0?t.updateAt={...S,notNull:0}:n&&(t[n]={...S,notNull:0}),{columns:t,...e}}function sl(t){let e="text",r=!1;switch(t){case"boolean":case"date":case"object":case"string":e="text";break;case"float":e="real";break;case"increments":r=!0;case"int":e="integer";break;default:e=t}return{dataType:e,isIncrements:r}}function ko(t){return Array.isArray(t)?t:[t]}function Bu(t){return typeof t=="function"}async function bs(t,e){await t.schema.dropTable(e).execute()}async function ol(t,e,r){const{index:n,...S}=r;await t.transaction().execute(async R=>{const te=await Io(R,e,S);await ll(R,e,te),await al(R,e,n)})}async function al(t,e,r){for(const n of r||[]){const S=ko(n);await t.schema.createIndex(`idx_${e}_${S.join("_")}`).on(e).columns(S).ifNotExists().execute()}}async function Io(t,e,{columns:r,primary:n,timeTrigger:S,unique:R},te=!1){const fe=S?{triggerKey:"rowid",update:void 0}:void 0;let Te=!1,Ye=t.schema.createTable(e);te&&(Ye=Ye.temporary());for(const[Le,Ve]of Object.entries(r)){let We="text";const{type:mn,notNull:Rn,defaultTo:nn}=Ve,ke=sl(mn);We=ke.dataType,Ye=Ye.addColumn(Le,We,at=>ke.isIncrements?(Te=!0,fe&&(fe.triggerKey=Le),at.autoIncrement().primaryKey()):nn===il?(fe&&Rn===0&&(fe.update=Le),at.defaultTo($e`CURRENT_TIMESTAMP`)):(Rn===!0&&(at=at.notNull()),nn!==void 0&&(at=at.defaultTo(Bu(nn)?nn($e):nn)),at))}if(!Te&&n){const Le=ko(n);Ye=Ye.addPrimaryKeyConstraint(`pk#${Le.join("#")}`,Le)}for(const Le of R||[]){const Ve=ko(Le);Ye=Ye.addUniqueConstraint(`un#${Ve.join("#")}`,Ve)}return await Ye.ifNotExists().execute(),fe}async function ll(t,e,r){if(!r||!r.update)return;const{triggerKey:n,update:S}=r,R=`tgr_${e}_${S}`;await $e`create trigger if not exists ${$e.ref(R)}
after update
on ${$e.table(e)}
begin
  update ${$e.table(e)}
  set ${$e.ref(S)} = CURRENT_TIMESTAMP
  where ${$e.ref(n)} = NEW.${$e.ref(n)};
end`.execute(t)}function Qu(t){const e=/create table (?:if not exist)?\s*"([^"]+)".*?\((.*)\)/i,r=/"([^"]+)"\s+(\w+)\s?(not null)?/gi,[,n,S]=t.replace(/\r?\n/g,"").match(e),R={columns:{},name:n,primary:void 0,unique:[]},te=S.matchAll(r);for(const fe of te){const[,Te,Ye,Le]=fe;if(Te.startsWith("pk#")){const[,...Ve]=Te.split("#");R.primary=Ve}else if(Te.startsWith("un#")){const[,...Ve]=Te.split("#");R.unique.push(Ve)}else R.columns[Te]={type:Ye,notNull:!!Le}}return R}async function Uu(t,e=[]){const r=await t.selectFrom("sqlite_master").where("type","in",["table","trigger","index"]).where("name","!=",Ka).where("name","!=",Xa).where("name","not like","sqlite_%").$if(!!e.length,S=>S.where(R=>R.and(e.map(te=>R("name","not like",`${te}%`))))).select(["name","sql","type"]).$castTo().execute(),n={existTables:{},indexList:[],triggerList:[]};for(const{name:S,sql:R,type:te}of r)R&&(te==="table"?n.existTables[S]=Qu(R):te==="index"?n.indexList.push(S):n.triggerList.push(S));return n}async function ju(t,e,r={},n){const{reserveOldData:S,truncateIfExists:R=[],log:te,version:{current:fe,skipSyncWhenSame:Te}={},excludeTablePrefix:Ye}=r;if(Te&&fe===await nl(t))return;await nl(t,fe);const Le=ke=>te&&(n==null?void 0:n.debug(ke)),{existTables:Ve,indexList:We,triggerList:mn}=await Uu(t,Ye);Le("====== sync tables start ======");const Rn=new Set(Array.isArray(R)?R:R?Object.keys(Ve):[]);for(const ke of We)await t.schema.dropIndex(ke).ifExists().execute();for(const ke of mn)await $e`drop trigger if exists ${$e.ref(ke)}`.execute(t);for(const[ke,at]of Object.entries(Ve))ke in e?(Le(`diff table: ${ke}`),await nn(ke,at,e[ke])):(Le(`remove table: ${ke}`),await bs(t,ke));for(const[ke,at]of Object.entries(e))ke in Ve||(Le(`create table: ${ke}`),await ol(t,ke,at));Le("======= sync tables end =======");async function nn(ke,at,Rt){if(Rn.has(ke)){await t.transaction().execute(async vt=>{await bs(vt,ke),await ol(vt,ke,Rt),Le("clear and sync structure")});return}const{index:sr,...rn}=Rt,Mn=zu(at.columns,Rt.columns);if(Mn.length===Object.keys(at.columns).length){Le("same table structure, skip");return}Le("different table structure, update"),await t.transaction().execute(async vt=>{const or=`_temp_${ke}`;await Io(vt,or,at,!0),await vt.insertInto(or).expression(Ii=>Ii.selectFrom(ke).selectAll()).execute(),await bs(vt,ke);const Bn=await Io(vt,ke,rn);Mn.length&&await vt.insertInto(ke).columns(Mn).expression(Ii=>Ii.selectFrom(or).select(Mn)).execute(),await al(vt,ke,sr),await ll(vt,ke,Bn),!S&&await bs(vt,or)}).then(()=>Le(`restore columns: ${Mn}`)).catch(vt=>n==null?void 0:n.error(`fail to sync ${ke}`,vt))}}function zu(t,e){const r=[];for(const[n,S]of Object.entries(e))if(n in t){const{type:R,notNull:te=!1}=t[n];sl(S.type).dataType===R&&(S.notNull||!1)===te&&r.push(n)}return r}function Vu(t,e={}){const{log:r}=e;return async(n,S)=>{await ju(n,t,e,r?S:void 0)}}const $u={test:Mu({id:{type:"increments"},name:{type:"string"},blobtest:{type:"blob"}},{timeTrigger:{create:!0,update:!0}})};async function Hu(t){const e=new Ru({dialect:t}),r=await e.syncSchema(Vu($u));if(!r.ready)throw r.error;console.log("test"),console.log(await e.raw($e`PRAGMA table_info(${$e.table("test")});`)),console.log(await e.raw($e`select last_insert_rowid()`));for(let n=0;n<10;n++)await e.transaction(async S=>{await S.insertInto("test").values({name:`test at ${Date.now()}`,blobtest:Uint8Array.from([2,3,4,5,6,7,8])}).execute()});return e.execute(n=>n.selectFrom("test").selectAll())}const Ju=new qu({database:async()=>{const t=(await vu()).oo1;if(!t)return Promise.reject("fail to load sqlite");const e="/test.db";return t.OpfsDb?(console.log("support OPFS"),new t.OpfsDb(e)):(console.log("doesn't support OPFS"),new t.DB(e))},async onCreateConnection(t){await Nu(t)}});onmessage=()=>{console.log("start official wasm test"),Hu(Ju).then(t=>{t==null||t.forEach(e=>console.log("[official wasm]",e))})}})();
